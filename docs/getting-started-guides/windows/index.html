<!DOCTYPE html>
<html id="docs" lang="en" class="">
<head>
  

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36037335-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-36037335-10');
</script>
<meta charset="utf-8">
<title>Using Windows Server Containers in Kubernetes - SuperMap iDesktop .NET</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
<link rel="stylesheet" href="/css/base_fonts.css">
<link rel="stylesheet" href="/css/styles.css">
<link rel="stylesheet" href="/css/jquery-ui.min.css">
<link rel="stylesheet" href="/css/sweetalert.min.css">
<link rel="stylesheet" href="/css/callouts.css">
<link rel="stylesheet" href="/css/custom-jekyll/tags.css">
<link rel="stylesheet" href="https://qinlj.github.io/css/main.css" />
<link rel="stylesheet" href="https://qinlj.github.io/css/share.min.css" />



<meta name="description" content="Note: These instructions were recently updated based on Windows Server platform enhancements and the Kubernetes v1.9 releaseKubernetes version 1.5 introduced Alpha support for Windows Server Containers based on the Windows Server 2016 operating system. With the release of Windows Server version 1709 and using Kubernetes v1.9 users are able to deploy a Kubernetes cluster either on-premises or in a private/public cloud using a number of different network topologies and CNI plugins.">
<meta property="og:description" content="Note: These instructions were recently updated based on Windows Server platform enhancements and the Kubernetes v1.9 releaseKubernetes version 1.5 introduced Alpha support for Windows Server Containers based on the Windows Server 2016 operating system. With the release of Windows Server version 1709 and using Kubernetes v1.9 users are able to deploy a Kubernetes cluster either on-premises or in a private/public cloud using a number of different network topologies and CNI plugins.">
<meta name="twitter:description" content="Note: These instructions were recently updated based on Windows Server platform enhancements and the Kubernetes v1.9 releaseKubernetes version 1.5 introduced Alpha support for Windows Server Containers based on the Windows Server 2016 operating system. With the release of Windows Server version 1709 and using Kubernetes v1.9 users are able to deploy a Kubernetes cluster either on-premises or in a private/public cloud using a number of different network topologies and CNI plugins.">
<meta property="og:url" content="https://qinlj.github.io/docs/getting-started-guides/windows/">
<meta property="og:title" content="Using Windows Server Containers in Kubernetes">
<meta name="twitter:title" content="Using Windows Server Containers in Kubernetes">

<meta name="twitter:image:alt"   content="SuperMap iDesktop .NET">

<meta property="og:image" content="/images/kubernetes-horizontal-color.png">

<meta property="og:type" content="article">
<script src="/js/anchor-4.1.1.min.js"></script>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/jquery-ui-1.12.1.min.js"></script>
<script src="/js/bootstrap-3.3.7.min.js"></script>
<script src="/js/sweetalert-1.1.3.min.js"></script>
<script src="/js/script.js"></script>
<script src="/js/custom-jekyll/tags.js"></script>


</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            
            
            <li><a href="/docs/" class="active">Documentation</a></li>
            
            <li><a href="/blog/">Blog</a></li>
            
            <li><a href="/partners/">Partners</a></li>
            
            <li><a href="/community/">Community</a></li>
            
            <li><a href="/case-studies/">Case Studies</a></li>
            
            
            
             <li>
                <a href="#">
                    English <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="/zh/">中文 Chinese</a></li>
                
                    <li><a href="/ko/">한국어 Korean</a></li>
                
                    <li><a href="/ja/">日本語 Japanese</a></li>
                
                    <li><a href="/fr/">Français</a></li>
                
                    <li><a href="/it/">Italian</a></li>
                
                </ul>
            </li>

            <li>
                <a href="#">
                    v1.13 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="https://kubernetes.io">v1.13</a></li>
                
                    <li><a href="https://supermaphehh.github.io/zh/">iDesktop .NET</a></li>
                
                    <li><a href="https://v1-12.docs.kubernetes.io">v1.12</a></li>
                
                    <li><a href="https://v1-11.docs.kubernetes.io">v1.11</a></li>
                
                    <li><a href="https://v1-10.docs.kubernetes.io">v1.10</a></li>
                
                    <li><a href="https://v1-9.docs.kubernetes.io">v1.9</a></li>
                
                </ul>
            </li>
        </ul>

        <form id="searchBox" action="/search/">
          <input type="text" id="search" name="q" placeholder="Search" aria-label="Search">
        </form>

    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
         
           <div class="nav-box">
            <h3><a href="/docs/tutorials/hello-minikube/">Get Started</a></h3>
           <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>

        </div>
         
           <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
           <p>Learn how to use Kubernetes with conceptual, tutorial, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>

        </div>
         
           <div class="nav-box">
            <h3><a href="/blog/">Blog</a></h3>
           <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>

        </div>
         
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack Slack</span></a>
                <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>



<section id="hero" class="light-text no-sub">
  




















<div id="vendorStrip" class="light-text">
	<ul>
		
		
		<li><a href="/docs/home/">HOME</a></li>
		
		
		<li><a href="/docs/surfaceanalyst/">SURFACEANALYSIS</a></li>
		
		
		<li><a href="/docs/setup/">SETUP</a></li>
		
		
		<li><a href="/docs/concepts/">CONCEPTS</a></li>
		
		
		<li><a href="/docs/tasks/">TASKS</a></li>
		
		
		<li><a href="/docs/tutorials/">TUTORIALS</a></li>
		
		
		<li><a href="/docs/reference/">REFERENCE</a></li>
		
		
		<li><a href="/docs/contribute/">CONTRIBUTE</a></li>
		
	</ul>
	<form id="searchBox" action="/docs/search/">
		<input type="text" id="search" name="q" placeholder="Search" aria-label="Search">
  </form>
</div>

</section>



<section id="encyclopedia">
  
<div id="docsToc">
     <div class="pi-accordion">
    	
        
        
        
        
        
         
             
                 
             
         
             
                 
             
         
             
                 
             
         
             
                 
             
         
             
                 
                          
                          
                 
             
         
             
         
             
         
             
         
             
         
         
        
        <a class="item" data-title="Independent Solutions" href="/docs/getting-started-guides/"></a>

	
	
	
	
		
			
<div class="item" data-title="Bare Metal">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Fedora (Multi Node)" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>

		
	
		
			

<a class="item" data-title="Fedora (Single Node)" href="/docs/getting-started-guides/fedora/fedora_manual_config/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Kubernetes on Ubuntu">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Backups" href="/docs/getting-started-guides/ubuntu/backups/"></a>

		
	
		
			

<a class="item" data-title="Decommissioning" href="/docs/getting-started-guides/ubuntu/decommissioning/"></a>

		
	
		
			

<a class="item" data-title="Glossary and Terminology" href="/docs/getting-started-guides/ubuntu/glossary/"></a>

		
	
		
			

<a class="item" data-title="Local Kubernetes development with LXD" href="/docs/getting-started-guides/ubuntu/local/"></a>

		
	
		
			

<a class="item" data-title="Logging" href="/docs/getting-started-guides/ubuntu/logging/"></a>

		
	
		
			

<a class="item" data-title="Monitoring" href="/docs/getting-started-guides/ubuntu/monitoring/"></a>

		
	
		
			

<a class="item" data-title="Networking" href="/docs/getting-started-guides/ubuntu/networking/"></a>

		
	
		
			

<a class="item" data-title="Operational Considerations" href="/docs/getting-started-guides/ubuntu/operational-considerations/"></a>

		
	
		
			

<a class="item" data-title="Rancher Integration with Ubuntu Kubernetes" href="/docs/getting-started-guides/ubuntu/rancher/"></a>

		
	
		
			

<a class="item" data-title="Scaling" href="/docs/getting-started-guides/ubuntu/scaling/"></a>

		
	
		
			

<a class="item" data-title="Security Considerations" href="/docs/getting-started-guides/ubuntu/security/"></a>

		
	
		
			

<a class="item" data-title="Setting up Kubernetes with Juju" href="/docs/getting-started-guides/ubuntu/installation/"></a>

		
	
		
			

<a class="item" data-title="Storage" href="/docs/getting-started-guides/ubuntu/storage/"></a>

		
	
		
			

<a class="item" data-title="Troubleshooting" href="/docs/getting-started-guides/ubuntu/troubleshooting/"></a>

		
	
		
			

<a class="item" data-title="Upgrades" href="/docs/getting-started-guides/ubuntu/upgrades/"></a>

		
	
		
			

<a class="item" data-title="Validation - End-to-end Testing" href="/docs/getting-started-guides/ubuntu/validation/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="Deprecated Alternatives" href="/docs/getting-started-guides/alternatives/"></a>

		
	





     </div> 
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
</div> 


  <div id="docsContent">
  
	 
	 
<p>
  <a href="https://github.com/kubernetes/website/edit/master/content/en/docs%5cgetting-started-guides%5cwindows%5c_index.md" id="editPageButton" target="_blank">
    Edit This Page
  </a>
</p>

<h1>Using Windows Server Containers in Kubernetes</h1>





<blockquote class="note">
  <div><strong>Note:</strong> These instructions were recently updated based on Windows Server platform enhancements and the Kubernetes v1.9 release</div>
</blockquote>


<p>Kubernetes version 1.5 introduced Alpha support for Windows Server
Containers based on the Windows Server 2016 operating system. With the
release of Windows Server version 1709 and using Kubernetes v1.9 users
are able to deploy a Kubernetes cluster either on-premises or in a
private/public cloud using a number of different network topologies
and CNI plugins. Some key feature improvements for Windows Server
Containers on Kubernetes include:</p>

<ul>
<li>Improved support for pods! Shared network namespace (compartment) with multiple Windows Server containers (shared kernel)</li>
<li>Reduced network complexity by using a single network endpoint per pod</li>
<li>Kernel-Based load-balancing using the Virtual Filtering Platform (VFP) Hyper-v Switch Extension (analogous to Linux iptables)</li>
<li>Container Runtime Interface (CRI) pod and node level statistics</li>
<li>Support for kubeadm commands to add Windows Server nodes to a Kubernetes environment</li>
</ul>

<p>The Kubernetes control plane (API Server, Scheduler, Controller Manager, etc) continue to run on Linux, while the kubelet and kube-proxy can be run on Windows Server 2016 or later</p>

<blockquote class="note">
  <div><strong>Note:</strong> Windows Server Containers on Kubernetes is a Beta feature in Kubernetes v1.9</div>
</blockquote>


<h2 id="get-windows-binaries">Get Windows Binaries</h2>

<p>We recommend using the release binaries that can be found at <a href="https://github.com/kubernetes/kubernetes/releases/latest" target="_blank">https://github.com/kubernetes/kubernetes/releases/latest</a>. Under the CHANGELOG you can find the Node Binaries link for Windows-amd64, which will include kubeadm, kubectl, kubelet and kube-proxy.</p>

<p>If you wish to build the code yourself, please refer to detailed build instructions <a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/kubernetes/compiling-kubernetes-binaries" target="_blank">here</a>.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>In Kubernetes version 1.9 or later, Windows Server Containers for Kubernetes are supported using the following:</p>

<ol>
<li>Kubernetes control plane running on existing Linux infrastructure (version 1.9 or later).</li>
<li>Kubenet network plugin setup on the Linux nodes.</li>
<li>Windows Server 2016 RTM or later. Windows Server version 1709 or later is preferred; it unlocks key capabilities like shared network namespace.</li>
<li>Docker Version 17.06.1-ee-2 or later for Windows Server nodes (Linux nodes and Kubernetes control plane can run any Kubernetes supported Docker Version).</li>
</ol>

<h2 id="networking">Networking</h2>

<p>There are several supported network configurations with Kubernetes v1.9 on Windows, including both Layer-3 routed and overlay topologies using third-party network plugins.</p>

<ol>
<li><a href="#upstream-l3-routing-topology">Upstream L3 Routing</a> - IP routes configured in upstream ToR</li>
<li><a href="#host-gateway-topology">Host-Gateway</a> - IP routes configured on each host</li>
<li><a href="#using-ovn-with-ovs">Open vSwitch (OVS) &amp; Open Virtual Network (OVN) with Overlay</a> - overlay networks (supports STT and Geneve tunneling types)</li>
<li>[Future - In Review] Overlay - VXLAN or IP-in-IP encapsulation using Flannel</li>
<li>[Future] Layer-3 Routing with BGP (Calico)</li>
</ol>

<p>The selection of which network configuration and topology to deploy depends on the physical network topology and a user&rsquo;s ability to configure routes, performance concerns with encapsulation, and requirement to integrate with third-party network plugins.</p>

<h3 id="future-cni-plugins">Future CNI Plugins</h3>

<p>An additional two CNI plugins [win-l2bridge (host-gateway) and win-overlay (vxlan)] are in <a href="https://github.com/containernetworking/plugins/pull/85" target="_blank">PR review</a>. These two CNI plugins, when ready, can either be used directly or with Flannel.</p>

<h3 id="linux">Linux</h3>

<p>The above networking approaches are already supported on Linux using a bridge interface, which essentially creates a private network local to the node. Similar to the Windows side, routes to all other pod CIDRs must be created in order to send packets via the &ldquo;public&rdquo; NIC.</p>

<h3 id="windows">Windows</h3>

<p>Windows supports the CNI network model and uses plugins to interface with the Windows Host Networking Service (HNS) to configure host networking and policy. At the time of this writing, the only publicly available CNI plugin from Microsoft is built from a private repo and available here <a href="https://github.com/Microsoft/SDN/blob/master/Kubernetes/windows/cni/wincni.exe" target="_blank">wincni.exe</a>. It uses an l2bridge network created through the Windows Host Networking Service (HNS) by an administrator using HNS PowerShell commands on each node as documented in the <a href="#windows-host-setup">Windows Host Setup</a> section below. Source code for the future CNI plugins will be made available publicly.</p>

<h4 id="upstream-l3-routing-topology">Upstream L3 Routing Topology</h4>

<p>In this topology, networking is achieved using L3 routing with static IP routes configured in an upstream Top of Rack (ToR) switch/router. Each cluster node is connected to the management network with a host IP. Additionally, each node uses a local &lsquo;l2bridge&rsquo; network with a pod CIDR assigned. All pods on a given worker node will be connected to the pod CIDR subnet (&lsquo;l2bridge&rsquo; network). In order to enable network communication between pods running on different nodes, the upstream router has static routes configured with pod CIDR prefix =&gt; Host IP.</p>

<p>The following example diagram illustrates the Windows Server networking setup for Kubernetes using Upstream L3 Routing Setup:
<img src="UpstreamRouting.png" alt="K8s Cluster using L3 Routing with ToR" /></p>

<h4 id="host-gateway-topology">Host-Gateway Topology</h4>

<p>This topology is similar to the Upstream L3 Routing topology with the only difference being that static IP routes are configured directly on each cluster node and not in the upstream ToR. Each node uses a local &lsquo;l2bridge&rsquo; network with a pod CIDR assigned as before and has routing table entries for all other pod CIDR subnets assigned to the remote cluster nodes.</p>

<h4 id="using-ovn-with-ovs">Using OVN with OVS</h4>

<p>The following diagram gives a general overview of the architecture and interaction between components:</p>

<p><img src="ovn_kubernetes.png" alt="Overlay using OVN controller and OVS Switch Extension" /></p>

<p>(The above image is from <a href="https://github.com/openvswitch/ovn-kubernetes#overlay-mode-architecture-diagram" target="_blank">https://github.com/openvswitch/ovn-kubernetes#overlay-mode-architecture-diagram</a>)</p>

<p>Due to its architecture, OVN has a central component which stores your networking intent in a database. Other components i.e. kube-apiserver, kube-controller-manager, kube-scheduler etc. can be deployed on that central node as well.</p>

<h2 id="setting-up-windows-server-containers-on-kubernetes">Setting up Windows Server Containers on Kubernetes</h2>

<p>To run Windows Server Containers on Kubernetes, you&rsquo;ll need to set up both your host machines and the Kubernetes node components for Windows. Depending on your network topology, routes may need to be set up for pod communication on different nodes.</p>

<h3 id="host-setup">Host Setup</h3>

<h4 id="for-1-upstream-l3-routing-topology-and-2-host-gateway-topology">For 1. Upstream L3 Routing Topology and 2. Host-Gateway Topology</h4>

<h5 id="linux-host-setup">Linux Host Setup</h5>

<ol>
<li>Linux hosts should be setup according to their respective distro documentation and the requirements of the Kubernetes version you will be using.</li>
<li>Configure Linux Master node using steps <a href="https://github.com/MicrosoftDocs/Virtualization-Documentation/blob/live/virtualization/windowscontainers/kubernetes/creating-a-linux-master.md" target="_blank">here</a></li>
<li>[Optional] CNI network plugin installed.</li>
</ol>

<h5 id="windows-host-setup">Windows Host Setup</h5>

<ol>
<li>Windows Server container host running the required Windows Server and Docker versions. Follow the setup instructions outlined by this help topic: <a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/quick-start/quick-start-windows-server" target="_blank">https://docs.microsoft.com/en-us/virtualization/windowscontainers/quick-start/quick-start-windows-server</a>.</li>
<li><a href="#get-windows-binaries">Get Windows Binaries</a> kubelet.exe, kube-proxy.exe, and kubectl.exe using instructions</li>
<li>Copy Node spec file (kube config) from Linux master node with X.509 keys</li>
<li>Create the HNS Network, ensure the correct CNI network config, and start kubelet.exe using this script <a href="https://github.com/Microsoft/SDN/blob/master/Kubernetes/windows/start-kubelet.ps1" target="_blank">start-kubelet.ps1</a></li>
<li>Start kube-proxy using this script <a href="https://github.com/Microsoft/SDN/blob/master/Kubernetes/windows/start-kubeproxy.ps1" target="_blank">start-kubeproxy.ps1</a></li>
<li>[Only required for #2 Host-Gateway mode] Add static routes on Windows host using this script <a href="https://github.com/Microsoft/SDN/blob/master/Kubernetes/windows/AddRoutes.ps1" target="_blank">AddRoutes.ps1</a></li>
</ol>

<p>More detailed instructions can be found <a href="https://github.com/MicrosoftDocs/Virtualization-Documentation/blob/live/virtualization/windowscontainers/kubernetes/getting-started-kubernetes-windows.md" target="_blank">here</a>.</p>

<p><strong>Windows CNI Config Example</strong>
Today, Windows CNI plugin is based on wincni.exe code with the following example, configuration file. This is based on the ToR example diagram shown above, specifying the configuration to apply to Windows node-1. Of special interest is Windows node-1 pod CIDR (10.10.187.64/26) and the associated gateway of cbr0 (10.10.187.66). The exception list is specifying the Service CIDR (11.0.0.0/8), Cluster CIDR (10.10.0.0/16), and Management (or Host) CIDR (10.127.132.128/25).</p>

<p>Note: this file assumes that a user previous created &lsquo;l2bridge&rsquo; host networks on each Windows node using <code>&lt;Verb&gt;-HNSNetwork</code> cmdlets as shown in the <code>start-kubelet.ps1</code> and <code>start-kubeproxy.ps1</code> scripts linked above</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#008000;font-weight:bold">&#34;cniVersion&#34;</span>: <span style="color:#b44">&#34;0.2.0&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;name&#34;</span>: <span style="color:#b44">&#34;l2bridge&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;type&#34;</span>: <span style="color:#b44">&#34;wincni.exe&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;master&#34;</span>: <span style="color:#b44">&#34;Ethernet&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;ipam&#34;</span>: {
        <span style="color:#008000;font-weight:bold">&#34;environment&#34;</span>: <span style="color:#b44">&#34;azure&#34;</span>,
        <span style="color:#008000;font-weight:bold">&#34;subnet&#34;</span>: <span style="color:#b44">&#34;10.10.187.64/26&#34;</span>,
        <span style="color:#008000;font-weight:bold">&#34;routes&#34;</span>: [{
            <span style="color:#008000;font-weight:bold">&#34;GW&#34;</span>: <span style="color:#b44">&#34;10.10.187.66&#34;</span>
        }]
    },
    <span style="color:#008000;font-weight:bold">&#34;dns&#34;</span>: {
        <span style="color:#008000;font-weight:bold">&#34;Nameservers&#34;</span>: [
            <span style="color:#b44">&#34;11.0.0.10&#34;</span>
        ]
    },
    <span style="color:#008000;font-weight:bold">&#34;AdditionalArgs&#34;</span>: [{
            <span style="color:#008000;font-weight:bold">&#34;Name&#34;</span>: <span style="color:#b44">&#34;EndpointPolicy&#34;</span>,
            <span style="color:#008000;font-weight:bold">&#34;Value&#34;</span>: {
                <span style="color:#008000;font-weight:bold">&#34;Type&#34;</span>: <span style="color:#b44">&#34;OutBoundNAT&#34;</span>,
                <span style="color:#008000;font-weight:bold">&#34;ExceptionList&#34;</span>: [
                    <span style="color:#b44">&#34;11.0.0.0/8&#34;</span>,
                    <span style="color:#b44">&#34;10.10.0.0/16&#34;</span>,
                    <span style="color:#b44">&#34;10.127.132.128/25&#34;</span>
                ]
            }
        },
        {
            <span style="color:#008000;font-weight:bold">&#34;Name&#34;</span>: <span style="color:#b44">&#34;EndpointPolicy&#34;</span>,
            <span style="color:#008000;font-weight:bold">&#34;Value&#34;</span>: {
                <span style="color:#008000;font-weight:bold">&#34;Type&#34;</span>: <span style="color:#b44">&#34;ROUTE&#34;</span>,
                <span style="color:#008000;font-weight:bold">&#34;DestinationPrefix&#34;</span>: <span style="color:#b44">&#34;11.0.0.0/8&#34;</span>,
                <span style="color:#008000;font-weight:bold">&#34;NeedEncap&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>
            }
        },
        {
            <span style="color:#008000;font-weight:bold">&#34;Name&#34;</span>: <span style="color:#b44">&#34;EndpointPolicy&#34;</span>,
            <span style="color:#008000;font-weight:bold">&#34;Value&#34;</span>: {
                <span style="color:#008000;font-weight:bold">&#34;Type&#34;</span>: <span style="color:#b44">&#34;ROUTE&#34;</span>,
                <span style="color:#008000;font-weight:bold">&#34;DestinationPrefix&#34;</span>: <span style="color:#b44">&#34;10.127.132.213/32&#34;</span>,
                <span style="color:#008000;font-weight:bold">&#34;NeedEncap&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>
            }
        }
    ]
}</code></pre></div>
<h4 id="dns-configurations">DNS configurations</h4>

<p>DNS configurations for Windows containers are set by CNI plugins which support <code>dns</code> capabilities. To enable <code>dns</code> capabilities, the following options should be included in the CNI configuration file:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="">...</span>
    <span style="color:#008000;font-weight:bold">&#34;capabilities&#34;</span>: {<span style="color:#008000;font-weight:bold">&#34;dns&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>},
}</code></pre></div>
<p>The following DNS options from kubelet will be passed to CNI plugins:</p>

<ul>
<li>servers: List of DNS servers.</li>
<li>searches: List of DNS search domains.</li>
<li>options: List of DNS options.</li>
</ul>

<p>e.g.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#b44">&#34;dns&#34;</span> {
  <span style="color:#008000;font-weight:bold">&#34;servers&#34;</span>: [<span style="color:#b44">&#34;10.0.0.10&#34;</span>],
  <span style="color:#008000;font-weight:bold">&#34;searches&#34;</span>: [<span style="color:#b44">&#34;default.svc.cluster.local&#34;</span>,<span style="color:#b44">&#34;svc.cluster.local&#34;</span>,<span style="color:#b44">&#34;cluster.local&#34;</span>],
  <span style="color:#008000;font-weight:bold">&#34;options&#34;</span>: []
}</code></pre></div>
<h4 id="for-3-open-vswitch-ovs-open-virtual-network-ovn-with-overlay">For 3. Open vSwitch (OVS) &amp; Open Virtual Network (OVN) with Overlay</h4>

<blockquote class="note">
  <div><strong>Note:</strong> Fully automated setup via Ansible playbooks is <a href="https://github.com/openvswitch/ovn-kubernetes/tree/master/contrib" target="_blank">available</a>.</div>
</blockquote>


<p>For manual setup, continue the following steps.</p>

<h5 id="linux-host-setup-1">Linux Host Setup</h5>

<p>Setting up the central node and the components needed is out of scope of this document. You can read <a href="https://github.com/openvswitch/ovn-kubernetes#k8s-master-node-initialization" target="_blank">these instructions</a> for that.</p>

<p>Adding a Linux minion is also out of scope and you can read it here: <a href="https://github.com/openvswitch/ovn-kubernetes#k8s-minion-node-initializations" target="_blank">Linux minion</a>.</p>

<h5 id="windows-host-setup-1">Windows Host Setup</h5>

<p>Adding a Windows minion requires you to install OVS and OVN binaries. Windows Server container host running the required Windows Server and Docker versions. Follow the setup instructions outlined by <a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/quick-start/quick-start-windows-server" target="_blank">this help topic</a>. This type of deployment is supported starting with Windows Server 2016 RTM.</p>

<p>Compiling OVS and generating the installer will not be treated in this document. For a step by step instruction please visit <a href="http://docs.openvswitch.org/en/latest/intro/install/windows/#open-vswitch-on-windows" target="_blank">this link</a>.
For a prebuilt certified installer please visit <a href="https://cloudbase.it/openvswitch/#download" target="_blank">this link</a> and download the latest version of it.</p>

<p>The following guide uses the prebuilt certified installer.</p>

<p>Installing OVS can be done either via the GUI dialogs or unattended. Adding a Windows host to your setup requires you to have <code>OVN Host</code> together with the default installation features. Below is the dialog image on what needs to be installed:</p>

<p><img src="OVN_OVS_Windows_Installer.png" alt="OVN OVS Windows Installer" /></p>

<p>For an unattended installation please use the following command:</p>

<pre><code>cmd /c 'msiexec /i openvswitch.msi ADDLOCAL=&quot;OpenvSwitchCLI,OpenvSwitchDriver,OVNHost&quot; /qn'
</code></pre>

<p>The installer propagates new environment variables. Please open a new command shell or logoff/logon to ensure the environment variables are refreshed.</p>

<p>For overlay, OVS on Windows requires a transparent docker network to function properly. Please use the following to create a transparent docker network which will be used by OVS. From powershell:</p>

<pre><code>docker network create -d transparent --gateway $GATEWAY_IP --subnet $SUBNET `
    -o com.docker.network.windowsshim.interface=&quot;$INTERFACE_ALIAS&quot; external
</code></pre>

<p>Where $SUBNET is the minion subnet which will be used to spawn pods on (the one which will be used by kubernetes), $GATEWAY_IP is the first IP of the $SUBNET and $INTERFACE_ALIAS is the interface used for creating the overlay tunnels (must have connectivity with the rests of the OVN hosts).
Example:</p>

<pre><code>docker network create -d transparent --gateway 10.0.1.1 --subnet 10.0.1.0/24 `
    -o com.docker.network.windowsshim.interface=&quot;Ethernet0&quot; external
</code></pre>

<p>After creating the docker network please run the next commands from powershell. (creates an OVS bridge, adds the interface under the bridge and enables the OVS forwarding switch extension)</p>

<pre><code>$a = Get-NetAdapter | where Name -Match HNSTransparent
Rename-NetAdapter $a[0].Name -NewName HNSTransparent
Stop-Service ovs-vswitchd -force; Disable-VMSwitchExtension &quot;Cloudbase Open vSwitch Extension&quot;;
ovs-vsctl --no-wait del-br br-ex
ovs-vsctl --no-wait --may-exist add-br br-ex
ovs-vsctl --no-wait add-port br-ex HNSTransparent -- set interface HNSTransparent type=internal
ovs-vsctl --no-wait add-port br-ex $INTERFACE_ALIAS
Enable-VMSwitchExtension &quot;Cloudbase Open vSwitch Extension&quot;; sleep 2; Restart-Service ovs-vswitchd
</code></pre>

<p>Besides of the above, setting up a Windows host is the same as the Linux host. Follow the steps from <a href="https://github.com/openvswitch/ovn-kubernetes#k8s-minion-node-initializations" target="_blank">here</a>.</p>

<p><strong>Windows CNI Setup</strong></p>

<p>Today, Windows OVN&amp;OVS CNI plugin is based on ovn_cni.exe which can be downloaded from <a href="https://cloudbase.it/downloads/ovn_cni.exe" target="_blank">here</a>. A sample of CNI config file is the following:</p>

<pre><code>{
    &quot;name&quot;: &quot;net&quot;,
    &quot;type&quot;: &quot;ovn_cni.exe&quot;,
    &quot;bridge&quot;: &quot;br-int&quot;,
    &quot;isGateway&quot;: &quot;true&quot;,
    &quot;ipMasq&quot;: &quot;false&quot;,
    &quot;ipam&quot;: {
         &quot;type&quot;: &quot;host-local&quot;,
         &quot;subnet&quot;: &quot;$SUBNET&quot;
         }
}
</code></pre>

<p>Where $SUBNET is the subnet that was used in the previous <code>docker network create</code> command.</p>

<p>For a complete guide on Google Cloud Platform (GCP), namely Google Compute Engine (GCE) visit <a href="https://github.com/apprenda/kubernetes-ovn-heterogeneous-cluster#heterogeneous-kubernetes-cluster-on-top-of-ovn" target="_blank">this</a>.</p>

<p>For a complete guide on Amazon Web Services (AWS) visit <a href="https://github.com/justeat/kubernetes-windows-aws-ovs#kubernetes-on-windows-in-aws-using-ovn" target="_blank">this</a>.</p>

<h2 id="starting-the-cluster">Starting the Cluster</h2>

<p>To start your cluster, you&rsquo;ll need to start both the Linux-based Kubernetes control plane, and the Windows Server-based Kubernetes node components (kubelet and kube-proxy). For the OVS &amp; OVN only the kubelet is required.</p>

<h2 id="starting-the-linux-based-control-plane">Starting the Linux-based Control Plane</h2>

<p>Use your preferred method to start Kubernetes cluster on Linux. Please note that Cluster CIDR might need to be updated.</p>

<h2 id="support-for-kubeadm-join">Support for kubeadm join</h2>

<p>If your cluster has been created by <a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/" target="_blank">kubeadm</a>,
and your networking is setup correctly using one of the methods listed above (networking is setup outside of kubeadm), you can use kubeadm to add a Windows node to your cluster. At a high level, you first have to initialize the master with kubeadm (Linux), then set up the CNI based networking (outside of kubeadm), and finally start joining Windows or Linux worker nodes to the cluster. For additional documentation and reference material, visit the kubeadm link above.</p>

<p>The kubeadm binary can be found at <a href="https://github.com/kubernetes/kubernetes/releases" target="_blank">Kubernetes Releases</a>, inside the node binaries archive. Adding a Windows node is not any different than adding a Linux node:</p>

<p><code>kubeadm.exe join --token &lt;token&gt; &lt;master-ip&gt;:&lt;master-port&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt;</code></p>

<p>See <a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#joining-your-nodes" target="_blank">joining-your-nodes</a> for more details.</p>

<h2 id="supported-features">Supported Features</h2>

<p>The examples listed below assume running Windows nodes on Windows Server 1709. If you are running Windows Server 2016, the examples will need the image updated to specify <code>image: microsoft/windowsservercore:ltsc2016</code>. This is due to the requirement for container images to match the host operating system version when using process isolation. Not specifying a tag will implicitly use the <code>:latest</code> tag which can lead to surprising behaviors. Please consult with <a href="https://hub.docker.com/r/microsoft/windowsservercore/" target="_blank">https://hub.docker.com/r/microsoft/windowsservercore/</a> for additional information on Windows Server Core image tagging.</p>

<h3 id="scheduling-pods-on-windows">Scheduling Pods on Windows</h3>

<p>Because your cluster has both Linux and Windows nodes, you must explicitly set the <code>nodeSelector</code> constraint to be able to schedule pods to Windows nodes. You must set nodeSelector with the label <code>beta.kubernetes.io/os</code> to the value <code>windows</code>; see the following example:</p>



 













<table class="includecode" id="windows-simple-pod-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/simple-pod.yaml" download="windows/simple-pod.yaml">
                    <code>windows/simple-pod.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-simple-pod-yaml')" title="Copy windows/simple-pod.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">  </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">      </span>image:<span style="color:#bbb"> </span>microsoft/iis:windowsservercore-<span style="color:#666">1709</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>ports:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>-<span style="color:#bbb"> </span>containerPort:<span style="color:#bbb"> </span><span style="color:#666">80</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>nodeSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;beta.kubernetes.io/os&#34;</span>:<span style="color:#bbb"> </span>windows<span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<blockquote class="note">
  <div><strong>Note:</strong> This example assumes you are running on Windows Server 1709, so uses the image tag to support that. If you are on a different version, you will need to update the tag. For example, if on Windows Server 2016, update to use <code>&quot;image&quot;: &quot;microsoft/iis&quot;</code> which will default to that OS version.</div>
</blockquote>


<h3 id="secrets-and-configmaps">Secrets and ConfigMaps</h3>

<p>Secrets and ConfigMaps can be utilized in Windows Server Containers, but must be used as environment variables. See limitations section below for additional details.</p>

<p><strong>Examples:</strong></p>

<p>Windows pod with secrets mapped to environment variables</p>



 













<table class="includecode" id="windows-secret-pod-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/secret-pod.yaml" download="windows/secret-pod.yaml">
                    <code>windows/secret-pod.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-secret-pod-yaml')" title="Copy windows/secret-pod.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Secret<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>mysecret<span style="color:#bbb">
</span><span style="color:#bbb"></span>type:<span style="color:#bbb"> </span>Opaque<span style="color:#bbb">
</span><span style="color:#bbb"></span>data:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>username:<span style="color:#bbb"> </span>YWRtaW4=<span style="color:#bbb">
</span><span style="color:#bbb">  </span>password:<span style="color:#bbb"> </span>MWYyZDFlMmU2N2Rm<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>--<span style="color:#b44;font-style:italic">-
</span><span style="color:#b44;font-style:italic">
</span><span style="color:#b44;font-style:italic">apiVersion: v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>my-secret-pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-secret-pod<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>microsoft/windowsservercore:<span style="color:#666">1709</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>env:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>USERNAME<span style="color:#bbb">
</span><span style="color:#bbb">        </span>valueFrom:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>secretKeyRef:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>name:<span style="color:#bbb"> </span>mysecret<span style="color:#bbb">
</span><span style="color:#bbb">            </span>key:<span style="color:#bbb"> </span>username<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>PASSWORD<span style="color:#bbb">
</span><span style="color:#bbb">        </span>valueFrom:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>secretKeyRef:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>name:<span style="color:#bbb"> </span>mysecret<span style="color:#bbb">
</span><span style="color:#bbb">            </span>key:<span style="color:#bbb"> </span>password<span style="color:#bbb">
</span><span style="color:#bbb">  </span>nodeSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>beta.kubernetes.io/os:<span style="color:#bbb"> </span>windows<span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<p>Windows Pod with configMap values mapped to environment variables</p>



 













<table class="includecode" id="windows-configmap-pod-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/configmap-pod.yaml" download="windows/configmap-pod.yaml">
                    <code>windows/configmap-pod.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-configmap-pod-yaml')" title="Copy windows/configmap-pod.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">kind:<span style="color:#bbb"> </span>ConfigMap<span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>example-config<span style="color:#bbb">
</span><span style="color:#bbb"></span>data:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>example.property.<span style="color:#666">1</span>:<span style="color:#bbb"> </span>hello<span style="color:#bbb">
</span><span style="color:#bbb">  </span>example.property.<span style="color:#666">2</span>:<span style="color:#bbb"> </span>world<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>--<span style="color:#b44;font-style:italic">-
</span><span style="color:#b44;font-style:italic">
</span><span style="color:#b44;font-style:italic">apiVersion: v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>configmap-pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>configmap-redis<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>redis:<span style="color:#666">3.0</span>-nanoserver<span style="color:#bbb">
</span><span style="color:#bbb">    </span>env:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>EXAMPLE_PROPERTY_1<span style="color:#bbb">
</span><span style="color:#bbb">        </span>valueFrom:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>configMapKeyRef:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>name:<span style="color:#bbb"> </span>example-config<span style="color:#bbb">
</span><span style="color:#bbb">            </span>key:<span style="color:#bbb"> </span>example.property.<span style="color:#666">1</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>EXAMPLE_PROPERTY_2<span style="color:#bbb">
</span><span style="color:#bbb">        </span>valueFrom:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>configMapKeyRef:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>name:<span style="color:#bbb"> </span>example-config<span style="color:#bbb">
</span><span style="color:#bbb">            </span>key:<span style="color:#bbb"> </span>example.property.<span style="color:#666">2</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>nodeSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>beta.kubernetes.io/os:<span style="color:#bbb"> </span>windows</code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<h3 id="volumes">Volumes</h3>

<p>Some supported Volume Mounts are local, emptyDir, hostPath.  One thing to remember is that paths must either be escaped, or use forward slashes, for example <code>mountPath: &quot;C:\\etc\\foo&quot;</code> or <code>mountPath: &quot;C:/etc/foo&quot;</code>.</p>

<p>Persistent Volume Claims are supported for supported volume types.</p>

<p><strong>Examples:</strong></p>

<p>Windows pod with a hostPath volume</p>



 













<table class="includecode" id="windows-hostpath-volume-pod-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/hostpath-volume-pod.yaml" download="windows/hostpath-volume-pod.yaml">
                    <code>windows/hostpath-volume-pod.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-hostpath-volume-pod-yaml')" title="Copy windows/hostpath-volume-pod.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>hostpath-volume-pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-hostpath-volume-pod<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>microsoft/windowsservercore:<span style="color:#666">1709</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">      </span>mountPath:<span style="color:#bbb"> </span><span style="color:#b44">&#34;C:\\etc\\foo&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>readOnly:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>nodeSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>beta.kubernetes.io/os:<span style="color:#bbb"> </span>windows<span style="color:#bbb">
</span><span style="color:#bbb">  </span>volumes:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">    </span>hostPath:<span style="color:#bbb">
</span><span style="color:#bbb">     </span>path:<span style="color:#bbb"> </span><span style="color:#b44">&#34;C:\\etc\\foo&#34;</span><span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<p>Windows pod with multiple emptyDir volumes</p>



 













<table class="includecode" id="windows-emptydir-pod-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/emptydir-pod.yaml" download="windows/emptydir-pod.yaml">
                    <code>windows/emptydir-pod.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-emptydir-pod-yaml')" title="Copy windows/emptydir-pod.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#bbb"> </span>apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"> </span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"> </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">   </span>name:<span style="color:#bbb"> </span>my-empty-dir-pod<span style="color:#bbb">
</span><span style="color:#bbb"> </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">   </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">   </span>-<span style="color:#bbb"> </span>image:<span style="color:#bbb"> </span>microsoft/windowsservercore:<span style="color:#666">1709</span><span style="color:#bbb">
</span><span style="color:#bbb">     </span>name:<span style="color:#bbb"> </span>my-empty-dir-pod<span style="color:#bbb">
</span><span style="color:#bbb">     </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">     </span>-<span style="color:#bbb"> </span>mountPath:<span style="color:#bbb"> </span>/cache<span style="color:#bbb">
</span><span style="color:#bbb">       </span>name:<span style="color:#bbb"> </span>cache-volume<span style="color:#bbb">
</span><span style="color:#bbb">     </span>-<span style="color:#bbb"> </span>mountPath:<span style="color:#bbb"> </span>C:/scratch<span style="color:#bbb">
</span><span style="color:#bbb">       </span>name:<span style="color:#bbb"> </span>scratch-volume<span style="color:#bbb">
</span><span style="color:#bbb">   </span>volumes:<span style="color:#bbb">
</span><span style="color:#bbb">   </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>cache-volume<span style="color:#bbb">
</span><span style="color:#bbb">     </span>emptyDir:<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span><span style="color:#bbb">   </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>scratch-volume<span style="color:#bbb">
</span><span style="color:#bbb">     </span>emptyDir:<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span><span style="color:#bbb">   </span>nodeSelector:<span style="color:#bbb">
</span><span style="color:#bbb">     </span>beta.kubernetes.io/os:<span style="color:#bbb"> </span>windows<span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<h3 id="daemonsets">DaemonSets</h3>

<p>DaemonSets are supported</p>



 













<table class="includecode" id="windows-daemonset-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/daemonset.yaml" download="windows/daemonset.yaml">
                    <code>windows/daemonset.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-daemonset-yaml')" title="Copy windows/daemonset.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>DaemonSet<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>my-daemonset<span style="color:#bbb">
</span><span style="color:#bbb">  </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>app:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>selector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchLabels:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>app:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">  </span>template:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>app:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">    </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">        </span>image:<span style="color:#bbb"> </span>microsoft/windowsservercore:<span style="color:#666">1709</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>nodeSelector:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>beta.kubernetes.io/os:<span style="color:#bbb"> </span>windows<span style="color:#bbb">
</span><span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<h3 id="metrics">Metrics</h3>

<p>Windows Stats use a hybrid model: pod and container level stats come from CRI (via dockershim), while node level stats come from the &ldquo;winstats&rdquo; package that exports cadvisor like data structures using windows specific perf counters from the node.</p>

<h3 id="container-resources">Container Resources</h3>

<p>Container resources (CPU and memory) could be set now for windows containers in v1.10.</p>



 













<table class="includecode" id="windows-deploy-resource-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/deploy-resource.yaml" download="windows/deploy-resource.yaml">
                    <code>windows/deploy-resource.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-deploy-resource-yaml')" title="Copy windows/deploy-resource.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Deployment<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>replicas:<span style="color:#bbb"> </span><span style="color:#666">3</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>selector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchLabels:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>app:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">  </span>template:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>app:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">    </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">        </span>image:<span style="color:#bbb"> </span>microsoft/iis<span style="color:#bbb">
</span><span style="color:#bbb">        </span>resources:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>limits:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>memory:<span style="color:#bbb"> </span><span style="color:#b44">&#34;128Mi&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>cpu:<span style="color:#bbb"> </span><span style="color:#666">2</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>ports:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>-<span style="color:#bbb"> </span>containerPort:<span style="color:#bbb"> </span><span style="color:#666">80</span><span style="color:#bbb">
</span><span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<h3 id="hyper-v-containers">Hyper-V Containers</h3>

<p>Hyper-V containers are supported as experimental in v1.10. To create a Hyper-V container, kubelet should be started with feature gates <code>HyperVContainer=true</code> and Pod should include annotation <code>experimental.windows.kubernetes.io/isolation-type=hyperv</code>.</p>



 













<table class="includecode" id="windows-deploy-hyperv-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/deploy-hyperv.yaml" download="windows/deploy-hyperv.yaml">
                    <code>windows/deploy-hyperv.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-deploy-hyperv-yaml')" title="Copy windows/deploy-hyperv.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Deployment<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>selector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchLabels:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>app:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">  </span>replicas:<span style="color:#bbb"> </span><span style="color:#666">3</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>template:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>app:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">      </span>annotations:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>experimental.windows.kubernetes.io/isolation-type:<span style="color:#bbb"> </span>hyperv<span style="color:#bbb">
</span><span style="color:#bbb">    </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">        </span>image:<span style="color:#bbb"> </span>microsoft/iis<span style="color:#bbb">
</span><span style="color:#bbb">        </span>ports:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>-<span style="color:#bbb"> </span>containerPort:<span style="color:#bbb"> </span><span style="color:#666">80</span><span style="color:#bbb">
</span><span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<h3 id="kubelet-and-kube-proxy-can-now-run-as-windows-services">Kubelet and kube-proxy can now run as Windows services</h3>

<p>Starting with kubernetes v1.11, kubelet and kube-proxy can run as Windows services.</p>

<p>This means that you can now register them as Windows services via <code>sc</code> command. More details about how to create Windows services with <code>sc</code> can be found <a href="https://support.microsoft.com/en-us/help/251192/how-to-create-a-windows-service-by-using-sc-exe" target="_blank">here</a>.</p>

<p><strong>Examples:</strong></p>

<p>To create the service:</p>

<pre><code>PS &gt; sc.exe create &lt;component_name&gt; binPath= &quot;&lt;path_to_binary&gt; --windows-service &lt;other_args&gt;&quot;
CMD &gt; sc create &lt;component_name&gt; binPath= &quot;&lt;path_to_binary&gt; --windows-service &lt;other_args&gt;&quot;
</code></pre>

<p>Please note that if the arguments contain spaces, it must be escaped. Example:</p>

<pre><code>PS &gt; sc.exe create kubelet binPath= &quot;C:\kubelet.exe --windows-service --hostname-override 'minion' &lt;other_args&gt;&quot;
CMD &gt; sc create kubelet binPath= &quot;C:\kubelet.exe --windows-service --hostname-override 'minion' &lt;other_args&gt;&quot;
</code></pre>

<p>To start the service:</p>

<pre><code>PS &gt; Start-Service kubelet; Start-Service kube-proxy
CMD &gt; net start kubelet &amp;&amp; net start kube-proxy
</code></pre>

<p>To stop the service:</p>

<pre><code>PS &gt; Stop-Service kubelet (-Force); Stop-Service kube-proxy (-Force)
CMD &gt; net stop kubelet &amp;&amp; net stop kube-proxy
</code></pre>

<p>To query the service:</p>

<pre><code>PS &gt; Get-Service kubelet; Get-Service kube-proxy;
CMD &gt; sc.exe queryex kubelet &amp;&amp; sc qc kubelet &amp;&amp; sc.exe queryex kube-proxy &amp;&amp; sc.exe qc kube-proxy
</code></pre>

<h2 id="known-limitations-for-windows-server-containers-with-v1-9">Known Limitations for Windows Server Containers with v1.9</h2>

<p>Some of these limitations will be addressed by the community in future releases of Kubernetes:</p>

<ul>
<li>Shared network namespace (compartment) with multiple Windows Server containers (shared kernel) per pod is only supported on Windows Server 1709 or later</li>
<li>Using Secrets and ConfigMaps as volume mounts is not supported</li>
<li>Mount propagation is not supported on Windows</li>
<li>The StatefulSet functionality for stateful applications is not supported</li>
<li>Horizontal Pod Autoscaling for Windows Server Container pods has not been verified to work end-to-end</li>
<li>Hyper-V isolated containers are not supported.</li>
<li>Windows container OS must match the Host OS. If it does not, the pod will get stuck in a crash loop.</li>
<li>Under the networking models of L3 or Host GW, Kubernetes Services are inaccessible to Windows nodes due to a Windows issue. This is not an issue if using OVN/OVS for networking.</li>
<li>Windows kubelet.exe may fail to start when running on Windows Server under VMware Fusion <a href="https://github.com/kubernetes/kubernetes/pull/57124" target="_blank">issue 57110</a></li>
<li>Flannel and Weavenet are not yet supported</li>
<li>Some .Net Core applications expect environment variables with a colon (<code>:</code>) in the name. Kubernetes currently does not allow this.  Replace colon (<code>:</code>) with  double underscore (<code>__</code>) as documented <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?tabs=basicconfiguration#configuration-by-environment" target="_blank">here</a>.</li>
<li>As cgroups are not supported on windows, kubelet.exe should be started with the following additional arguments <code>--cgroups-per-qos=false --enforce-node-allocatable=&quot;&quot;</code> <a href="https://github.com/kubernetes/kubernetes/issues/61716" target="_blank">issue 61716</a></li>
</ul>

<h2 id="next-steps-and-resources">Next steps and resources</h2>

<ul>
<li>Support for Windows is in Beta as of v1.9 and your feedback is welcome. For information on getting involved, please head to <a href="https://github.com/kubernetes/community/blob/master/sig-windows/README.md" target="_blank">SIG-Windows</a></li>
<li>Troubleshooting and Common Problems: <a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/kubernetes/common-problems" target="_blank">Link</a></li>
</ul>



	 


  
  <h2>Feedback</h2>
  <p class="feedback--prompt">Was this page helpful? </p>
  <button class="button feedback--yes">Yes</button>
  <button class="button feedback--no">No</button>
  <p class="feedback--response feedback--response__hidden">
    Thanks for the feedback. If you have a specific, answerable question about how to use Kubernetes,
    ask it on <a target="_blank" rel="noopener"
    href="https://stackoverflow.com/questions/tagged/kubernetes">Stack Overflow</a>. Open
    an issue in the GitHub repo if you want to <a class="feedback--link" target="_blank" rel="noopener"
    href="https://github.com/kubernetes/website/issues/new?title=Issue%20with%20k8s.io">report a problem</a> or
    <a class="feedback--link" target="_blank" rel="noopener"
    href="https://github.com/kubernetes/website/issues/new?title=Improvement%20for%20k8s.io">suggest an improvement</a>.
  </p>
  <script>
    const yes = document.querySelector('.feedback--yes');
    const no = document.querySelector('.feedback--no');
    document.querySelectorAll('.feedback--link').forEach(link => {
      link.href = link.href + window.location.pathname;
    });
    const sendFeedback = (value) => {
      if (!gtag) { console.log('!gtag'); }
      gtag('event', 'click', {
        'event_category': 'Helpful',
        'event_label': window.location.pathname,
        value
      });
    };
    const disableButtons = () => {
      yes.disabled = true;
      yes.classList.add('feedback--button__disabled');
      no.disabled = true;
      no.classList.add('feedback--button__disabled');
    };
    yes.addEventListener('click', () => {
      sendFeedback(1);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
    no.addEventListener('click', () => {
      sendFeedback(0);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
  </script>


  <div id="pre-footer"> 
  <hr />

  <div class="issue-button-container">
    <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs%5cgetting-started-guides%5cwindows%5c_index.md?pixel" alt="Analytics" /></a></p>
    
    
    <script type="text/javascript">
    PDRTJS_settings_8345992 = {
    "id" : "8345992",
    "unique_id" : "\/docs\/getting-started-guides\/windows\/",
    "title" : "Using Windows Server Containers in Kubernetes",
    "permalink" : "https:\/\/qinlj.github.io\/docs\/getting-started-guides\/windows\/"
    };
    (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
    </script>
    <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?title=Issue%20with%20' +
    'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
    
    
    
    <a href="https://github.com/kubernetes/website/edit/master/content/en/docs%5cgetting-started-guides%5cwindows%5c_index.md" class="button issue">Edit This Page</a>
    
  </div>
  

  <div id="lastedit" class="lastedit issue-button-container">
    Page last modified on February 08, 2019 at 5:33 PM PST by
    <a href="https://github.com/kubernetes/website/commit/a8b7c759df68e43a6038260c474fbb9115d15924/">windows: Add windows prefix for windows services (#12377)</a> (<a href="https://github.com/kubernetes/website/commits/master/content/en/docs%5cgetting-started-guides%5cwindows%5c_index.md">Page History</a>)
  </div>
  
</div>

  <div class="post-comment">
    
    


<div id="lv-container" data-id="city" data-uid="MTAyMC80MzQxMi8xOTk1Mw==">
  <script type="text/javascript">
    (function(d, s) {
      var j, e = d.getElementsByTagName(s)[0];

      if (typeof LivereTower === 'function') { return; }

      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;

      e.parentNode.insertBefore(j, e);
    })(document, 'script');
  </script>
  <noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
</div>



  </div>
  
  <div class="container" role="main" itemscope itemtype="http://schema.org/Article">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
        
        
<div>
  <h5 id="tags">Tags: 
  </h5>
</div>
        
        <article role="main" class="blog-post" itemprop="articleBody" id="content">
          ...
          

<blockquote class="note">
  <div><strong>Note:</strong> These instructions were recently updated based on Windows Server platform enhancements and the Kubernetes v1.9 release</div>
</blockquote>


<p>Kubernetes version 1.5 introduced Alpha support for Windows Server
Containers based on the Windows Server 2016 operating system. With the
release of Windows Server version 1709 and using Kubernetes v1.9 users
are able to deploy a Kubernetes cluster either on-premises or in a
private/public cloud using a number of different network topologies
and CNI plugins. Some key feature improvements for Windows Server
Containers on Kubernetes include:</p>

<ul>
<li>Improved support for pods! Shared network namespace (compartment) with multiple Windows Server containers (shared kernel)</li>
<li>Reduced network complexity by using a single network endpoint per pod</li>
<li>Kernel-Based load-balancing using the Virtual Filtering Platform (VFP) Hyper-v Switch Extension (analogous to Linux iptables)</li>
<li>Container Runtime Interface (CRI) pod and node level statistics</li>
<li>Support for kubeadm commands to add Windows Server nodes to a Kubernetes environment</li>
</ul>

<p>The Kubernetes control plane (API Server, Scheduler, Controller Manager, etc) continue to run on Linux, while the kubelet and kube-proxy can be run on Windows Server 2016 or later</p>

<blockquote class="note">
  <div><strong>Note:</strong> Windows Server Containers on Kubernetes is a Beta feature in Kubernetes v1.9</div>
</blockquote>


<h2 id="get-windows-binaries">Get Windows Binaries</h2>

<p>We recommend using the release binaries that can be found at <a href="https://github.com/kubernetes/kubernetes/releases/latest" target="_blank">https://github.com/kubernetes/kubernetes/releases/latest</a>. Under the CHANGELOG you can find the Node Binaries link for Windows-amd64, which will include kubeadm, kubectl, kubelet and kube-proxy.</p>

<p>If you wish to build the code yourself, please refer to detailed build instructions <a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/kubernetes/compiling-kubernetes-binaries" target="_blank">here</a>.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>In Kubernetes version 1.9 or later, Windows Server Containers for Kubernetes are supported using the following:</p>

<ol>
<li>Kubernetes control plane running on existing Linux infrastructure (version 1.9 or later).</li>
<li>Kubenet network plugin setup on the Linux nodes.</li>
<li>Windows Server 2016 RTM or later. Windows Server version 1709 or later is preferred; it unlocks key capabilities like shared network namespace.</li>
<li>Docker Version 17.06.1-ee-2 or later for Windows Server nodes (Linux nodes and Kubernetes control plane can run any Kubernetes supported Docker Version).</li>
</ol>

<h2 id="networking">Networking</h2>

<p>There are several supported network configurations with Kubernetes v1.9 on Windows, including both Layer-3 routed and overlay topologies using third-party network plugins.</p>

<ol>
<li><a href="#upstream-l3-routing-topology">Upstream L3 Routing</a> - IP routes configured in upstream ToR</li>
<li><a href="#host-gateway-topology">Host-Gateway</a> - IP routes configured on each host</li>
<li><a href="#using-ovn-with-ovs">Open vSwitch (OVS) &amp; Open Virtual Network (OVN) with Overlay</a> - overlay networks (supports STT and Geneve tunneling types)</li>
<li>[Future - In Review] Overlay - VXLAN or IP-in-IP encapsulation using Flannel</li>
<li>[Future] Layer-3 Routing with BGP (Calico)</li>
</ol>

<p>The selection of which network configuration and topology to deploy depends on the physical network topology and a user&rsquo;s ability to configure routes, performance concerns with encapsulation, and requirement to integrate with third-party network plugins.</p>

<h3 id="future-cni-plugins">Future CNI Plugins</h3>

<p>An additional two CNI plugins [win-l2bridge (host-gateway) and win-overlay (vxlan)] are in <a href="https://github.com/containernetworking/plugins/pull/85" target="_blank">PR review</a>. These two CNI plugins, when ready, can either be used directly or with Flannel.</p>

<h3 id="linux">Linux</h3>

<p>The above networking approaches are already supported on Linux using a bridge interface, which essentially creates a private network local to the node. Similar to the Windows side, routes to all other pod CIDRs must be created in order to send packets via the &ldquo;public&rdquo; NIC.</p>

<h3 id="windows">Windows</h3>

<p>Windows supports the CNI network model and uses plugins to interface with the Windows Host Networking Service (HNS) to configure host networking and policy. At the time of this writing, the only publicly available CNI plugin from Microsoft is built from a private repo and available here <a href="https://github.com/Microsoft/SDN/blob/master/Kubernetes/windows/cni/wincni.exe" target="_blank">wincni.exe</a>. It uses an l2bridge network created through the Windows Host Networking Service (HNS) by an administrator using HNS PowerShell commands on each node as documented in the <a href="#windows-host-setup">Windows Host Setup</a> section below. Source code for the future CNI plugins will be made available publicly.</p>

<h4 id="upstream-l3-routing-topology">Upstream L3 Routing Topology</h4>

<p>In this topology, networking is achieved using L3 routing with static IP routes configured in an upstream Top of Rack (ToR) switch/router. Each cluster node is connected to the management network with a host IP. Additionally, each node uses a local &lsquo;l2bridge&rsquo; network with a pod CIDR assigned. All pods on a given worker node will be connected to the pod CIDR subnet (&lsquo;l2bridge&rsquo; network). In order to enable network communication between pods running on different nodes, the upstream router has static routes configured with pod CIDR prefix =&gt; Host IP.</p>

<p>The following example diagram illustrates the Windows Server networking setup for Kubernetes using Upstream L3 Routing Setup:
<img src="UpstreamRouting.png" alt="K8s Cluster using L3 Routing with ToR" /></p>

<h4 id="host-gateway-topology">Host-Gateway Topology</h4>

<p>This topology is similar to the Upstream L3 Routing topology with the only difference being that static IP routes are configured directly on each cluster node and not in the upstream ToR. Each node uses a local &lsquo;l2bridge&rsquo; network with a pod CIDR assigned as before and has routing table entries for all other pod CIDR subnets assigned to the remote cluster nodes.</p>

<h4 id="using-ovn-with-ovs">Using OVN with OVS</h4>

<p>The following diagram gives a general overview of the architecture and interaction between components:</p>

<p><img src="ovn_kubernetes.png" alt="Overlay using OVN controller and OVS Switch Extension" /></p>

<p>(The above image is from <a href="https://github.com/openvswitch/ovn-kubernetes#overlay-mode-architecture-diagram" target="_blank">https://github.com/openvswitch/ovn-kubernetes#overlay-mode-architecture-diagram</a>)</p>

<p>Due to its architecture, OVN has a central component which stores your networking intent in a database. Other components i.e. kube-apiserver, kube-controller-manager, kube-scheduler etc. can be deployed on that central node as well.</p>

<h2 id="setting-up-windows-server-containers-on-kubernetes">Setting up Windows Server Containers on Kubernetes</h2>

<p>To run Windows Server Containers on Kubernetes, you&rsquo;ll need to set up both your host machines and the Kubernetes node components for Windows. Depending on your network topology, routes may need to be set up for pod communication on different nodes.</p>

<h3 id="host-setup">Host Setup</h3>

<h4 id="for-1-upstream-l3-routing-topology-and-2-host-gateway-topology">For 1. Upstream L3 Routing Topology and 2. Host-Gateway Topology</h4>

<h5 id="linux-host-setup">Linux Host Setup</h5>

<ol>
<li>Linux hosts should be setup according to their respective distro documentation and the requirements of the Kubernetes version you will be using.</li>
<li>Configure Linux Master node using steps <a href="https://github.com/MicrosoftDocs/Virtualization-Documentation/blob/live/virtualization/windowscontainers/kubernetes/creating-a-linux-master.md" target="_blank">here</a></li>
<li>[Optional] CNI network plugin installed.</li>
</ol>

<h5 id="windows-host-setup">Windows Host Setup</h5>

<ol>
<li>Windows Server container host running the required Windows Server and Docker versions. Follow the setup instructions outlined by this help topic: <a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/quick-start/quick-start-windows-server" target="_blank">https://docs.microsoft.com/en-us/virtualization/windowscontainers/quick-start/quick-start-windows-server</a>.</li>
<li><a href="#get-windows-binaries">Get Windows Binaries</a> kubelet.exe, kube-proxy.exe, and kubectl.exe using instructions</li>
<li>Copy Node spec file (kube config) from Linux master node with X.509 keys</li>
<li>Create the HNS Network, ensure the correct CNI network config, and start kubelet.exe using this script <a href="https://github.com/Microsoft/SDN/blob/master/Kubernetes/windows/start-kubelet.ps1" target="_blank">start-kubelet.ps1</a></li>
<li>Start kube-proxy using this script <a href="https://github.com/Microsoft/SDN/blob/master/Kubernetes/windows/start-kubeproxy.ps1" target="_blank">start-kubeproxy.ps1</a></li>
<li>[Only required for #2 Host-Gateway mode] Add static routes on Windows host using this script <a href="https://github.com/Microsoft/SDN/blob/master/Kubernetes/windows/AddRoutes.ps1" target="_blank">AddRoutes.ps1</a></li>
</ol>

<p>More detailed instructions can be found <a href="https://github.com/MicrosoftDocs/Virtualization-Documentation/blob/live/virtualization/windowscontainers/kubernetes/getting-started-kubernetes-windows.md" target="_blank">here</a>.</p>

<p><strong>Windows CNI Config Example</strong>
Today, Windows CNI plugin is based on wincni.exe code with the following example, configuration file. This is based on the ToR example diagram shown above, specifying the configuration to apply to Windows node-1. Of special interest is Windows node-1 pod CIDR (10.10.187.64/26) and the associated gateway of cbr0 (10.10.187.66). The exception list is specifying the Service CIDR (11.0.0.0/8), Cluster CIDR (10.10.0.0/16), and Management (or Host) CIDR (10.127.132.128/25).</p>

<p>Note: this file assumes that a user previous created &lsquo;l2bridge&rsquo; host networks on each Windows node using <code>&lt;Verb&gt;-HNSNetwork</code> cmdlets as shown in the <code>start-kubelet.ps1</code> and <code>start-kubeproxy.ps1</code> scripts linked above</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#008000;font-weight:bold">&#34;cniVersion&#34;</span>: <span style="color:#b44">&#34;0.2.0&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;name&#34;</span>: <span style="color:#b44">&#34;l2bridge&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;type&#34;</span>: <span style="color:#b44">&#34;wincni.exe&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;master&#34;</span>: <span style="color:#b44">&#34;Ethernet&#34;</span>,
    <span style="color:#008000;font-weight:bold">&#34;ipam&#34;</span>: {
        <span style="color:#008000;font-weight:bold">&#34;environment&#34;</span>: <span style="color:#b44">&#34;azure&#34;</span>,
        <span style="color:#008000;font-weight:bold">&#34;subnet&#34;</span>: <span style="color:#b44">&#34;10.10.187.64/26&#34;</span>,
        <span style="color:#008000;font-weight:bold">&#34;routes&#34;</span>: [{
            <span style="color:#008000;font-weight:bold">&#34;GW&#34;</span>: <span style="color:#b44">&#34;10.10.187.66&#34;</span>
        }]
    },
    <span style="color:#008000;font-weight:bold">&#34;dns&#34;</span>: {
        <span style="color:#008000;font-weight:bold">&#34;Nameservers&#34;</span>: [
            <span style="color:#b44">&#34;11.0.0.10&#34;</span>
        ]
    },
    <span style="color:#008000;font-weight:bold">&#34;AdditionalArgs&#34;</span>: [{
            <span style="color:#008000;font-weight:bold">&#34;Name&#34;</span>: <span style="color:#b44">&#34;EndpointPolicy&#34;</span>,
            <span style="color:#008000;font-weight:bold">&#34;Value&#34;</span>: {
                <span style="color:#008000;font-weight:bold">&#34;Type&#34;</span>: <span style="color:#b44">&#34;OutBoundNAT&#34;</span>,
                <span style="color:#008000;font-weight:bold">&#34;ExceptionList&#34;</span>: [
                    <span style="color:#b44">&#34;11.0.0.0/8&#34;</span>,
                    <span style="color:#b44">&#34;10.10.0.0/16&#34;</span>,
                    <span style="color:#b44">&#34;10.127.132.128/25&#34;</span>
                ]
            }
        },
        {
            <span style="color:#008000;font-weight:bold">&#34;Name&#34;</span>: <span style="color:#b44">&#34;EndpointPolicy&#34;</span>,
            <span style="color:#008000;font-weight:bold">&#34;Value&#34;</span>: {
                <span style="color:#008000;font-weight:bold">&#34;Type&#34;</span>: <span style="color:#b44">&#34;ROUTE&#34;</span>,
                <span style="color:#008000;font-weight:bold">&#34;DestinationPrefix&#34;</span>: <span style="color:#b44">&#34;11.0.0.0/8&#34;</span>,
                <span style="color:#008000;font-weight:bold">&#34;NeedEncap&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>
            }
        },
        {
            <span style="color:#008000;font-weight:bold">&#34;Name&#34;</span>: <span style="color:#b44">&#34;EndpointPolicy&#34;</span>,
            <span style="color:#008000;font-weight:bold">&#34;Value&#34;</span>: {
                <span style="color:#008000;font-weight:bold">&#34;Type&#34;</span>: <span style="color:#b44">&#34;ROUTE&#34;</span>,
                <span style="color:#008000;font-weight:bold">&#34;DestinationPrefix&#34;</span>: <span style="color:#b44">&#34;10.127.132.213/32&#34;</span>,
                <span style="color:#008000;font-weight:bold">&#34;NeedEncap&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>
            }
        }
    ]
}</code></pre></div>
<h4 id="dns-configurations">DNS configurations</h4>

<p>DNS configurations for Windows containers are set by CNI plugins which support <code>dns</code> capabilities. To enable <code>dns</code> capabilities, the following options should be included in the CNI configuration file:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="">...</span>
    <span style="color:#008000;font-weight:bold">&#34;capabilities&#34;</span>: {<span style="color:#008000;font-weight:bold">&#34;dns&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>},
}</code></pre></div>
<p>The following DNS options from kubelet will be passed to CNI plugins:</p>

<ul>
<li>servers: List of DNS servers.</li>
<li>searches: List of DNS search domains.</li>
<li>options: List of DNS options.</li>
</ul>

<p>e.g.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#b44">&#34;dns&#34;</span> {
  <span style="color:#008000;font-weight:bold">&#34;servers&#34;</span>: [<span style="color:#b44">&#34;10.0.0.10&#34;</span>],
  <span style="color:#008000;font-weight:bold">&#34;searches&#34;</span>: [<span style="color:#b44">&#34;default.svc.cluster.local&#34;</span>,<span style="color:#b44">&#34;svc.cluster.local&#34;</span>,<span style="color:#b44">&#34;cluster.local&#34;</span>],
  <span style="color:#008000;font-weight:bold">&#34;options&#34;</span>: []
}</code></pre></div>
<h4 id="for-3-open-vswitch-ovs-open-virtual-network-ovn-with-overlay">For 3. Open vSwitch (OVS) &amp; Open Virtual Network (OVN) with Overlay</h4>

<blockquote class="note">
  <div><strong>Note:</strong> Fully automated setup via Ansible playbooks is <a href="https://github.com/openvswitch/ovn-kubernetes/tree/master/contrib" target="_blank">available</a>.</div>
</blockquote>


<p>For manual setup, continue the following steps.</p>

<h5 id="linux-host-setup-1">Linux Host Setup</h5>

<p>Setting up the central node and the components needed is out of scope of this document. You can read <a href="https://github.com/openvswitch/ovn-kubernetes#k8s-master-node-initialization" target="_blank">these instructions</a> for that.</p>

<p>Adding a Linux minion is also out of scope and you can read it here: <a href="https://github.com/openvswitch/ovn-kubernetes#k8s-minion-node-initializations" target="_blank">Linux minion</a>.</p>

<h5 id="windows-host-setup-1">Windows Host Setup</h5>

<p>Adding a Windows minion requires you to install OVS and OVN binaries. Windows Server container host running the required Windows Server and Docker versions. Follow the setup instructions outlined by <a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/quick-start/quick-start-windows-server" target="_blank">this help topic</a>. This type of deployment is supported starting with Windows Server 2016 RTM.</p>

<p>Compiling OVS and generating the installer will not be treated in this document. For a step by step instruction please visit <a href="http://docs.openvswitch.org/en/latest/intro/install/windows/#open-vswitch-on-windows" target="_blank">this link</a>.
For a prebuilt certified installer please visit <a href="https://cloudbase.it/openvswitch/#download" target="_blank">this link</a> and download the latest version of it.</p>

<p>The following guide uses the prebuilt certified installer.</p>

<p>Installing OVS can be done either via the GUI dialogs or unattended. Adding a Windows host to your setup requires you to have <code>OVN Host</code> together with the default installation features. Below is the dialog image on what needs to be installed:</p>

<p><img src="OVN_OVS_Windows_Installer.png" alt="OVN OVS Windows Installer" /></p>

<p>For an unattended installation please use the following command:</p>

<pre><code>cmd /c 'msiexec /i openvswitch.msi ADDLOCAL=&quot;OpenvSwitchCLI,OpenvSwitchDriver,OVNHost&quot; /qn'
</code></pre>

<p>The installer propagates new environment variables. Please open a new command shell or logoff/logon to ensure the environment variables are refreshed.</p>

<p>For overlay, OVS on Windows requires a transparent docker network to function properly. Please use the following to create a transparent docker network which will be used by OVS. From powershell:</p>

<pre><code>docker network create -d transparent --gateway $GATEWAY_IP --subnet $SUBNET `
    -o com.docker.network.windowsshim.interface=&quot;$INTERFACE_ALIAS&quot; external
</code></pre>

<p>Where $SUBNET is the minion subnet which will be used to spawn pods on (the one which will be used by kubernetes), $GATEWAY_IP is the first IP of the $SUBNET and $INTERFACE_ALIAS is the interface used for creating the overlay tunnels (must have connectivity with the rests of the OVN hosts).
Example:</p>

<pre><code>docker network create -d transparent --gateway 10.0.1.1 --subnet 10.0.1.0/24 `
    -o com.docker.network.windowsshim.interface=&quot;Ethernet0&quot; external
</code></pre>

<p>After creating the docker network please run the next commands from powershell. (creates an OVS bridge, adds the interface under the bridge and enables the OVS forwarding switch extension)</p>

<pre><code>$a = Get-NetAdapter | where Name -Match HNSTransparent
Rename-NetAdapter $a[0].Name -NewName HNSTransparent
Stop-Service ovs-vswitchd -force; Disable-VMSwitchExtension &quot;Cloudbase Open vSwitch Extension&quot;;
ovs-vsctl --no-wait del-br br-ex
ovs-vsctl --no-wait --may-exist add-br br-ex
ovs-vsctl --no-wait add-port br-ex HNSTransparent -- set interface HNSTransparent type=internal
ovs-vsctl --no-wait add-port br-ex $INTERFACE_ALIAS
Enable-VMSwitchExtension &quot;Cloudbase Open vSwitch Extension&quot;; sleep 2; Restart-Service ovs-vswitchd
</code></pre>

<p>Besides of the above, setting up a Windows host is the same as the Linux host. Follow the steps from <a href="https://github.com/openvswitch/ovn-kubernetes#k8s-minion-node-initializations" target="_blank">here</a>.</p>

<p><strong>Windows CNI Setup</strong></p>

<p>Today, Windows OVN&amp;OVS CNI plugin is based on ovn_cni.exe which can be downloaded from <a href="https://cloudbase.it/downloads/ovn_cni.exe" target="_blank">here</a>. A sample of CNI config file is the following:</p>

<pre><code>{
    &quot;name&quot;: &quot;net&quot;,
    &quot;type&quot;: &quot;ovn_cni.exe&quot;,
    &quot;bridge&quot;: &quot;br-int&quot;,
    &quot;isGateway&quot;: &quot;true&quot;,
    &quot;ipMasq&quot;: &quot;false&quot;,
    &quot;ipam&quot;: {
         &quot;type&quot;: &quot;host-local&quot;,
         &quot;subnet&quot;: &quot;$SUBNET&quot;
         }
}
</code></pre>

<p>Where $SUBNET is the subnet that was used in the previous <code>docker network create</code> command.</p>

<p>For a complete guide on Google Cloud Platform (GCP), namely Google Compute Engine (GCE) visit <a href="https://github.com/apprenda/kubernetes-ovn-heterogeneous-cluster#heterogeneous-kubernetes-cluster-on-top-of-ovn" target="_blank">this</a>.</p>

<p>For a complete guide on Amazon Web Services (AWS) visit <a href="https://github.com/justeat/kubernetes-windows-aws-ovs#kubernetes-on-windows-in-aws-using-ovn" target="_blank">this</a>.</p>

<h2 id="starting-the-cluster">Starting the Cluster</h2>

<p>To start your cluster, you&rsquo;ll need to start both the Linux-based Kubernetes control plane, and the Windows Server-based Kubernetes node components (kubelet and kube-proxy). For the OVS &amp; OVN only the kubelet is required.</p>

<h2 id="starting-the-linux-based-control-plane">Starting the Linux-based Control Plane</h2>

<p>Use your preferred method to start Kubernetes cluster on Linux. Please note that Cluster CIDR might need to be updated.</p>

<h2 id="support-for-kubeadm-join">Support for kubeadm join</h2>

<p>If your cluster has been created by <a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/" target="_blank">kubeadm</a>,
and your networking is setup correctly using one of the methods listed above (networking is setup outside of kubeadm), you can use kubeadm to add a Windows node to your cluster. At a high level, you first have to initialize the master with kubeadm (Linux), then set up the CNI based networking (outside of kubeadm), and finally start joining Windows or Linux worker nodes to the cluster. For additional documentation and reference material, visit the kubeadm link above.</p>

<p>The kubeadm binary can be found at <a href="https://github.com/kubernetes/kubernetes/releases" target="_blank">Kubernetes Releases</a>, inside the node binaries archive. Adding a Windows node is not any different than adding a Linux node:</p>

<p><code>kubeadm.exe join --token &lt;token&gt; &lt;master-ip&gt;:&lt;master-port&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt;</code></p>

<p>See <a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#joining-your-nodes" target="_blank">joining-your-nodes</a> for more details.</p>

<h2 id="supported-features">Supported Features</h2>

<p>The examples listed below assume running Windows nodes on Windows Server 1709. If you are running Windows Server 2016, the examples will need the image updated to specify <code>image: microsoft/windowsservercore:ltsc2016</code>. This is due to the requirement for container images to match the host operating system version when using process isolation. Not specifying a tag will implicitly use the <code>:latest</code> tag which can lead to surprising behaviors. Please consult with <a href="https://hub.docker.com/r/microsoft/windowsservercore/" target="_blank">https://hub.docker.com/r/microsoft/windowsservercore/</a> for additional information on Windows Server Core image tagging.</p>

<h3 id="scheduling-pods-on-windows">Scheduling Pods on Windows</h3>

<p>Because your cluster has both Linux and Windows nodes, you must explicitly set the <code>nodeSelector</code> constraint to be able to schedule pods to Windows nodes. You must set nodeSelector with the label <code>beta.kubernetes.io/os</code> to the value <code>windows</code>; see the following example:</p>



 













<table class="includecode" id="windows-simple-pod-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/simple-pod.yaml" download="windows/simple-pod.yaml">
                    <code>windows/simple-pod.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-simple-pod-yaml')" title="Copy windows/simple-pod.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">  </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">      </span>image:<span style="color:#bbb"> </span>microsoft/iis:windowsservercore-<span style="color:#666">1709</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>ports:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>-<span style="color:#bbb"> </span>containerPort:<span style="color:#bbb"> </span><span style="color:#666">80</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>nodeSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#b44">&#34;beta.kubernetes.io/os&#34;</span>:<span style="color:#bbb"> </span>windows<span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<blockquote class="note">
  <div><strong>Note:</strong> This example assumes you are running on Windows Server 1709, so uses the image tag to support that. If you are on a different version, you will need to update the tag. For example, if on Windows Server 2016, update to use <code>&quot;image&quot;: &quot;microsoft/iis&quot;</code> which will default to that OS version.</div>
</blockquote>


<h3 id="secrets-and-configmaps">Secrets and ConfigMaps</h3>

<p>Secrets and ConfigMaps can be utilized in Windows Server Containers, but must be used as environment variables. See limitations section below for additional details.</p>

<p><strong>Examples:</strong></p>

<p>Windows pod with secrets mapped to environment variables</p>



 













<table class="includecode" id="windows-secret-pod-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/secret-pod.yaml" download="windows/secret-pod.yaml">
                    <code>windows/secret-pod.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-secret-pod-yaml')" title="Copy windows/secret-pod.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Secret<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>mysecret<span style="color:#bbb">
</span><span style="color:#bbb"></span>type:<span style="color:#bbb"> </span>Opaque<span style="color:#bbb">
</span><span style="color:#bbb"></span>data:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>username:<span style="color:#bbb"> </span>YWRtaW4=<span style="color:#bbb">
</span><span style="color:#bbb">  </span>password:<span style="color:#bbb"> </span>MWYyZDFlMmU2N2Rm<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>--<span style="color:#b44;font-style:italic">-
</span><span style="color:#b44;font-style:italic">
</span><span style="color:#b44;font-style:italic">apiVersion: v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>my-secret-pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-secret-pod<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>microsoft/windowsservercore:<span style="color:#666">1709</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>env:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>USERNAME<span style="color:#bbb">
</span><span style="color:#bbb">        </span>valueFrom:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>secretKeyRef:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>name:<span style="color:#bbb"> </span>mysecret<span style="color:#bbb">
</span><span style="color:#bbb">            </span>key:<span style="color:#bbb"> </span>username<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>PASSWORD<span style="color:#bbb">
</span><span style="color:#bbb">        </span>valueFrom:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>secretKeyRef:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>name:<span style="color:#bbb"> </span>mysecret<span style="color:#bbb">
</span><span style="color:#bbb">            </span>key:<span style="color:#bbb"> </span>password<span style="color:#bbb">
</span><span style="color:#bbb">  </span>nodeSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>beta.kubernetes.io/os:<span style="color:#bbb"> </span>windows<span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<p>Windows Pod with configMap values mapped to environment variables</p>



 













<table class="includecode" id="windows-configmap-pod-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/configmap-pod.yaml" download="windows/configmap-pod.yaml">
                    <code>windows/configmap-pod.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-configmap-pod-yaml')" title="Copy windows/configmap-pod.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">kind:<span style="color:#bbb"> </span>ConfigMap<span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>example-config<span style="color:#bbb">
</span><span style="color:#bbb"></span>data:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>example.property.<span style="color:#666">1</span>:<span style="color:#bbb"> </span>hello<span style="color:#bbb">
</span><span style="color:#bbb">  </span>example.property.<span style="color:#666">2</span>:<span style="color:#bbb"> </span>world<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>--<span style="color:#b44;font-style:italic">-
</span><span style="color:#b44;font-style:italic">
</span><span style="color:#b44;font-style:italic">apiVersion: v1</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>configmap-pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>configmap-redis<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>redis:<span style="color:#666">3.0</span>-nanoserver<span style="color:#bbb">
</span><span style="color:#bbb">    </span>env:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>EXAMPLE_PROPERTY_1<span style="color:#bbb">
</span><span style="color:#bbb">        </span>valueFrom:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>configMapKeyRef:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>name:<span style="color:#bbb"> </span>example-config<span style="color:#bbb">
</span><span style="color:#bbb">            </span>key:<span style="color:#bbb"> </span>example.property.<span style="color:#666">1</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>EXAMPLE_PROPERTY_2<span style="color:#bbb">
</span><span style="color:#bbb">        </span>valueFrom:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>configMapKeyRef:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>name:<span style="color:#bbb"> </span>example-config<span style="color:#bbb">
</span><span style="color:#bbb">            </span>key:<span style="color:#bbb"> </span>example.property.<span style="color:#666">2</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>nodeSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>beta.kubernetes.io/os:<span style="color:#bbb"> </span>windows</code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<h3 id="volumes">Volumes</h3>

<p>Some supported Volume Mounts are local, emptyDir, hostPath.  One thing to remember is that paths must either be escaped, or use forward slashes, for example <code>mountPath: &quot;C:\\etc\\foo&quot;</code> or <code>mountPath: &quot;C:/etc/foo&quot;</code>.</p>

<p>Persistent Volume Claims are supported for supported volume types.</p>

<p><strong>Examples:</strong></p>

<p>Windows pod with a hostPath volume</p>



 













<table class="includecode" id="windows-hostpath-volume-pod-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/hostpath-volume-pod.yaml" download="windows/hostpath-volume-pod.yaml">
                    <code>windows/hostpath-volume-pod.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-hostpath-volume-pod-yaml')" title="Copy windows/hostpath-volume-pod.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>hostpath-volume-pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>my-hostpath-volume-pod<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>microsoft/windowsservercore:<span style="color:#666">1709</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">      </span>mountPath:<span style="color:#bbb"> </span><span style="color:#b44">&#34;C:\\etc\\foo&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>readOnly:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>nodeSelector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>beta.kubernetes.io/os:<span style="color:#bbb"> </span>windows<span style="color:#bbb">
</span><span style="color:#bbb">  </span>volumes:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">    </span>hostPath:<span style="color:#bbb">
</span><span style="color:#bbb">     </span>path:<span style="color:#bbb"> </span><span style="color:#b44">&#34;C:\\etc\\foo&#34;</span><span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<p>Windows pod with multiple emptyDir volumes</p>



 













<table class="includecode" id="windows-emptydir-pod-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/emptydir-pod.yaml" download="windows/emptydir-pod.yaml">
                    <code>windows/emptydir-pod.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-emptydir-pod-yaml')" title="Copy windows/emptydir-pod.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#bbb"> </span>apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"> </span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"> </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">   </span>name:<span style="color:#bbb"> </span>my-empty-dir-pod<span style="color:#bbb">
</span><span style="color:#bbb"> </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">   </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">   </span>-<span style="color:#bbb"> </span>image:<span style="color:#bbb"> </span>microsoft/windowsservercore:<span style="color:#666">1709</span><span style="color:#bbb">
</span><span style="color:#bbb">     </span>name:<span style="color:#bbb"> </span>my-empty-dir-pod<span style="color:#bbb">
</span><span style="color:#bbb">     </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">     </span>-<span style="color:#bbb"> </span>mountPath:<span style="color:#bbb"> </span>/cache<span style="color:#bbb">
</span><span style="color:#bbb">       </span>name:<span style="color:#bbb"> </span>cache-volume<span style="color:#bbb">
</span><span style="color:#bbb">     </span>-<span style="color:#bbb"> </span>mountPath:<span style="color:#bbb"> </span>C:/scratch<span style="color:#bbb">
</span><span style="color:#bbb">       </span>name:<span style="color:#bbb"> </span>scratch-volume<span style="color:#bbb">
</span><span style="color:#bbb">   </span>volumes:<span style="color:#bbb">
</span><span style="color:#bbb">   </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>cache-volume<span style="color:#bbb">
</span><span style="color:#bbb">     </span>emptyDir:<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span><span style="color:#bbb">   </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>scratch-volume<span style="color:#bbb">
</span><span style="color:#bbb">     </span>emptyDir:<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span><span style="color:#bbb">   </span>nodeSelector:<span style="color:#bbb">
</span><span style="color:#bbb">     </span>beta.kubernetes.io/os:<span style="color:#bbb"> </span>windows<span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<h3 id="daemonsets">DaemonSets</h3>

<p>DaemonSets are supported</p>



 













<table class="includecode" id="windows-daemonset-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/daemonset.yaml" download="windows/daemonset.yaml">
                    <code>windows/daemonset.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-daemonset-yaml')" title="Copy windows/daemonset.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>DaemonSet<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>my-daemonset<span style="color:#bbb">
</span><span style="color:#bbb">  </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>app:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>selector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchLabels:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>app:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">  </span>template:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>app:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">    </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">        </span>image:<span style="color:#bbb"> </span>microsoft/windowsservercore:<span style="color:#666">1709</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>nodeSelector:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>beta.kubernetes.io/os:<span style="color:#bbb"> </span>windows<span style="color:#bbb">
</span><span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<h3 id="metrics">Metrics</h3>

<p>Windows Stats use a hybrid model: pod and container level stats come from CRI (via dockershim), while node level stats come from the &ldquo;winstats&rdquo; package that exports cadvisor like data structures using windows specific perf counters from the node.</p>

<h3 id="container-resources">Container Resources</h3>

<p>Container resources (CPU and memory) could be set now for windows containers in v1.10.</p>



 













<table class="includecode" id="windows-deploy-resource-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/deploy-resource.yaml" download="windows/deploy-resource.yaml">
                    <code>windows/deploy-resource.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-deploy-resource-yaml')" title="Copy windows/deploy-resource.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Deployment<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>replicas:<span style="color:#bbb"> </span><span style="color:#666">3</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>selector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchLabels:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>app:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">  </span>template:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>app:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">    </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">        </span>image:<span style="color:#bbb"> </span>microsoft/iis<span style="color:#bbb">
</span><span style="color:#bbb">        </span>resources:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>limits:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>memory:<span style="color:#bbb"> </span><span style="color:#b44">&#34;128Mi&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>cpu:<span style="color:#bbb"> </span><span style="color:#666">2</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>ports:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>-<span style="color:#bbb"> </span>containerPort:<span style="color:#bbb"> </span><span style="color:#666">80</span><span style="color:#bbb">
</span><span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<h3 id="hyper-v-containers">Hyper-V Containers</h3>

<p>Hyper-V containers are supported as experimental in v1.10. To create a Hyper-V container, kubelet should be started with feature gates <code>HyperVContainer=true</code> and Pod should include annotation <code>experimental.windows.kubernetes.io/isolation-type=hyperv</code>.</p>



 













<table class="includecode" id="windows-deploy-hyperv-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/windows/deploy-hyperv.yaml" download="windows/deploy-hyperv.yaml">
                    <code>windows/deploy-hyperv.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('windows-deploy-hyperv-yaml')" title="Copy windows/deploy-hyperv.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Deployment<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>selector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchLabels:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>app:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">  </span>replicas:<span style="color:#bbb"> </span><span style="color:#666">3</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>template:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>app:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">      </span>annotations:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>experimental.windows.kubernetes.io/isolation-type:<span style="color:#bbb"> </span>hyperv<span style="color:#bbb">
</span><span style="color:#bbb">    </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>iis<span style="color:#bbb">
</span><span style="color:#bbb">        </span>image:<span style="color:#bbb"> </span>microsoft/iis<span style="color:#bbb">
</span><span style="color:#bbb">        </span>ports:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>-<span style="color:#bbb"> </span>containerPort:<span style="color:#bbb"> </span><span style="color:#666">80</span><span style="color:#bbb">
</span><span style="color:#bbb">
</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>



<h3 id="kubelet-and-kube-proxy-can-now-run-as-windows-services">Kubelet and kube-proxy can now run as Windows services</h3>

<p>Starting with kubernetes v1.11, kubelet and kube-proxy can run as Windows services.</p>

<p>This means that you can now register them as Windows services via <code>sc</code> command. More details about how to create Windows services with <code>sc</code> can be found <a href="https://support.microsoft.com/en-us/help/251192/how-to-create-a-windows-service-by-using-sc-exe" target="_blank">here</a>.</p>

<p><strong>Examples:</strong></p>

<p>To create the service:</p>

<pre><code>PS &gt; sc.exe create &lt;component_name&gt; binPath= &quot;&lt;path_to_binary&gt; --windows-service &lt;other_args&gt;&quot;
CMD &gt; sc create &lt;component_name&gt; binPath= &quot;&lt;path_to_binary&gt; --windows-service &lt;other_args&gt;&quot;
</code></pre>

<p>Please note that if the arguments contain spaces, it must be escaped. Example:</p>

<pre><code>PS &gt; sc.exe create kubelet binPath= &quot;C:\kubelet.exe --windows-service --hostname-override 'minion' &lt;other_args&gt;&quot;
CMD &gt; sc create kubelet binPath= &quot;C:\kubelet.exe --windows-service --hostname-override 'minion' &lt;other_args&gt;&quot;
</code></pre>

<p>To start the service:</p>

<pre><code>PS &gt; Start-Service kubelet; Start-Service kube-proxy
CMD &gt; net start kubelet &amp;&amp; net start kube-proxy
</code></pre>

<p>To stop the service:</p>

<pre><code>PS &gt; Stop-Service kubelet (-Force); Stop-Service kube-proxy (-Force)
CMD &gt; net stop kubelet &amp;&amp; net stop kube-proxy
</code></pre>

<p>To query the service:</p>

<pre><code>PS &gt; Get-Service kubelet; Get-Service kube-proxy;
CMD &gt; sc.exe queryex kubelet &amp;&amp; sc qc kubelet &amp;&amp; sc.exe queryex kube-proxy &amp;&amp; sc.exe qc kube-proxy
</code></pre>

<h2 id="known-limitations-for-windows-server-containers-with-v1-9">Known Limitations for Windows Server Containers with v1.9</h2>

<p>Some of these limitations will be addressed by the community in future releases of Kubernetes:</p>

<ul>
<li>Shared network namespace (compartment) with multiple Windows Server containers (shared kernel) per pod is only supported on Windows Server 1709 or later</li>
<li>Using Secrets and ConfigMaps as volume mounts is not supported</li>
<li>Mount propagation is not supported on Windows</li>
<li>The StatefulSet functionality for stateful applications is not supported</li>
<li>Horizontal Pod Autoscaling for Windows Server Container pods has not been verified to work end-to-end</li>
<li>Hyper-V isolated containers are not supported.</li>
<li>Windows container OS must match the Host OS. If it does not, the pod will get stuck in a crash loop.</li>
<li>Under the networking models of L3 or Host GW, Kubernetes Services are inaccessible to Windows nodes due to a Windows issue. This is not an issue if using OVN/OVS for networking.</li>
<li>Windows kubelet.exe may fail to start when running on Windows Server under VMware Fusion <a href="https://github.com/kubernetes/kubernetes/pull/57124" target="_blank">issue 57110</a></li>
<li>Flannel and Weavenet are not yet supported</li>
<li>Some .Net Core applications expect environment variables with a colon (<code>:</code>) in the name. Kubernetes currently does not allow this.  Replace colon (<code>:</code>) with  double underscore (<code>__</code>) as documented <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?tabs=basicconfiguration#configuration-by-environment" target="_blank">here</a>.</li>
<li>As cgroups are not supported on windows, kubelet.exe should be started with the following additional arguments <code>--cgroups-per-qos=false --enforce-node-allocatable=&quot;&quot;</code> <a href="https://github.com/kubernetes/kubernetes/issues/61716" target="_blank">issue 61716</a></li>
</ul>

<h2 id="next-steps-and-resources">Next steps and resources</h2>

<ul>
<li>Support for Windows is in Beta as of v1.9 and your feedback is welcome. For information on getting involved, please head to <a href="https://github.com/kubernetes/community/blob/master/sig-windows/README.md" target="_blank">SIG-Windows</a></li>
<li>Troubleshooting and Common Problems: <a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/kubernetes/common-problems" target="_blank">Link</a></li>
</ul>

          
          <div class="social-share" data-initialized="true" data-wechat-qrcode-title="不扫别后悔">
  <center>
    <font style="font-size:18px;color:darkcyan;">分享到：</font>
    <a href="#" class="social-share-icon icon-weibo"></a>
    <a href="#" class="social-share-icon icon-wechat"></a>
    <a href="#" class="social-share-icon icon-twitter"></a>
    <a href="#" class="social-share-icon icon-linkedin"></a>
    <a href="#" class="social-share-icon icon-facebook"></a>
    <a href="#" class="social-share-icon icon-qq"></a>
    <a href="#" class="social-share-icon icon-qzone"></a>
  </center>
</div>


<script src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/social-share.min.js"></script>
          
        </article>
      </div>
    </div>
  </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            
            
            
            <a href="/docs/home/">Home</a>
            
            <a href="/blog/">Blog</a>
            
            <a href="/partners/">Partners</a>
            
            <a href="/community/">Community</a>
            
            <a href="/case-studies/">Case Studies</a>
            
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                
                <a href="https://git.k8s.io/community/contributors/guide" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2019 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a></a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2019 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
        <div id="miceType" class="center">
            ICP license: 京ICP备17074266号-3
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<script>

(function () {
    window.addEventListener('DOMContentLoaded', init)

        
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>



<script language="application/javascript">
  
  (function addHeadingLinks(){
    var article = document.getElementById('docsContent');
    var headings = article.querySelectorAll('h1, h2, h3, h4, h5, h6');
    headings.forEach(function(heading){
      if(heading.id){
        var a = document.createElement('a');
        a.innerHTML = heading.innerHTML;
        a.href = '#'+heading.id;
        a.classList.add('inpage_heading');
        heading.innerHTML = '';
        heading.appendChild(a);
      }
    });
  })();
</script>
</body>
</html>