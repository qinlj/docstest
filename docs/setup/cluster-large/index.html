<!DOCTYPE html>
<html id="docs" lang="en" class="">
<head>
  

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36037335-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-36037335-10');
</script>
<meta charset="utf-8">
<title>Building Large Clusters - SuperMap iDesktop .NET</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
<link rel="stylesheet" href="/css/base_fonts.css">
<link rel="stylesheet" href="/css/styles.css">
<link rel="stylesheet" href="/css/jquery-ui.min.css">
<link rel="stylesheet" href="/css/sweetalert.min.css">
<link rel="stylesheet" href="/css/callouts.css">
<link rel="stylesheet" href="/css/custom-jekyll/tags.css">
<link rel="stylesheet" href="https://qinlj.github.io/css/main.css" />
<link rel="stylesheet" href="https://qinlj.github.io/css/share.min.css" />



<meta name="description" content="Support At v1.13, Kubernetes supports clusters with up to 5000 nodes. More specifically, we support configurations that meet all of the following criteria:
 No more than 5000 nodes No more than 150000 total pods No more than 300000 total containers No more than 100 pods per node  
   Support Setup  Quota Issues Etcd storage Size of master and master components Addon Resources Allowing minor node failure at startup     Setup A cluster is a set of nodes (physical or virtual machines) running Kubernetes agents, managed by a &ldquo;master&rdquo; (the cluster-level control plane).">
<meta property="og:description" content="Support At v1.13, Kubernetes supports clusters with up to 5000 nodes. More specifically, we support configurations that meet all of the following criteria:
 No more than 5000 nodes No more than 150000 total pods No more than 300000 total containers No more than 100 pods per node  
   Support Setup  Quota Issues Etcd storage Size of master and master components Addon Resources Allowing minor node failure at startup     Setup A cluster is a set of nodes (physical or virtual machines) running Kubernetes agents, managed by a &ldquo;master&rdquo; (the cluster-level control plane).">
<meta name="twitter:description" content="Support At v1.13, Kubernetes supports clusters with up to 5000 nodes. More specifically, we support configurations that meet all of the following criteria:
 No more than 5000 nodes No more than 150000 total pods No more than 300000 total containers No more than 100 pods per node  
   Support Setup  Quota Issues Etcd storage Size of master and master components Addon Resources Allowing minor node failure at startup     Setup A cluster is a set of nodes (physical or virtual machines) running Kubernetes agents, managed by a &ldquo;master&rdquo; (the cluster-level control plane).">
<meta property="og:url" content="https://qinlj.github.io/docs/setup/cluster-large/">
<meta property="og:title" content="Building Large Clusters">
<meta name="twitter:title" content="Building Large Clusters">

<meta name="twitter:image:alt"   content="SuperMap iDesktop .NET">

<meta property="og:image" content="/images/kubernetes-horizontal-color.png">

<meta property="og:type" content="article">
<script src="/js/anchor-4.1.1.min.js"></script>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/jquery-ui-1.12.1.min.js"></script>
<script src="/js/bootstrap-3.3.7.min.js"></script>
<script src="/js/sweetalert-1.1.3.min.js"></script>
<script src="/js/script.js"></script>
<script src="/js/custom-jekyll/tags.js"></script>


</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            
            
            <li><a href="/docs/" class="active">Documentation</a></li>
            
            <li><a href="/blog/">Blog</a></li>
            
            <li><a href="/partners/">Partners</a></li>
            
            <li><a href="/community/">Community</a></li>
            
            <li><a href="/case-studies/">Case Studies</a></li>
            
            
            
             <li>
                <a href="#">
                    English <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="/ko/docs/setup/cluster-large/">한국어 Korean</a></li>
                
                    <li><a href="/ja/docs/setup/cluster-large/">日本語 Japanese</a></li>
                
                </ul>
            </li>

            <li>
                <a href="#">
                    v1.13 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="https://kubernetes.io">v1.13</a></li>
                
                    <li><a href="https://supermaphehh.github.io/zh/">iDesktop .NET</a></li>
                
                    <li><a href="https://v1-12.docs.kubernetes.io">v1.12</a></li>
                
                    <li><a href="https://v1-11.docs.kubernetes.io">v1.11</a></li>
                
                    <li><a href="https://v1-10.docs.kubernetes.io">v1.10</a></li>
                
                    <li><a href="https://v1-9.docs.kubernetes.io">v1.9</a></li>
                
                </ul>
            </li>
        </ul>

        <form id="searchBox" action="/search/">
          <input type="text" id="search" name="q" placeholder="Search" aria-label="Search">
        </form>

    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
         
           <div class="nav-box">
            <h3><a href="/docs/tutorials/hello-minikube/">Get Started</a></h3>
           <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>

        </div>
         
           <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
           <p>Learn how to use Kubernetes with conceptual, tutorial, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>

        </div>
         
           <div class="nav-box">
            <h3><a href="/blog/">Blog</a></h3>
           <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>

        </div>
         
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack Slack</span></a>
                <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>



<section id="hero" class="light-text no-sub">
  









<h1>Setup</h1>
<h5></h5>












<div id="vendorStrip" class="light-text">
	<ul>
		
		
		<li><a href="/docs/home/">HOME</a></li>
		
		
		<li><a href="/docs/surfaceanalyst/">SURFACEANALYSIS</a></li>
		
		
		<li><a href="/docs/setup/" class="YAH">SETUP</a></li>
		
		
		<li><a href="/docs/concepts/">CONCEPTS</a></li>
		
		
		<li><a href="/docs/tasks/">TASKS</a></li>
		
		
		<li><a href="/docs/tutorials/">TUTORIALS</a></li>
		
		
		<li><a href="/docs/reference/">REFERENCE</a></li>
		
		
		<li><a href="/docs/contribute/">CONTRIBUTE</a></li>
		
	</ul>
	<form id="searchBox" action="/docs/search/">
		<input type="text" id="search" name="q" placeholder="Search" aria-label="Search">
  </form>
</div>

</section>



<section id="encyclopedia">
  
<div id="docsToc">
     <div class="pi-accordion">
    	
        
        
        
        
        
         
             
                 
             
         
             
                 
             
         
             
                 
                          
                          
                 
             
         
             
         
             
         
             
         
             
         
             
         
             
         
         
        
        <a class="item" data-title="Setup" href="/docs/setup/"></a>

	
	
	
	
		
			

<a class="item" data-title="Picking the Right Solution" href="/docs/setup/pick-right-solution/"></a>

		
	
		
			
<div class="item" data-title="Downloading Kubernetes">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Building a release" href="/docs/setup/release/building-from-source/"></a>

		
	
		
			

<a class="item" data-title="v1.13 Release Notes" href="/docs/setup/release/notes/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Bootstrapping Clusters with kubeadm">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Installing kubeadm" href="/docs/setup/independent/install-kubeadm/"></a>

		
	
		
			

<a class="item" data-title="Creating a single master cluster with kubeadm" href="/docs/setup/independent/create-cluster-kubeadm/"></a>

		
	
		
			

<a class="item" data-title="Customizing control plane configuration with kubeadm" href="/docs/setup/independent/control-plane-flags/"></a>

		
	
		
			

<a class="item" data-title="Options for Highly Available Topology" href="/docs/setup/independent/ha-topology/"></a>

		
	
		
			

<a class="item" data-title="Creating Highly Available Clusters with kubeadm" href="/docs/setup/independent/high-availability/"></a>

		
	
		
			

<a class="item" data-title="Set up a High Availability etcd cluster with kubeadm" href="/docs/setup/independent/setup-ha-etcd-with-kubeadm/"></a>

		
	
		
			

<a class="item" data-title="Configuring each kubelet in your cluster using kubeadm" href="/docs/setup/independent/kubelet-integration/"></a>

		
	
		
			

<a class="item" data-title="Troubleshooting kubeadm" href="/docs/setup/independent/troubleshooting-kubeadm/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Turnkey Cloud Solutions">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Running Kubernetes on AWS EC2" href="/docs/setup/turnkey/aws/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Alibaba Cloud" href="/docs/setup/turnkey/alibaba-cloud/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Azure" href="/docs/setup/turnkey/azure/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on CenturyLink Cloud" href="/docs/setup/turnkey/clc/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Google Compute Engine" href="/docs/setup/turnkey/gce/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Multiple Clouds with IBM Cloud Private" href="/docs/setup/turnkey/icp/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Multiple Clouds with Stackpoint.io" href="/docs/setup/turnkey/stackpoint/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Custom Cloud Solutions">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Installing Kubernetes On-premises/Cloud Providers with Kubespray" href="/docs/setup/custom-cloud/kubespray/"></a>

		
	
		
			

<a class="item" data-title="Installing Kubernetes on AWS with kops" href="/docs/setup/custom-cloud/kops/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="On-Premises VMs">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Cloudstack" href="/docs/setup/on-premises-vm/cloudstack/"></a>

		
	
		
			

<a class="item" data-title="Kubernetes on DC/OS" href="/docs/setup/on-premises-vm/dcos/"></a>

		
	
		
			

<a class="item" data-title="oVirt" href="/docs/setup/on-premises-vm/ovirt/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="Kubernetes Version and Version Skew Support Policy" href="/docs/setup/version-skew-policy/"></a>

		
	
		
			

<a class="item" data-title="Building Large Clusters" href="/docs/setup/cluster-large/"></a>

		
	
		
			

<a class="item" data-title="Running in Multiple Zones" href="/docs/setup/multiple-zones/"></a>

		
	
		
			

<a class="item" data-title="CRI installation" href="/docs/setup/cri/"></a>

		
	
		
			

<a class="item" data-title="Installing Kubernetes with Digital Rebar Provision (DRP) via KRIB" href="/docs/setup/on-premises-metal/krib/"></a>

		
	
		
			

<a class="item" data-title="PKI Certificates and Requirements" href="/docs/setup/certificates/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes Locally via Minikube" href="/docs/setup/minikube/"></a>

		
	
		
			

<a class="item" data-title="Validate Node Setup" href="/docs/setup/node-conformance/"></a>

		
	





     </div> 
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
</div> 


  <div id="docsContent">
  

<p>
  <a href="https://github.com/kubernetes/website/edit/master/content/en/docs%5csetup%5ccluster-large.md" id="editPageButton" target="_blank">
    Edit This Page
  </a>
</p>

<h1>Building Large Clusters</h1>





<h2 id="support">Support</h2>

<p>At v1.13, Kubernetes supports clusters with up to 5000 nodes. More specifically, we support configurations that meet <em>all</em> of the following criteria:</p>

<ul>
<li>No more than 5000 nodes</li>
<li>No more than 150000 total pods</li>
<li>No more than 300000 total containers</li>
<li>No more than 100 pods per node</li>
</ul>

<p><br></p>

<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#support">Support</a></li>
<li><a href="#setup">Setup</a>
<ul>
<li><a href="#quota-issues">Quota Issues</a></li>
<li><a href="#etcd-storage">Etcd storage</a></li>
<li><a href="#size-of-master-and-master-components">Size of master and master components</a></li>
<li><a href="#addon-resources">Addon Resources</a></li>
<li><a href="#allowing-minor-node-failure-at-startup">Allowing minor node failure at startup</a></li>
</ul></li>
</ul></li>
</ul>
</nav>

<h2 id="setup">Setup</h2>

<p>A cluster is a set of nodes (physical or virtual machines) running Kubernetes agents, managed by a &ldquo;master&rdquo; (the cluster-level control plane).</p>

<p>Normally the number of nodes in a cluster is controlled by the value <code>NUM_NODES</code> in the platform-specific <code>config-default.sh</code> file (for example, see <a href="http://releases.k8s.io/master/cluster/gce/config-default.sh" target="_blank">GCE&rsquo;s <code>config-default.sh</code></a>).</p>

<p>Simply changing that value to something very large, however, may cause the setup script to fail for many cloud providers. A GCE deployment, for example, will run in to quota issues and fail to bring the cluster up.</p>

<p>When setting up a large Kubernetes cluster, the following issues must be considered.</p>

<h3 id="quota-issues">Quota Issues</h3>

<p>To avoid running into cloud provider quota issues, when creating a cluster with many nodes, consider:</p>

<ul>
<li>Increase the quota for things like CPU, IPs, etc.

<ul>
<li>In <a href="https://cloud.google.com/compute/docs/resource-quotas" target="_blank">GCE, for example,</a> you&rsquo;ll want to increase the quota for:</li>
<li>CPUs</li>
<li>VM instances</li>
<li>Total persistent disk reserved</li>
<li>In-use IP addresses</li>
<li>Firewall Rules</li>
<li>Forwarding rules</li>
<li>Routes</li>
<li>Target pools</li>
</ul></li>
<li>Gating the setup script so that it brings up new node VMs in smaller batches with waits in between, because some cloud providers rate limit the creation of VMs.</li>
</ul>

<h3 id="etcd-storage">Etcd storage</h3>

<p>To improve performance of large clusters, we store events in a separate dedicated etcd instance.</p>

<p>When creating a cluster, existing salt scripts:</p>

<ul>
<li>start and configure additional etcd instance</li>
<li>configure api-server to use it for storing events</li>
</ul>

<h3 id="size-of-master-and-master-components">Size of master and master components</h3>

<p>On GCE/Google Kubernetes Engine, and AWS, <code>kube-up</code> automatically configures the proper VM size for your master depending on the number of nodes
in your cluster. On other providers, you will need to configure it manually. For reference, the sizes we use on GCE are</p>

<ul>
<li>1-5 nodes: n1-standard-1</li>
<li>6-10 nodes: n1-standard-2</li>
<li>11-100 nodes: n1-standard-4</li>
<li>101-250 nodes: n1-standard-8</li>
<li>251-500 nodes: n1-standard-16</li>
<li>more than 500 nodes: n1-standard-32</li>
</ul>

<p>And the sizes we use on AWS are</p>

<ul>
<li>1-5 nodes: m3.medium</li>
<li>6-10 nodes: m3.large</li>
<li>11-100 nodes: m3.xlarge</li>
<li>101-250 nodes: m3.2xlarge</li>
<li>251-500 nodes: c4.4xlarge</li>
<li>more than 500 nodes: c4.8xlarge</li>
</ul>

<blockquote class="note">
  <div><strong>Note:</strong> <p>On Google Kubernetes Engine, the size of the master node adjusts automatically based on the size of your cluster. For more information, see <a href="https://cloudplatform.googleblog.com/2017/11/Cutting-Cluster-Management-Fees-on-Google-Kubernetes-Engine.html" target="_blank">this blog post</a>.</p>

<p>On AWS, master node sizes are currently set at cluster startup time and do not change, even if you later scale your cluster up or down by manually removing or adding nodes or using a cluster autoscaler.</p>
</div>
</blockquote>


<h3 id="addon-resources">Addon Resources</h3>

<p>To prevent memory leaks or other resource issues in <a href="https://releases.k8s.io/master/cluster/addons" target="_blank">cluster addons</a> from consuming all the resources available on a node, Kubernetes sets resource limits on addon containers to limit the CPU and Memory resources they can consume (See PR <a href="http://pr.k8s.io/10653/files" target="_blank">#10653</a> and <a href="http://pr.k8s.io/10778/files" target="_blank">#10778</a>).</p>

<p>For example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>fluentd-cloud-logging<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>k8s.gcr.io/fluentd-gcp:<span style="color:#666">1.16</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>limits:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>cpu:<span style="color:#bbb"> </span>100m<span style="color:#bbb">
</span><span style="color:#bbb">        </span>memory:<span style="color:#bbb"> </span>200Mi</code></pre></div>
<p>Except for Heapster, these limits are static and are based on data we collected from addons running on 4-node clusters (see <a href="http://issue.k8s.io/10335#issuecomment-117861225" target="_blank">#10335</a>). The addons consume a lot more resources when running on large deployment clusters (see <a href="http://issue.k8s.io/5880#issuecomment-113984085" target="_blank">#5880</a>). So, if a large cluster is deployed without adjusting these values, the addons may continuously get killed because they keep hitting the limits.</p>

<p>To avoid running into cluster addon resource issues, when creating a cluster with many nodes, consider the following:</p>

<ul>
<li>Scale memory and CPU limits for each of the following addons, if used, as you scale up the size of cluster (there is one replica of each handling the entire cluster so memory and CPU usage tends to grow proportionally with size/load on cluster):

<ul>
<li><a href="http://releases.k8s.io/master/cluster/addons/cluster-monitoring/influxdb/influxdb-grafana-controller.yaml" target="_blank">InfluxDB and Grafana</a></li>
<li><a href="http://releases.k8s.io/master/cluster/addons/dns/kube-dns/kube-dns.yaml.in" target="_blank">kubedns, dnsmasq, and sidecar</a></li>
<li><a href="http://releases.k8s.io/master/cluster/addons/fluentd-elasticsearch/kibana-deployment.yaml" target="_blank">Kibana</a></li>
</ul></li>
<li>Scale number of replicas for the following addons, if used, along with the size of cluster (there are multiple replicas of each so increasing replicas should help handle increased load, but, since load per replica also increases slightly, also consider increasing CPU/memory limits):

<ul>
<li><a href="http://releases.k8s.io/master/cluster/addons/fluentd-elasticsearch/es-statefulset.yaml" target="_blank">elasticsearch</a></li>
</ul></li>
<li>Increase memory and CPU limits slightly for each of the following addons, if used, along with the size of cluster (there is one replica per node but CPU/memory usage increases slightly along with cluster load/size as well):

<ul>
<li><a href="http://releases.k8s.io/master/cluster/addons/fluentd-elasticsearch/fluentd-es-ds.yaml" target="_blank">FluentD with ElasticSearch Plugin</a></li>
<li><a href="http://releases.k8s.io/master/cluster/addons/fluentd-gcp/fluentd-gcp-ds.yaml" target="_blank">FluentD with GCP Plugin</a></li>
</ul></li>
</ul>

<p>Heapster&rsquo;s resource limits are set dynamically based on the initial size of your cluster (see <a href="http://issue.k8s.io/16185" target="_blank">#16185</a>
and <a href="http://issue.k8s.io/22940" target="_blank">#22940</a>). If you find that Heapster is running
out of resources, you should adjust the formulas that compute heapster memory request (see those PRs for details).</p>

<p>For directions on how to detect if addon containers are hitting resource limits, see the <a href="/docs/concepts/configuration/manage-compute-resources-container/#troubleshooting">Troubleshooting section of Compute Resources</a>.</p>

<p>In the <a href="http://issue.k8s.io/13048" target="_blank">future</a>, we anticipate to set all cluster addon resource limits based on cluster size, and to dynamically adjust them if you grow or shrink your cluster.
We welcome PRs that implement those features.</p>

<h3 id="allowing-minor-node-failure-at-startup">Allowing minor node failure at startup</h3>

<p>For various reasons (see <a href="https://github.com/kubernetes/kubernetes/issues/18969" target="_blank">#18969</a> for more details) running
<code>kube-up.sh</code> with a very large <code>NUM_NODES</code> may fail due to a very small number of nodes not coming up properly.
Currently you have two choices: restart the cluster (<code>kube-down.sh</code> and then <code>kube-up.sh</code> again), or before
running <code>kube-up.sh</code> set the environment variable <code>ALLOWED_NOTREADY_NODES</code> to whatever value you feel comfortable
with. This will allow <code>kube-up.sh</code> to succeed with fewer than <code>NUM_NODES</code> coming up. Depending on the
reason for the failure, those additional nodes may join later or the cluster may remain at a size of
<code>NUM_NODES - ALLOWED_NOTREADY_NODES</code>.</p>



<nav class="pagination" style="font-size: 16px; font-weight: bold"><a class="nav nav-prev" href="/docs/setup/version-skew-policy/" title="Kubernetes Version and Version Skew Support Policy"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - Kubernetes Version and Version Skew Support Policy</a>
<a class="nav nav-next" style="float:right"  href="/docs/setup/multiple-zones/" title="Running in Multiple Zones">Next - Running in Multiple Zones <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav>


  
  <h2>Feedback</h2>
  <p class="feedback--prompt">Was this page helpful? </p>
  <button class="button feedback--yes">Yes</button>
  <button class="button feedback--no">No</button>
  <p class="feedback--response feedback--response__hidden">
    Thanks for the feedback. If you have a specific, answerable question about how to use Kubernetes,
    ask it on <a target="_blank" rel="noopener"
    href="https://stackoverflow.com/questions/tagged/kubernetes">Stack Overflow</a>. Open
    an issue in the GitHub repo if you want to <a class="feedback--link" target="_blank" rel="noopener"
    href="https://github.com/kubernetes/website/issues/new?title=Issue%20with%20k8s.io">report a problem</a> or
    <a class="feedback--link" target="_blank" rel="noopener"
    href="https://github.com/kubernetes/website/issues/new?title=Improvement%20for%20k8s.io">suggest an improvement</a>.
  </p>
  <script>
    const yes = document.querySelector('.feedback--yes');
    const no = document.querySelector('.feedback--no');
    document.querySelectorAll('.feedback--link').forEach(link => {
      link.href = link.href + window.location.pathname;
    });
    const sendFeedback = (value) => {
      if (!gtag) { console.log('!gtag'); }
      gtag('event', 'click', {
        'event_category': 'Helpful',
        'event_label': window.location.pathname,
        value
      });
    };
    const disableButtons = () => {
      yes.disabled = true;
      yes.classList.add('feedback--button__disabled');
      no.disabled = true;
      no.classList.add('feedback--button__disabled');
    };
    yes.addEventListener('click', () => {
      sendFeedback(1);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
    no.addEventListener('click', () => {
      sendFeedback(0);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
  </script>


  <div id="pre-footer"> 
  <hr />

  <div class="issue-button-container">
    <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs%5csetup%5ccluster-large.md?pixel" alt="Analytics" /></a></p>
    
    
    <script type="text/javascript">
    PDRTJS_settings_8345992 = {
    "id" : "8345992",
    "unique_id" : "\/docs\/setup\/cluster-large\/",
    "title" : "Building Large Clusters",
    "permalink" : "https:\/\/qinlj.github.io\/docs\/setup\/cluster-large\/"
    };
    (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
    </script>
    <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?title=Issue%20with%20' +
    'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
    
    
    
    <a href="https://github.com/kubernetes/website/edit/master/content/en/docs%5csetup%5ccluster-large.md" class="button issue">Edit This Page</a>
    
  </div>
  

  <div id="lastedit" class="lastedit issue-button-container">
    Page last modified on August 20, 2018 at 11:31 AM PST by
    <a href="https://github.com/kubernetes/website/commit/5db4b83a662ba5f8bde82a415978bf3879e2fa5a/">Refactor Setup and Imported sections (#9916)</a> (<a href="https://github.com/kubernetes/website/commits/master/content/en/docs%5csetup%5ccluster-large.md">Page History</a>)
  </div>
  
</div>

  <div class="post-comment">
    
    


<div id="lv-container" data-id="city" data-uid="MTAyMC80MzQxMi8xOTk1Mw==">
  <script type="text/javascript">
    (function(d, s) {
      var j, e = d.getElementsByTagName(s)[0];

      if (typeof LivereTower === 'function') { return; }

      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;

      e.parentNode.insertBefore(j, e);
    })(document, 'script');
  </script>
  <noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
</div>



  </div>
  
  <div class="container" role="main" itemscope itemtype="http://schema.org/Article">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
        
        
<div>
  <h5 id="tags">Tags: 
  </h5>
</div>
        
        <article role="main" class="blog-post" itemprop="articleBody" id="content">
          ...
          

<h2 id="support">Support</h2>

<p>At v1.13, Kubernetes supports clusters with up to 5000 nodes. More specifically, we support configurations that meet <em>all</em> of the following criteria:</p>

<ul>
<li>No more than 5000 nodes</li>
<li>No more than 150000 total pods</li>
<li>No more than 300000 total containers</li>
<li>No more than 100 pods per node</li>
</ul>

<p><br></p>

<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#support">Support</a></li>
<li><a href="#setup">Setup</a>
<ul>
<li><a href="#quota-issues">Quota Issues</a></li>
<li><a href="#etcd-storage">Etcd storage</a></li>
<li><a href="#size-of-master-and-master-components">Size of master and master components</a></li>
<li><a href="#addon-resources">Addon Resources</a></li>
<li><a href="#allowing-minor-node-failure-at-startup">Allowing minor node failure at startup</a></li>
</ul></li>
</ul></li>
</ul>
</nav>

<h2 id="setup">Setup</h2>

<p>A cluster is a set of nodes (physical or virtual machines) running Kubernetes agents, managed by a &ldquo;master&rdquo; (the cluster-level control plane).</p>

<p>Normally the number of nodes in a cluster is controlled by the value <code>NUM_NODES</code> in the platform-specific <code>config-default.sh</code> file (for example, see <a href="http://releases.k8s.io/master/cluster/gce/config-default.sh" target="_blank">GCE&rsquo;s <code>config-default.sh</code></a>).</p>

<p>Simply changing that value to something very large, however, may cause the setup script to fail for many cloud providers. A GCE deployment, for example, will run in to quota issues and fail to bring the cluster up.</p>

<p>When setting up a large Kubernetes cluster, the following issues must be considered.</p>

<h3 id="quota-issues">Quota Issues</h3>

<p>To avoid running into cloud provider quota issues, when creating a cluster with many nodes, consider:</p>

<ul>
<li>Increase the quota for things like CPU, IPs, etc.

<ul>
<li>In <a href="https://cloud.google.com/compute/docs/resource-quotas" target="_blank">GCE, for example,</a> you&rsquo;ll want to increase the quota for:</li>
<li>CPUs</li>
<li>VM instances</li>
<li>Total persistent disk reserved</li>
<li>In-use IP addresses</li>
<li>Firewall Rules</li>
<li>Forwarding rules</li>
<li>Routes</li>
<li>Target pools</li>
</ul></li>
<li>Gating the setup script so that it brings up new node VMs in smaller batches with waits in between, because some cloud providers rate limit the creation of VMs.</li>
</ul>

<h3 id="etcd-storage">Etcd storage</h3>

<p>To improve performance of large clusters, we store events in a separate dedicated etcd instance.</p>

<p>When creating a cluster, existing salt scripts:</p>

<ul>
<li>start and configure additional etcd instance</li>
<li>configure api-server to use it for storing events</li>
</ul>

<h3 id="size-of-master-and-master-components">Size of master and master components</h3>

<p>On GCE/Google Kubernetes Engine, and AWS, <code>kube-up</code> automatically configures the proper VM size for your master depending on the number of nodes
in your cluster. On other providers, you will need to configure it manually. For reference, the sizes we use on GCE are</p>

<ul>
<li>1-5 nodes: n1-standard-1</li>
<li>6-10 nodes: n1-standard-2</li>
<li>11-100 nodes: n1-standard-4</li>
<li>101-250 nodes: n1-standard-8</li>
<li>251-500 nodes: n1-standard-16</li>
<li>more than 500 nodes: n1-standard-32</li>
</ul>

<p>And the sizes we use on AWS are</p>

<ul>
<li>1-5 nodes: m3.medium</li>
<li>6-10 nodes: m3.large</li>
<li>11-100 nodes: m3.xlarge</li>
<li>101-250 nodes: m3.2xlarge</li>
<li>251-500 nodes: c4.4xlarge</li>
<li>more than 500 nodes: c4.8xlarge</li>
</ul>

<blockquote class="note">
  <div><strong>Note:</strong> <p>On Google Kubernetes Engine, the size of the master node adjusts automatically based on the size of your cluster. For more information, see <a href="https://cloudplatform.googleblog.com/2017/11/Cutting-Cluster-Management-Fees-on-Google-Kubernetes-Engine.html" target="_blank">this blog post</a>.</p>

<p>On AWS, master node sizes are currently set at cluster startup time and do not change, even if you later scale your cluster up or down by manually removing or adding nodes or using a cluster autoscaler.</p>
</div>
</blockquote>


<h3 id="addon-resources">Addon Resources</h3>

<p>To prevent memory leaks or other resource issues in <a href="https://releases.k8s.io/master/cluster/addons" target="_blank">cluster addons</a> from consuming all the resources available on a node, Kubernetes sets resource limits on addon containers to limit the CPU and Memory resources they can consume (See PR <a href="http://pr.k8s.io/10653/files" target="_blank">#10653</a> and <a href="http://pr.k8s.io/10778/files" target="_blank">#10778</a>).</p>

<p>For example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>fluentd-cloud-logging<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>k8s.gcr.io/fluentd-gcp:<span style="color:#666">1.16</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>resources:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>limits:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>cpu:<span style="color:#bbb"> </span>100m<span style="color:#bbb">
</span><span style="color:#bbb">        </span>memory:<span style="color:#bbb"> </span>200Mi</code></pre></div>
<p>Except for Heapster, these limits are static and are based on data we collected from addons running on 4-node clusters (see <a href="http://issue.k8s.io/10335#issuecomment-117861225" target="_blank">#10335</a>). The addons consume a lot more resources when running on large deployment clusters (see <a href="http://issue.k8s.io/5880#issuecomment-113984085" target="_blank">#5880</a>). So, if a large cluster is deployed without adjusting these values, the addons may continuously get killed because they keep hitting the limits.</p>

<p>To avoid running into cluster addon resource issues, when creating a cluster with many nodes, consider the following:</p>

<ul>
<li>Scale memory and CPU limits for each of the following addons, if used, as you scale up the size of cluster (there is one replica of each handling the entire cluster so memory and CPU usage tends to grow proportionally with size/load on cluster):

<ul>
<li><a href="http://releases.k8s.io/master/cluster/addons/cluster-monitoring/influxdb/influxdb-grafana-controller.yaml" target="_blank">InfluxDB and Grafana</a></li>
<li><a href="http://releases.k8s.io/master/cluster/addons/dns/kube-dns/kube-dns.yaml.in" target="_blank">kubedns, dnsmasq, and sidecar</a></li>
<li><a href="http://releases.k8s.io/master/cluster/addons/fluentd-elasticsearch/kibana-deployment.yaml" target="_blank">Kibana</a></li>
</ul></li>
<li>Scale number of replicas for the following addons, if used, along with the size of cluster (there are multiple replicas of each so increasing replicas should help handle increased load, but, since load per replica also increases slightly, also consider increasing CPU/memory limits):

<ul>
<li><a href="http://releases.k8s.io/master/cluster/addons/fluentd-elasticsearch/es-statefulset.yaml" target="_blank">elasticsearch</a></li>
</ul></li>
<li>Increase memory and CPU limits slightly for each of the following addons, if used, along with the size of cluster (there is one replica per node but CPU/memory usage increases slightly along with cluster load/size as well):

<ul>
<li><a href="http://releases.k8s.io/master/cluster/addons/fluentd-elasticsearch/fluentd-es-ds.yaml" target="_blank">FluentD with ElasticSearch Plugin</a></li>
<li><a href="http://releases.k8s.io/master/cluster/addons/fluentd-gcp/fluentd-gcp-ds.yaml" target="_blank">FluentD with GCP Plugin</a></li>
</ul></li>
</ul>

<p>Heapster&rsquo;s resource limits are set dynamically based on the initial size of your cluster (see <a href="http://issue.k8s.io/16185" target="_blank">#16185</a>
and <a href="http://issue.k8s.io/22940" target="_blank">#22940</a>). If you find that Heapster is running
out of resources, you should adjust the formulas that compute heapster memory request (see those PRs for details).</p>

<p>For directions on how to detect if addon containers are hitting resource limits, see the <a href="/docs/concepts/configuration/manage-compute-resources-container/#troubleshooting">Troubleshooting section of Compute Resources</a>.</p>

<p>In the <a href="http://issue.k8s.io/13048" target="_blank">future</a>, we anticipate to set all cluster addon resource limits based on cluster size, and to dynamically adjust them if you grow or shrink your cluster.
We welcome PRs that implement those features.</p>

<h3 id="allowing-minor-node-failure-at-startup">Allowing minor node failure at startup</h3>

<p>For various reasons (see <a href="https://github.com/kubernetes/kubernetes/issues/18969" target="_blank">#18969</a> for more details) running
<code>kube-up.sh</code> with a very large <code>NUM_NODES</code> may fail due to a very small number of nodes not coming up properly.
Currently you have two choices: restart the cluster (<code>kube-down.sh</code> and then <code>kube-up.sh</code> again), or before
running <code>kube-up.sh</code> set the environment variable <code>ALLOWED_NOTREADY_NODES</code> to whatever value you feel comfortable
with. This will allow <code>kube-up.sh</code> to succeed with fewer than <code>NUM_NODES</code> coming up. Depending on the
reason for the failure, those additional nodes may join later or the cluster may remain at a size of
<code>NUM_NODES - ALLOWED_NOTREADY_NODES</code>.</p>

          
          <div class="social-share" data-initialized="true" data-wechat-qrcode-title="不扫别后悔">
  <center>
    <font style="font-size:18px;color:darkcyan;">分享到：</font>
    <a href="#" class="social-share-icon icon-weibo"></a>
    <a href="#" class="social-share-icon icon-wechat"></a>
    <a href="#" class="social-share-icon icon-twitter"></a>
    <a href="#" class="social-share-icon icon-linkedin"></a>
    <a href="#" class="social-share-icon icon-facebook"></a>
    <a href="#" class="social-share-icon icon-qq"></a>
    <a href="#" class="social-share-icon icon-qzone"></a>
  </center>
</div>


<script src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/social-share.min.js"></script>
          
        </article>
      </div>
    </div>
  </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            
            
            
            <a href="/docs/home/">Home</a>
            
            <a href="/blog/">Blog</a>
            
            <a href="/partners/">Partners</a>
            
            <a href="/community/">Community</a>
            
            <a href="/case-studies/">Case Studies</a>
            
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                
                <a href="https://git.k8s.io/community/contributors/guide" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2019 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a></a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2019 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
        <div id="miceType" class="center">
            ICP license: 京ICP备17074266号-3
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<script>

(function () {
    window.addEventListener('DOMContentLoaded', init)

        
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>



<script language="application/javascript">
  
  (function addHeadingLinks(){
    var article = document.getElementById('docsContent');
    var headings = article.querySelectorAll('h1, h2, h3, h4, h5, h6');
    headings.forEach(function(heading){
      if(heading.id){
        var a = document.createElement('a');
        a.innerHTML = heading.innerHTML;
        a.href = '#'+heading.id;
        a.classList.add('inpage_heading');
        heading.innerHTML = '';
        heading.appendChild(a);
      }
    });
  })();
</script>
</body>
</html>