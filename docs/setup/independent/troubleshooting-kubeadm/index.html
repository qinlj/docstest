<!DOCTYPE html>
<html id="docs" lang="en" class="">
<head>
  

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36037335-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-36037335-10');
</script>
<meta charset="utf-8">
<title>Troubleshooting kubeadm - SuperMap iDesktop .NET</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
<link rel="stylesheet" href="/css/base_fonts.css">
<link rel="stylesheet" href="/css/styles.css">
<link rel="stylesheet" href="/css/jquery-ui.min.css">
<link rel="stylesheet" href="/css/sweetalert.min.css">
<link rel="stylesheet" href="/css/callouts.css">
<link rel="stylesheet" href="/css/custom-jekyll/tags.css">



<meta name="description" content="">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:url" content="https://qinlj.github.io/docs/setup/independent/troubleshooting-kubeadm/">
<meta property="og:title" content="Troubleshooting kubeadm">
<meta name="twitter:title" content="Troubleshooting kubeadm">

<meta name="twitter:image:alt"   content="SuperMap iDesktop .NET">

<meta property="og:image" content="/images/kubernetes-horizontal-color.png">

<meta property="og:type" content="article">
<script src="/js/anchor-4.1.1.min.js"></script>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/jquery-ui-1.12.1.min.js"></script>
<script src="/js/bootstrap-3.3.7.min.js"></script>
<script src="/js/sweetalert-1.1.3.min.js"></script>
<script src="/js/script.js"></script>
<script src="/js/custom-jekyll/tags.js"></script>


</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>
    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            
            
            <li><a href="/docs/" class="active">Documentation</a></li>
            
            <li><a href="/blog/">Blog</a></li>
            
            <li><a href="/partners/">Partners</a></li>
            
            <li><a href="/community/">Community</a></li>
            
            <li><a href="/case-studies/">Case Studies</a></li>
            
            
            
             <li>
                <a href="#">
                    English <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="/ja/docs/setup/independent/troubleshooting-kubeadm/">日本語 Japanese</a></li>
                
                    <li><a href="/fr/docs/setup/independent/troubleshooting-kubeadm/">Français</a></li>
                
                </ul>
            </li>

            <li>
                <a href="#">
                    v1.13 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="https://kubernetes.io">v1.13</a></li>
                
                    <li><a href="https://v1-12.docs.kubernetes.io">v1.12</a></li>
                
                    <li><a href="https://v1-11.docs.kubernetes.io">v1.11</a></li>
                
                    <li><a href="https://v1-10.docs.kubernetes.io">v1.10</a></li>
                
                    <li><a href="https://v1-9.docs.kubernetes.io">v1.9</a></li>
                
                </ul>
            </li>
        </ul>

        <form id="searchBox" action="/search/">
          <input type="text" id="search" name="q" placeholder="Search" aria-label="Search">
        </form>

    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
         
           <div class="nav-box">
            <h3><a href="/docs/tutorials/hello-minikube/">Get Started</a></h3>
           <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>

        </div>
         
           <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
           <p>Learn how to use Kubernetes with conceptual, tutorial, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>

        </div>
         
           <div class="nav-box">
            <h3><a href="/blog/">Blog</a></h3>
           <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>

        </div>
         
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack Slack</span></a>
                <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>



<section id="hero" class="light-text no-sub">
  









<h1>Setup</h1>
<h5></h5>












<div id="vendorStrip" class="light-text">
	<ul>
		
		
		<li><a href="/docs/home/">HOME</a></li>
		
		
		<li><a href="/docs/surfaceanalyst/">SURFACEANALYSIS</a></li>
		
		
		<li><a href="/docs/setup/" class="YAH">SETUP</a></li>
		
		
		<li><a href="/docs/concepts/">CONCEPTS</a></li>
		
		
		<li><a href="/docs/tasks/">TASKS</a></li>
		
		
		<li><a href="/docs/tutorials/">TUTORIALS</a></li>
		
		
		<li><a href="/docs/reference/">REFERENCE</a></li>
		
		
		<li><a href="/docs/contribute/">CONTRIBUTE</a></li>
		
	</ul>
	<form id="searchBox" action="/docs/search/">
		<input type="text" id="search" name="q" placeholder="Search" aria-label="Search">
  </form>
</div>

</section>



<section id="encyclopedia">
  
<div id="docsToc">
     <div class="pi-accordion">
    	
        
        
        
        
        
         
             
                 
             
         
             
                 
             
         
             
                 
                          
                          
                 
             
         
             
         
             
         
             
         
             
         
             
         
             
         
         
        
        <a class="item" data-title="Setup" href="/docs/setup/"></a>

	
	
	
	
		
			

<a class="item" data-title="Picking the Right Solution" href="/docs/setup/pick-right-solution/"></a>

		
	
		
			
<div class="item" data-title="Downloading Kubernetes">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Building a release" href="/docs/setup/release/building-from-source/"></a>

		
	
		
			

<a class="item" data-title="v1.13 Release Notes" href="/docs/setup/release/notes/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Bootstrapping Clusters with kubeadm">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Installing kubeadm" href="/docs/setup/independent/install-kubeadm/"></a>

		
	
		
			

<a class="item" data-title="Creating a single master cluster with kubeadm" href="/docs/setup/independent/create-cluster-kubeadm/"></a>

		
	
		
			

<a class="item" data-title="Customizing control plane configuration with kubeadm" href="/docs/setup/independent/control-plane-flags/"></a>

		
	
		
			

<a class="item" data-title="Options for Highly Available Topology" href="/docs/setup/independent/ha-topology/"></a>

		
	
		
			

<a class="item" data-title="Creating Highly Available Clusters with kubeadm" href="/docs/setup/independent/high-availability/"></a>

		
	
		
			

<a class="item" data-title="Set up a High Availability etcd cluster with kubeadm" href="/docs/setup/independent/setup-ha-etcd-with-kubeadm/"></a>

		
	
		
			

<a class="item" data-title="Configuring each kubelet in your cluster using kubeadm" href="/docs/setup/independent/kubelet-integration/"></a>

		
	
		
			

<a class="item" data-title="Troubleshooting kubeadm" href="/docs/setup/independent/troubleshooting-kubeadm/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Turnkey Cloud Solutions">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Running Kubernetes on AWS EC2" href="/docs/setup/turnkey/aws/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Alibaba Cloud" href="/docs/setup/turnkey/alibaba-cloud/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Azure" href="/docs/setup/turnkey/azure/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on CenturyLink Cloud" href="/docs/setup/turnkey/clc/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Google Compute Engine" href="/docs/setup/turnkey/gce/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Multiple Clouds with IBM Cloud Private" href="/docs/setup/turnkey/icp/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes on Multiple Clouds with Stackpoint.io" href="/docs/setup/turnkey/stackpoint/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Custom Cloud Solutions">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Installing Kubernetes On-premises/Cloud Providers with Kubespray" href="/docs/setup/custom-cloud/kubespray/"></a>

		
	
		
			

<a class="item" data-title="Installing Kubernetes on AWS with kops" href="/docs/setup/custom-cloud/kops/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="On-Premises VMs">
	<div class="container">
		
		
	
	
	
	
		
			

<a class="item" data-title="Cloudstack" href="/docs/setup/on-premises-vm/cloudstack/"></a>

		
	
		
			

<a class="item" data-title="Kubernetes on DC/OS" href="/docs/setup/on-premises-vm/dcos/"></a>

		
	
		
			

<a class="item" data-title="oVirt" href="/docs/setup/on-premises-vm/ovirt/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="Kubernetes Version and Version Skew Support Policy" href="/docs/setup/version-skew-policy/"></a>

		
	
		
			

<a class="item" data-title="Building Large Clusters" href="/docs/setup/cluster-large/"></a>

		
	
		
			

<a class="item" data-title="Running in Multiple Zones" href="/docs/setup/multiple-zones/"></a>

		
	
		
			

<a class="item" data-title="CRI installation" href="/docs/setup/cri/"></a>

		
	
		
			

<a class="item" data-title="Installing Kubernetes with Digital Rebar Provision (DRP) via KRIB" href="/docs/setup/on-premises-metal/krib/"></a>

		
	
		
			

<a class="item" data-title="PKI Certificates and Requirements" href="/docs/setup/certificates/"></a>

		
	
		
			

<a class="item" data-title="Running Kubernetes Locally via Minikube" href="/docs/setup/minikube/"></a>

		
	
		
			

<a class="item" data-title="Validate Node Setup" href="/docs/setup/node-conformance/"></a>

		
	





     </div> 
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
</div> 


  <div id="docsContent">
  

<p>
  <a href="https://github.com/kubernetes/website/edit/master/content/en/docs%5csetup%5cindependent%5ctroubleshooting-kubeadm.md" id="editPageButton" target="_blank">
    Edit This Page
  </a>
</p>

<h1>Troubleshooting kubeadm</h1>



<p>As with any program, you might run into an error installing or running kubeadm.
This page lists some common failure scenarios and have provided steps that can help you understand and fix the problem.</p>

<p>If your problem is not listed below, please follow the following steps:</p>

<ul>
<li><p>If you think your problem is a bug with kubeadm:</p>

<ul>
<li>Go to <a href="https://github.com/kubernetes/kubeadm/issues" target="_blank">github.com/kubernetes/kubeadm</a> and search for existing issues.</li>
<li>If no issue exists, please <a href="https://github.com/kubernetes/kubeadm/issues/new" target="_blank">open one</a> and follow the issue template.</li>
</ul></li>

<li><p>If you are unsure about how kubeadm works, you can ask on <a href="http://slack.k8s.io/" target="_blank">Slack</a> in #kubeadm, or open a question on <a href="https://stackoverflow.com/questions/tagged/kubernetes" target="_blank">StackOverflow</a>. Please include
relevant tags like <code>#kubernetes</code> and <code>#kubeadm</code> so folks can help you.</p></li>
</ul>









<ul id="markdown-toc">










<li><a href="#ebtables-or-some-similar-executable-not-found-during-installation"><code>ebtables</code> or some similar executable not found during installation</a></li>




<li><a href="#kubeadm-blocks-waiting-for-control-plane-during-installation">kubeadm blocks waiting for control plane during installation</a></li>




<li><a href="#kubeadm-blocks-when-removing-managed-containers">kubeadm blocks when removing managed containers</a></li>




<li><a href="#pods-in-runcontainererror-crashloopbackoff-or-error-state">Pods in <code>RunContainerError</code>, <code>CrashLoopBackOff</code> or <code>Error</code> state</a></li>




<li><a href="#coredns-or-kube-dns-is-stuck-in-the-pending-state"><code>coredns</code> (or <code>kube-dns</code>) is stuck in the <code>Pending</code> state</a></li>




<li><a href="#hostport-services-do-not-work"><code>HostPort</code> services do not work</a></li>




<li><a href="#pods-are-not-accessible-via-their-service-ip">Pods are not accessible via their Service IP</a></li>




<li><a href="#tls-certificate-errors">TLS certificate errors</a></li>




<li><a href="#default-nic-when-using-flannel-as-the-pod-network-in-vagrant">Default NIC When using flannel as the pod network in Vagrant</a></li>




<li><a href="#non-public-ip-used-for-containers">Non-public IP used for containers</a></li>




<li><a href="#coredns-pods-have-crashloopbackoff-or-error-state"><code>coredns</code> pods have <code>CrashLoopBackOff</code> or <code>Error</code> state</a></li>




<li><a href="#etcd-pods-restart-continually">etcd pods restart continually</a></li>




<li><a href="#not-possible-to-pass-a-comma-separated-list-of-values-to-arguments-inside-a-component-extra-args-flag">Not possible to pass a comma separated list of values to arguments inside a <code>--component-extra-args</code> flag</a></li>



















</ul>


<h2 id="ebtables-or-some-similar-executable-not-found-during-installation"><code>ebtables</code> or some similar executable not found during installation</h2>

<p>If you see the following warnings while running <code>kubeadm init</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#666">[</span>preflight<span style="color:#666">]</span> WARNING: ebtables not found in system path
<span style="color:#666">[</span>preflight<span style="color:#666">]</span> WARNING: ethtool not found in system path</code></pre></div>
<p>Then you may be missing <code>ebtables</code>, <code>ethtool</code> or a similar executable on your node. You can install them with the following commands:</p>

<ul>
<li>For Ubuntu/Debian users, run <code>apt install ebtables ethtool</code>.</li>
<li>For CentOS/Fedora users, run <code>yum install ebtables ethtool</code>.</li>
</ul>

<h2 id="kubeadm-blocks-waiting-for-control-plane-during-installation">kubeadm blocks waiting for control plane during installation</h2>

<p>If you notice that <code>kubeadm init</code> hangs after printing out the following line:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#666">[</span>apiclient<span style="color:#666">]</span> Created API client, waiting <span style="color:#a2f;font-weight:bold">for</span> the control plane to become ready</code></pre></div>
<p>This may be caused by a number of problems. The most common are:</p>

<ul>
<li>network connection problems. Check that your machine has full network connectivity before continuing.</li>
<li>the default cgroup driver configuration for the kubelet differs from that used by Docker.
Check the system log file (e.g. <code>/var/log/message</code>) or examine the output from <code>journalctl -u kubelet</code>. If you see something like the following:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">  error: failed to run Kubelet: failed to create kubelet:
  misconfiguration: kubelet cgroup driver: <span style="color:#b44">&#34;systemd&#34;</span> is different from docker cgroup driver: <span style="color:#b44">&#34;cgroupfs&#34;</span></code></pre></div>
<p>There are two common ways to fix the cgroup driver problem:</p>

<ol>
<li>Install Docker again following instructions
<a href="/docs/setup/independent/install-kubeadm/#installing-docker">here</a>.</li>
<li>Change the kubelet config to match the Docker cgroup driver manually, you can refer to
<a href="/docs/setup/independent/install-kubeadm/#configure-cgroup-driver-used-by-kubelet-on-master-node">Configure cgroup driver used by kubelet on Master Node</a>
for detailed instructions.</li>
</ol>

<ul>
<li>control plane Docker containers are crashlooping or hanging. You can check this by running <code>docker ps</code> and investigating each container by running <code>docker logs</code>.</li>
</ul>

<h2 id="kubeadm-blocks-when-removing-managed-containers">kubeadm blocks when removing managed containers</h2>

<p>The following could happen if Docker halts and does not remove any Kubernetes-managed containers:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo kubeadm reset
<span style="color:#666">[</span>preflight<span style="color:#666">]</span> Running pre-flight checks
<span style="color:#666">[</span>reset<span style="color:#666">]</span> Stopping the kubelet service
<span style="color:#666">[</span>reset<span style="color:#666">]</span> Unmounting mounted directories in <span style="color:#b44">&#34;/var/lib/kubelet&#34;</span>
<span style="color:#666">[</span>reset<span style="color:#666">]</span> Removing kubernetes-managed containers
<span style="color:#666">(</span>block<span style="color:#666">)</span></code></pre></div>
<p>A possible solution is to restart the Docker service and then re-run <code>kubeadm reset</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo systemctl restart docker.service
sudo kubeadm reset</code></pre></div>
<p>Inspecting the logs for docker may also be useful:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">journalctl -ul docker</code></pre></div>
<h2 id="pods-in-runcontainererror-crashloopbackoff-or-error-state">Pods in <code>RunContainerError</code>, <code>CrashLoopBackOff</code> or <code>Error</code> state</h2>

<p>Right after <code>kubeadm init</code> there should not be any pods in these states.</p>

<ul>
<li>If there are pods in one of these states <em>right after</em> <code>kubeadm init</code>, please open an
issue in the kubeadm repo. <code>coredns</code> (or <code>kube-dns</code>) should be in the <code>Pending</code> state
until you have deployed the network solution.</li>
<li>If you see Pods in the <code>RunContainerError</code>, <code>CrashLoopBackOff</code> or <code>Error</code> state
after deploying the network solution and nothing happens to <code>coredns</code> (or <code>kube-dns</code>),
it&rsquo;s very likely that the Pod Network solution that you installed is somehow broken.
You might have to grant it more RBAC privileges or use a newer version. Please file
an issue in the Pod Network providers&rsquo; issue tracker and get the issue triaged there.</li>
<li>If you install a version of Docker older than 1.12.1, remove the <code>MountFlags=slave</code> option
when booting <code>dockerd</code> with <code>systemd</code> and restart <code>docker</code>. You can see the MountFlags in <code>/usr/lib/systemd/system/docker.service</code>.
MountFlags can interfere with volumes mounted by Kubernetes, and put the Pods in <code>CrashLoopBackOff</code> state.
The error happens when Kubernetes does not find <code>var/run/secrets/kubernetes.io/serviceaccount</code> files.</li>
</ul>

<h2 id="coredns-or-kube-dns-is-stuck-in-the-pending-state"><code>coredns</code> (or <code>kube-dns</code>) is stuck in the <code>Pending</code> state</h2>

<p>This is <strong>expected</strong> and part of the design. kubeadm is network provider-agnostic, so the admin
should <a href="/docs/concepts/cluster-administration/addons/">install the pod network solution</a>
of choice. You have to install a Pod Network
before CoreDNS may deployed fully. Hence the <code>Pending</code> state before the network is set up.</p>

<h2 id="hostport-services-do-not-work"><code>HostPort</code> services do not work</h2>

<p>The <code>HostPort</code> and <code>HostIP</code> functionality is available depending on your Pod Network
provider. Please contact the author of the Pod Network solution to find out whether
<code>HostPort</code> and <code>HostIP</code> functionality are available.</p>

<p>Calico, Canal, and Flannel CNI providers are verified to support HostPort.</p>

<p>For more information, see the <a href="https://github.com/containernetworking/plugins/blob/master/plugins/meta/portmap/README.md" target="_blank">CNI portmap documentation</a>.</p>

<p>If your network provider does not support the portmap CNI plugin, you may need to use the <a href="/docs/concepts/services-networking/service/#nodeport">NodePort feature of
services</a> or use <code>HostNetwork=true</code>.</p>

<h2 id="pods-are-not-accessible-via-their-service-ip">Pods are not accessible via their Service IP</h2>

<ul>
<li><p>Many network add-ons do not yet enable <a href="https://kubernetes.io/docs/tasks/debug-application-cluster/debug-service/#a-pod-cannot-reach-itself-via-service-ip" target="_blank">hairpin mode</a>
which allows pods to access themselves via their Service IP. This is an issue related to
<a href="https://github.com/containernetworking/cni/issues/476" target="_blank">CNI</a>. Please contact the network
add-on provider to get the latest status of their support for hairpin mode.</p></li>

<li><p>If you are using VirtualBox (directly or via Vagrant), you will need to
ensure that <code>hostname -i</code> returns a routable IP address. By default the first
interface is connected to a non-routable host-only network. A work around
is to modify <code>/etc/hosts</code>, see this <a href="https://github.com/errordeveloper/k8s-playground/blob/22dd39dfc06111235620e6c4404a96ae146f26fd/Vagrantfile#L11" target="_blank">Vagrantfile</a>
for an example.</p></li>
</ul>

<h2 id="tls-certificate-errors">TLS certificate errors</h2>

<p>The following error indicates a possible certificate mismatch.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-none" data-lang="none"># kubectl get pods
Unable to connect to the server: x509: certificate signed by unknown authority (possibly because of &#34;crypto/rsa: verification error&#34; while trying to verify candidate authority certificate &#34;kubernetes&#34;)</code></pre></div>
<ul>
<li>Verify that the <code>$HOME/.kube/config</code> file contains a valid certificate, and
regenerate a certificate if necessary. The certificates in a kubeconfig file
are base64 encoded. The <code>base64 -d</code> command can be used to decode the certificate
and <code>openssl x509 -text -noout</code> can be used for viewing the certificate information.</li>
<li>Unset the <code>KUBECONFIG</code> environment variable using:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">  <span style="color:#a2f">unset</span> KUBECONFIG</code></pre></div>
<p>Or set it to the default <code>KUBECONFIG</code> location:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">  <span style="color:#a2f">export</span> <span style="color:#b8860b">KUBECONFIG</span><span style="color:#666">=</span>/etc/kubernetes/admin.conf</code></pre></div>
<ul>
<li>Another workaround is to overwrite the existing <code>kubeconfig</code> for the &ldquo;admin&rdquo; user:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">  mv  <span style="color:#b8860b">$HOME</span>/.kube <span style="color:#b8860b">$HOME</span>/.kube.bak
  sudo cp -i /etc/kubernetes/admin.conf <span style="color:#b8860b">$HOME</span>/.kube/config
  sudo chown <span style="color:#a2f;font-weight:bold">$(</span>id -u<span style="color:#a2f;font-weight:bold">)</span>:<span style="color:#a2f;font-weight:bold">$(</span>id -g<span style="color:#a2f;font-weight:bold">)</span> <span style="color:#b8860b">$HOME</span>/.kube/config</code></pre></div>
<h2 id="default-nic-when-using-flannel-as-the-pod-network-in-vagrant">Default NIC When using flannel as the pod network in Vagrant</h2>

<p>The following error might indicate that something was wrong in the pod network:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">Error from server <span style="color:#666">(</span>NotFound<span style="color:#666">)</span>: the server could not find the requested resource</code></pre></div>
<ul>
<li>If you&rsquo;re using flannel as the pod network inside Vagrant, then you will have to specify the default interface name for flannel.</li>
</ul>

<p>Vagrant typically assigns two interfaces to all VMs. The first, for which all hosts are assigned the IP address <code>10.0.2.15</code>, is for external traffic that gets NATed.</p>

<p>This may lead to problems with flannel, which defaults to the first interface on a host. This leads to all hosts thinking they have the same public IP address. To prevent this, pass the <code>--iface eth1</code> flag to flannel so that the second interface is chosen.</p>

<h2 id="non-public-ip-used-for-containers">Non-public IP used for containers</h2>

<p>In some situations <code>kubectl logs</code> and <code>kubectl run</code> commands may return with the following errors in an otherwise functional cluster:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">Error from server: Get https://10.19.0.41:10250/containerLogs/default/mysql-ddc65b868-glc5m/mysql: dial tcp <span style="color:#666">10</span>.19.0.41:10250: getsockopt: no route to host</code></pre></div>
<ul>
<li>This may be due to Kubernetes using an IP that can not communicate with other IPs on the seemingly same subnet, possibly by policy of the machine provider.</li>
<li>Digital Ocean assigns a public IP to <code>eth0</code> as well as a private one to be used internally as anchor for their floating IP feature, yet <code>kubelet</code> will pick the latter as the node&rsquo;s <code>InternalIP</code> instead of the public one.</li>
</ul>

<p>Use <code>ip addr show</code> to check for this scenario instead of <code>ifconfig</code> because <code>ifconfig</code> will not display the offending alias IP address. Alternatively an API endpoint specific to Digital Ocean allows to query for the anchor IP from the droplet:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">  curl http://169.254.169.254/metadata/v1/interfaces/public/0/anchor_ipv4/address</code></pre></div>
<p>The workaround is to tell <code>kubelet</code> which IP to use using <code>--node-ip</code>. When using Digital Ocean, it can be the public one (assigned to <code>eth0</code>) or the private one (assigned to <code>eth1</code>) should you want to use the optional private network. The <a href="https://github.com/kubernetes/kubernetes/blob/release-1.13/cmd/kubeadm/app/apis/kubeadm/v1beta1/types.go" target="_blank"><code>KubeletExtraArgs</code> section of the kubeadm <code>NodeRegistrationOptions</code> structure</a> can be used for this.</p>

<p>Then restart <code>kubelet</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">  systemctl daemon-reload
  systemctl restart kubelet</code></pre></div>
<h2 id="coredns-pods-have-crashloopbackoff-or-error-state"><code>coredns</code> pods have <code>CrashLoopBackOff</code> or <code>Error</code> state</h2>

<p>If you have nodes that are running SELinux with an older version of Docker you might experience a scenario
where the <code>coredns</code> pods are not starting. To solve that you can try one of the following options:</p>

<ul>
<li>Upgrade to a <a href="/docs/setup/independent/install-kubeadm/#installing-docker">newer version of Docker</a>.</li>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/security-enhanced_linux/sect-security-enhanced_linux-enabling_and_disabling_selinux-disabling_selinux" target="_blank">Disable SELinux</a>.</li>
<li>Modify the <code>coredns</code> deployment to set <code>allowPrivilegeEscalation</code> to <code>true</code>:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl -n kube-system get deployment coredns -o yaml | <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>  sed <span style="color:#b44">&#39;s/allowPrivilegeEscalation: false/allowPrivilegeEscalation: true/g&#39;</span> | <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>  kubectl apply -f -</code></pre></div>
<p>Another cause for CoreDNS to have <code>CrashLoopBackOff</code> is when a CoreDNS Pod deployed in Kubernetes detects a loop. <a href="https://github.com/coredns/coredns/tree/master/plugin/loop#troubleshooting-loops-in-kubernetes-clusters" target="_blank">A number of workarounds</a>
are available to avoid Kubernetes trying to restart the CoreDNS Pod every time CoreDNS detects the loop and exits.</p>

<blockquote class="warning">
  <div><strong>Warning:</strong> Disabling SELinux or setting <code>allowPrivilegeEscalation</code> to <code>true</code> can compromise
the security of your cluster.</div>
</blockquote>

<h2 id="etcd-pods-restart-continually">etcd pods restart continually</h2>

<p>If you encounter the following error:</p>

<pre><code>rpc error: code = 2 desc = oci runtime error: exec failed: container_linux.go:247: starting container process caused &quot;process_linux.go:110: decoding init error from pipe caused \&quot;read parent: connection reset by peer\&quot;&quot;
</code></pre>

<p>this issue appears if you run CentOS 7 with Docker 1.13.1.84.
This version of Docker can prevent the kubelet from executing into the etcd container.</p>

<p>To work around the issue, choose one of these options:</p>

<ul>
<li><p>Roll back to an earlier version of Docker, such as 1.13.1-75</p>

<pre><code>yum downgrade docker-1.13.1-75.git8633870.el7.centos.x86_64 docker-client-1.13.1-75.git8633870.el7.centos.x86_64 docker-common-1.13.1-75.git8633870.el7.centos.x86_64
</code></pre></li>

<li><p>Install one of the more recent recommended versions, such as 18.06:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
yum install docker-ce-18.06.1.ce-3.el7.x86_64</code></pre></div></li>
</ul>

<h2 id="not-possible-to-pass-a-comma-separated-list-of-values-to-arguments-inside-a-component-extra-args-flag">Not possible to pass a comma separated list of values to arguments inside a <code>--component-extra-args</code> flag</h2>

<p><code>kubeadm init</code> flags such as <code>--component-extra-args</code> allow you to pass custom arguments to a control-plane
component like the kube-apiserver. However, this mechanism is limited due to the underlying type used for parsing
the values (<code>mapStringString</code>).</p>

<p>If you decide to pass an argument that supports multiple, comma-separated values such as
<code>--apiserver-extra-args &quot;enable-admission-plugins=LimitRanger,NamespaceExists&quot;</code> this flag will fail with
<code>flag: malformed pair, expect string=string</code>. This happens because the list of arguments for
<code>--apiserver-extra-args</code> expects <code>key=value</code> pairs and in this case <code>NamespacesExists</code> is considered
as a key that is missing a value.</p>

<p>Alternativelly, you can try separating the <code>key=value</code> pairs like so:
<code>--apiserver-extra-args &quot;enable-admission-plugins=LimitRanger,enable-admission-plugins=NamespaceExists&quot;</code>
but this will result in the key <code>enable-admission-plugins</code> only having the value of <code>NamespaceExists</code>.</p>

<p>A known workaround is to use the kubeadm
<a href="https://kubernetes.io/docs/setup/independent/control-plane-flags/#apiserver-flags" target="_blank">configuration file</a>.</p>














<nav class="pagination"><a class="nav nav-prev" href="/docs/setup/independent/kubelet-integration/" title="Configuring each kubelet in your cluster using kubeadm"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - Configuring each kubelet in your cluster using kubeadm</a>
<a class="nav nav-next" href="/docs/setup/turnkey/" title="Turnkey Cloud Solutions">Next - Turnkey Cloud Solutions <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav>


  
  <h2>Feedback</h2>
  <p class="feedback--prompt">Was this page helpful? </p>
  <button class="button feedback--yes">Yes</button>
  <button class="button feedback--no">No</button>
  <p class="feedback--response feedback--response__hidden">
    Thanks for the feedback. If you have a specific, answerable question about how to use Kubernetes,
    ask it on <a target="_blank" rel="noopener"
    href="https://stackoverflow.com/questions/tagged/kubernetes">Stack Overflow</a>. Open
    an issue in the GitHub repo if you want to <a class="feedback--link" target="_blank" rel="noopener"
    href="https://github.com/kubernetes/website/issues/new?title=Issue%20with%20k8s.io">report a problem</a> or
    <a class="feedback--link" target="_blank" rel="noopener"
    href="https://github.com/kubernetes/website/issues/new?title=Improvement%20for%20k8s.io">suggest an improvement</a>.
  </p>
  <script>
    const yes = document.querySelector('.feedback--yes');
    const no = document.querySelector('.feedback--no');
    document.querySelectorAll('.feedback--link').forEach(link => {
      link.href = link.href + window.location.pathname;
    });
    const sendFeedback = (value) => {
      if (!gtag) { console.log('!gtag'); }
      gtag('event', 'click', {
        'event_category': 'Helpful',
        'event_label': window.location.pathname,
        value
      });
    };
    const disableButtons = () => {
      yes.disabled = true;
      yes.classList.add('feedback--button__disabled');
      no.disabled = true;
      no.classList.add('feedback--button__disabled');
    };
    yes.addEventListener('click', () => {
      sendFeedback(1);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
    no.addEventListener('click', () => {
      sendFeedback(0);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
  </script>


  <div id="pre-footer"> 
  <hr />

  <div class="issue-button-container">
    <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs%5csetup%5cindependent%5ctroubleshooting-kubeadm.md?pixel" alt="Analytics" /></a></p>
    
    
    <script type="text/javascript">
    PDRTJS_settings_8345992 = {
    "id" : "8345992",
    "unique_id" : "\/docs\/setup\/independent\/troubleshooting-kubeadm\/",
    "title" : "Troubleshooting kubeadm",
    "permalink" : "https:\/\/qinlj.github.io\/docs\/setup\/independent\/troubleshooting-kubeadm\/"
    };
    (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
    </script>
    <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?title=Issue%20with%20' +
    'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
    
    
    
    <a href="https://github.com/kubernetes/website/edit/master/content/en/docs%5csetup%5cindependent%5ctroubleshooting-kubeadm.md" class="button issue">Edit This Page</a>
    
  </div>
  

  <div id="lastedit" class="lastedit issue-button-container">
    Page last modified on March 13, 2019 at 1:56 AM PST by
    <a href="https://github.com/kubernetes/website/commit/a15d6ebed95cdf990991dcf7f8e055afd72ed991/">kubeadm-troubleshooting: add entry about multi-valued args (#12937)</a> (<a href="https://github.com/kubernetes/website/commits/master/content/en/docs%5csetup%5cindependent%5ctroubleshooting-kubeadm.md">Page History</a>)
  </div>
  
</div>

  <div class="post-comment">
    
    

<div id="vcomments"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>

<script type="text/javascript">
    new Valine({
        el: '#vcomments' ,
        appId: 'BKVEHk6tElIcscdmyQlg0U3l-gzGzoHsz',
        appKey: 'RPl3UVDsJQlSv1olxy01A3pO',
        notify: 'false',
        verify: 'false',
        avatar:'SuperMap',
        placeholder: '说点什么吧...',
        visitor: 'true'
    });
</script>

  </div>
  </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            
            
            
            <a href="/docs/home/">Home</a>
            
            <a href="/blog/">Blog</a>
            
            <a href="/partners/">Partners</a>
            
            <a href="/community/">Community</a>
            
            <a href="/case-studies/">Case Studies</a>
            
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                
                <a href="https://git.k8s.io/community/contributors/guide" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2019 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a></a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2019 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
        <div id="miceType" class="center">
            ICP license: 京ICP备17074266号-3
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<script>

(function () {
    window.addEventListener('DOMContentLoaded', init)

        
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>



<script language="application/javascript">
  
  (function addHeadingLinks(){
    var article = document.getElementById('docsContent');
    var headings = article.querySelectorAll('h1, h2, h3, h4, h5, h6');
    headings.forEach(function(heading){
      if(heading.id){
        var a = document.createElement('a');
        a.innerHTML = heading.innerHTML;
        a.href = '#'+heading.id;
        a.classList.add('inpage_heading');
        heading.innerHTML = '';
        heading.appendChild(a);
      }
    });
  })();
</script>
</body>
</html>