<!DOCTYPE html>
<html id="docs" lang="en" class="">
<head>
  

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36037335-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-36037335-10');
</script>
<meta charset="utf-8">
<title>kubeadmを使用した高可用性クラスターの作成 - Kubernetes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
<link rel="stylesheet" href="/css/base_fonts.css">
<link rel="stylesheet" href="/css/styles.css">
<link rel="stylesheet" href="/css/jquery-ui.min.css">
<link rel="stylesheet" href="/css/sweetalert.min.css">
<link rel="stylesheet" href="/css/callouts.css">
<link rel="stylesheet" href="/css/custom-jekyll/tags.css">
<link rel="stylesheet" href="https://qinlj.github.io/css/main.css" />
<link rel="stylesheet" href="https://qinlj.github.io/css/share.min.css" />



<meta name="description" content="">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:url" content="https://qinlj.github.io/ja/docs/setup/independent/high-availability/">
<meta property="og:title" content="kubeadmを使用した高可用性クラスターの作成">
<meta name="twitter:title" content="kubeadmを使用した高可用性クラスターの作成">

<meta name="twitter:image:alt"   content="Kubernetes">

<meta property="og:image" content="/images/kubernetes-horizontal-color.png">

<meta property="og:type" content="article">
<script src="/js/anchor-4.1.1.min.js"></script>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/jquery-ui-1.12.1.min.js"></script>
<script src="/js/bootstrap-3.3.7.min.js"></script>
<script src="/js/sweetalert-1.1.3.min.js"></script>
<script src="/js/script.js"></script>
<script src="/js/custom-jekyll/tags.js"></script>


</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/ja/" class="logo"></a>
    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            
            
            <li><a href="/ja/docs/" class="active">ドキュメント</a></li>
            
            
            
            
            
            
            
            <li><a href="/ja/case-studies/">ケーススタディ</a></li>
            
            
            
             <li>
                <a href="#">
                    日本語 Japanese <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="/docs/setup/independent/high-availability/">English</a></li>
                
                    <li><a href="/fr/docs/setup/independent/high-availability/">Français</a></li>
                
                </ul>
            </li>

            <li>
                <a href="#">
                    v1.13 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="https://kubernetes.io">v1.13</a></li>
                
                    <li><a href="https://v1-12.docs.kubernetes.io">v1.12</a></li>
                
                    <li><a href="https://v1-11.docs.kubernetes.io">v1.11</a></li>
                
                    <li><a href="https://v1-10.docs.kubernetes.io">v1.10</a></li>
                
                    <li><a href="https://v1-9.docs.kubernetes.io">v1.9</a></li>
                
                </ul>
            </li>
        </ul>

        <form id="searchBox" action="/search/">
          <input type="text" id="search" name="q" placeholder="検索" aria-label="Search">
        </form>

    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
         
           <div class="nav-box">
            <h3><a href="/ja/docs/tutorials/hello-minikube/">Get Started</a></h3>
           <p>手を動かす準備はできていますか？本チュートリアルでは、Node.jsを使った簡単な"Hello World"を実行するKubernetesクラスタをビルドします。</p>

        </div>
         
           <div class="nav-box">
            <h3><a href="/ja/docs/home/">ドキュメント</a></h3>
           <p>チュートリアル、サンプルやドキュメントのリファレンスを使って Kubernetes の利用方法を学んでください。あなたは<a href="/editdocs/" data-auto-burger-exclude>ドキュメントへコントリビュートをする</a>こともできます!</p>

        </div>
         
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Kubernetesのコードを編集することに興味がありますか？</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>Githubで参照する</a>
        </div>

        <div class="right">
            <h5 class="github-invite">コミュニティを探す</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack Slack</span></a>
                <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>フォーラム</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>イベントカレンダー</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>



<section id="hero" class="light-text no-sub">
  







<h1>セットアップ</h1>
<h5></h5>






<div id="vendorStrip" class="light-text">
	<ul>
		
		
		<li><a href="/ja/docs/home/">ホーム</a></li>
		
		
		<li><a href="/ja/docs/setup/" class="YAH">セットアップ</a></li>
		
		
		<li><a href="/ja/docs/concepts/">コンセプト</a></li>
		
		
		<li><a href="/ja/docs/tutorials/">チュートリアル</a></li>
		
	</ul>
	<form id="searchBox" action="/docs/search/">
		<input type="text" id="search" name="q" placeholder="検索" aria-label="Search">
  </form>
</div>

</section>



<section id="encyclopedia">
  
<div id="docsToc">
     <div class="pi-accordion">
    	
        
        
        
        
        
         
             
                 
             
         
             
                 
                          
                          
                 
             
         
             
         
             
         
         
        
        <a class="item" data-title="セットアップ" href="/ja/docs/setup/"></a>

	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="正しいソリューションの選択" href="/ja/docs/setup/pick-right-solution/"></a>

		
	
		
			
<div class="item" data-title="Kubernetesのダウンロード">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="v1.13 Release Notes <small>(EN)</small>" href="/docs/setup/release/notes/"></a>

		
	
		
			

<a class="item" data-title="ソースからのビルド" href="/ja/docs/setup/release/building-from-source/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="kubeadmによるClusterのブートストラッピング">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="kubeadmのインストール" href="/ja/docs/setup/independent/install-kubeadm/"></a>

		
	
		
			

<a class="item" data-title="kubeadmを使用したシングルマスタークラスターの作成" href="/ja/docs/setup/independent/create-cluster-kubeadm/"></a>

		
	
		
			

<a class="item" data-title="kubeadmを使ったコントロールプレーンの設定のカスタマイズ" href="/ja/docs/setup/independent/control-plane-flags/"></a>

		
	
		
			

<a class="item" data-title="Options for Highly Available Topology" href="/ja/docs/setup/independent/ha-topology/"></a>

		
	
		
			

<a class="item" data-title="kubeadmを使用した高可用性クラスターの作成" href="/ja/docs/setup/independent/high-availability/"></a>

		
	
		
			

<a class="item" data-title="kubeadmを使用した高可用性etcdクラスターの作成" href="/ja/docs/setup/independent/setup-ha-etcd-with-kubeadm/"></a>

		
	
		
			

<a class="item" data-title="kubeadmを使用したクラスター内の各kubeletの設定" href="/ja/docs/setup/independent/kubelet-integration/"></a>

		
	
		
			

<a class="item" data-title="kubeadmのトラブルシューティング" href="/ja/docs/setup/independent/troubleshooting-kubeadm/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="すぐに利用できるクラウドソリューション">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="AWS EC2上でKubernetesを動かす" href="/ja/docs/setup/turnkey/aws/"></a>

		
	
		
			

<a class="item" data-title="Alibaba CloudでKubernetesを動かす" href="/ja/docs/setup/turnkey/alibaba-cloud/"></a>

		
	
		
			

<a class="item" data-title="Azure 上で Kubernetes を動かす" href="/ja/docs/setup/turnkey/azure/"></a>

		
	
		
			

<a class="item" data-title="CenturyLink Cloud上でKubernetesを動かす" href="/ja/docs/setup/turnkey/clc/"></a>

		
	
		
			

<a class="item" data-title="Google Compute Engine上でKubernetesを動かす" href="/ja/docs/setup/turnkey/gce/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Running Kubernetes on Multiple Clouds with IBM Cloud Private <small>(EN)</small>" href="/docs/setup/turnkey/icp/"></a>

		
	
		
			

<a class="item" data-title="Stackpoint.ioを利用して複数のクラウド上でKubernetesを動かす" href="/ja/docs/setup/turnkey/stackpoint/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="カスタムクラウドソリューション">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="AWSまたはGCE上のCoreOS" href="/ja/docs/setup/custom-cloud/coreos/"></a>

		
	
		
			

<a class="item" data-title="kopsを使ったAWS上でのKubernetesのインストール" href="/ja/docs/setup/custom-cloud/kops/"></a>

		
	
		
			

<a class="item" data-title="kubesprayを使ったオンプレミス/クラウドプロバイダへのKubernetesのインストール" href="/ja/docs/setup/custom-cloud/kubespray/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="オンプレミスVM">
	<div class="container">
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" data-title="Cloudstack" href="/ja/docs/setup/on-premises-vm/cloudstack/"></a>

		
	
		
			

<a class="item" data-title="DC/OS上のKubernetes" href="/ja/docs/setup/on-premises-vm/dcos/"></a>

		
	
		
			

<a class="item" data-title="oVirt" href="/ja/docs/setup/on-premises-vm/ovirt/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" target="_blank" data-title="Kubernetes Version and Version Skew Support Policy <small>(EN)</small>" href="/docs/setup/version-skew-policy/"></a>

		
	
		
			

<a class="item" data-title="大規模クラスタの構築" href="/ja/docs/setup/cluster-large/"></a>

		
	
		
			

<a class="item" data-title="複数のゾーンで動かす" href="/ja/docs/setup/multiple-zones/"></a>

		
	
		
			

<a class="item" data-title="CRIのインストール" href="/ja/docs/setup/cri/"></a>

		
	
		
			

<a class="item" data-title="KRIBを使用してDigital Rebar Provision (DRP)と共にKubernetesをインストールする" href="/ja/docs/setup/on-premises-metal/krib/"></a>

		
	
		
			

<a class="item" data-title="Minikubを使用してローカル環境でKubernetesを動かす" href="/ja/docs/setup/minikube/"></a>

		
	
		
			

<a class="item" data-title="PKI証明書とその要件" href="/ja/docs/setup/certificates/"></a>

		
	
		
			

<a class="item" data-title="ゼロからのカスタムクラスターの作成" href="/ja/docs/setup/scratch/"></a>

		
	
		
			

<a class="item" data-title="ノードのセットアップの検証" href="/ja/docs/setup/node-conformance/"></a>

		
	





     </div> 
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
</div> 


  <div id="docsContent">
  

<p>
  <a href="https://github.com/kubernetes/website/edit/master/content/ja/docs%5csetup%5cindependent%5chigh-availability.md" id="editPageButton" target="_blank">
    Edit This Page
  </a>
</p>

<h1>kubeadmを使用した高可用性クラスターの作成</h1>




<p>This page explains two different approaches to setting up a highly available Kubernetes
cluster using kubeadm:</p>

<ul>
<li>With stacked control plane nodes. This approach requires less infrastructure. The etcd members
and control plane nodes are co-located.</li>
<li>With an external etcd cluster. This approach requires more infrastructure. The
control plane nodes and etcd members are separated.</li>
</ul>

<p>Before proceeding, you should carefully consideer which approach best meets the needs of your applications
and environment. <a href="/docs/setup/independent/ha-topology/">This comparison topic</a> outlines the advantages and disadvantages of each.</p>

<p>Your clusters must run Kubernetes version 1.12 or later. You should also be aware that
setting up HA clusters with kubeadm is still experimental and will be further simplified
in future versions. You might encounter issues with upgrading your clusters, for example.
We encourage you to try either approach, and provide us with feedback in the kubeadm
<a href="https://github.com/kubernetes/kubeadm/issues/new" target="_blank">issue tracker</a>.</p>

<p>Note that the alpha feature gate <code>HighAvailability</code> is deprecated in v1.12 and removed in v1.13.</p>

<p>See also <a href="/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade-ha">The HA upgrade documentation</a>.</p>

<blockquote class="caution">
  <div><strong>Caution:</strong> This page does not address running your cluster on a cloud provider. In a cloud
environment, neither approach documented here works with Service objects of type
LoadBalancer, or with dynamic PersistentVolumes.</div>
</blockquote>











<ul id="markdown-toc">










<li><a href="#before-you-begin">Before you begin</a></li>












<li><a href="#%e4%b8%a1%e6%89%8b%e9%a0%86%e3%81%ab%e3%81%8a%e3%81%91%e3%82%8b%e6%9c%80%e5%88%9d%e3%81%ae%e3%82%b9%e3%83%86%e3%83%83%e3%83%97">両手順における最初のステップ</a></li>




<li><a href="#%e7%a9%8d%e3%81%bf%e9%87%8d%e3%81%aa%e3%81%a3%e3%81%9f%e3%82%b3%e3%83%b3%e3%83%88%e3%83%ad%e3%83%bc%e3%83%ab%e3%83%97%e3%83%ac%e3%83%bc%e3%83%b3%e3%81%a8etcd%e3%83%8e%e3%83%bc%e3%83%89">積み重なったコントロールプレーンとetcdノード</a></li>




<li><a href="#%e5%a4%96%e9%83%a8%e3%81%aeetcd%e3%83%8e%e3%83%bc%e3%83%89">外部のetcdノード</a></li>




<li><a href="#%e3%82%b3%e3%83%b3%e3%83%88%e3%83%ad%e3%83%bc%e3%83%ab%e3%83%97%e3%83%ac%e3%83%bc%e3%83%b3%e8%b5%b7%e5%8b%95%e5%be%8c%e3%81%ae%e5%85%b1%e9%80%9a%e3%82%bf%e3%82%b9%e3%82%af">コントロールプレーン起動後の共通タスク</a></li>



























</ul>



<h2 id="before-you-begin">Before you begin</h2>
<p>For both methods you need this infrastructure:</p>

<ul>
<li>Three machines that meet <a href="/docs/setup/independent/install-kubeadm/#before-you-begin">kubeadm&rsquo;s minimum
requirements</a> for
the masters</li>
<li>Three machines that meet <a href="/docs/setup/independent/install-kubeadm/#before-you-begin">kubeadm&rsquo;s minimum
requirements</a> for
the workers</li>
<li>Full network connectivity between all machines in the cluster (public or
private network)</li>
<li>sudo privileges on all machines</li>
<li>SSH access from one device to all nodes in the system</li>
<li><code>kubeadm</code> and <code>kubelet</code> installed on all machines. <code>kubectl</code> is optional.</li>
</ul>

<p>For the external etcd cluster only, you also need:</p>

<ul>
<li>Three additional machines for etcd members</li>
</ul>

<blockquote class="note">
  <div><strong>Note:</strong> The following examples run Calico as the Pod networking provider. If you run another
networking provider, make sure to replace any default values as needed.</div>
</blockquote>




<h2 id="両手順における最初のステップ">両手順における最初のステップ</h2>

<blockquote class="note">
  <div><strong>Note:</strong> <strong>Note</strong>: All commands on any control plane or etcd node should be
run as root.</div>
</blockquote>

<ul>
<li>Some CNI network plugins like Calico require a CIDR such as <code>192.168.0.0/16</code> and
some like Weave do not. See the see <a href="/docs/setup/independent/create-cluster-kubeadm/#pod-network">the CNI network
documentation</a>.
To add a pod CIDR set the <code>podSubnet: 192.168.0.0/16</code> field under
the <code>networking</code> object of <code>ClusterConfiguration</code>.</li>
</ul>

<h3 id="kube-apiserver用にロードバランサーを作成">kube-apiserver用にロードバランサーを作成</h3>

<blockquote class="note">
  <div><strong>Note:</strong> There are many configurations for load balancers. The following example is only one
option. Your cluster requirements may need a different configuration.</div>
</blockquote>

<ol>
<li><p>Create a kube-apiserver load balancer with a name that resolves to DNS.</p>

<ul>
<li><p>In a cloud environment you should place your control plane nodes behind a TCP
forwarding load balancer. This load balancer distributes traffic to all
healthy control plane nodes in its target list. The health check for
an apiserver is a TCP check on the port the kube-apiserver listens on
(default value <code>:6443</code>).</p></li>

<li><p>It is not recommended to use an IP address directly in a cloud environment.</p></li>

<li><p>The load balancer must be able to communicate with all control plane nodes
on the apiserver port. It must also allow incoming traffic on its
listening port.</p></li>

<li><p><a href="http://www.haproxy.org/" target="_blank">HAProxy</a> can be used as a load balancer.</p></li>

<li><p>Make sure the address of the load balancer always matches
the address of kubeadm&rsquo;s <code>ControlPlaneEndpoint</code>.</p></li>
</ul></li>

<li><p>Add the first control plane nodes to the load balancer and test the
connection:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nc -v LOAD_BALANCER_IP PORT</code></pre></div>
<ul>
<li>A connection refused error is expected because the apiserver is not yet
running. A timeout, however, means the load balancer cannot communicate
with the control plane node. If a timeout occurs, reconfigure the load
balancer to communicate with the control plane node.</li>
</ul></li>

<li><p>Add the remaining control plane nodes to the load balancer target group.</p></li>
</ol>

<h3 id="sshの設定">SSHの設定</h3>

<p>SSH is required if you want to control all nodes from a single machine.</p>

<ol>
<li><p>Enable ssh-agent on your main device that has access to all other nodes in
the system:</p>

<pre><code>eval $(ssh-agent)
</code></pre></li>

<li><p>Add your SSH identity to the session:</p>

<pre><code>ssh-add ~/.ssh/path_to_private_key
</code></pre></li>

<li><p>SSH between nodes to check that the connection is working correctly.</p>

<ul>
<li><p>When you SSH to any node, make sure to add the <code>-A</code> flag:</p>

<pre><code>ssh -A 10.0.0.7
</code></pre></li>

<li><p>When using sudo on any node, make sure to preserve the environment so SSH
forwarding works:</p>

<pre><code>sudo -E -s
</code></pre></li>
</ul></li>
</ol>

<h2 id="積み重なったコントロールプレーンとetcdノード">積み重なったコントロールプレーンとetcdノード</h2>

<h3 id="最初のコントロールプレーンノードの手順">最初のコントロールプレーンノードの手順</h3>

<ol>
<li><p>On the first control plane node, create a configuration file called <code>kubeadm-config.yaml</code>:</p>

<pre><code>apiVersion: kubeadm.k8s.io/v1beta1
kind: ClusterConfiguration
kubernetesVersion: stable
apiServer:
  certSANs:
  - &quot;LOAD_BALANCER_DNS&quot;
controlPlaneEndpoint: &quot;LOAD_BALANCER_DNS:LOAD_BALANCER_PORT&quot;
</code></pre>

<ul>
<li><code>kubernetesVersion</code> should be set to the Kubernetes version to use. This
example uses <code>stable</code>.</li>
<li><code>controlPlaneEndpoint</code> should match the address or DNS and port of the load balancer.</li>
<li>It&rsquo;s recommended that the versions of kubeadm, kubelet, kubectl and Kubernetes match.</li>
</ul></li>

<li><p>Make sure that the node is in a clean state:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo kubeadm init --config<span style="color:#666">=</span>kubeadm-config.yaml</code></pre></div>
<p>You should see something like:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">...
You can now join any number of machines by running the following on each node
as root:
    
kubeadm join <span style="color:#666">192</span>.168.0.200:6443 --token j04n3m.octy8zely83cy2ts --discovery-token-ca-cert-hash    sha256:84938d2a22203a8e56a787ec0c6ddad7bc7dbd52ebabc62fd5f4dbea72b14d1f</code></pre></div></li>

<li><p>Copy this output to a text file. You will need it later to join other control plane nodes to the
cluster.</p></li>

<li><p>Apply the Weave CNI plugin:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl apply -f <span style="color:#b44">&#34;https://cloud.weave.works/k8s/net?k8s-version=</span><span style="color:#a2f;font-weight:bold">$(</span>kubectl version | base64 | tr -d <span style="color:#b44">&#39;\n&#39;</span><span style="color:#a2f;font-weight:bold">)</span><span style="color:#b44">&#34;</span></code></pre></div></li>

<li><p>Type the following and watch the pods of the components get started:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl get pod -n kube-system -w</code></pre></div>
<ul>
<li>It&rsquo;s recommended that you join new control plane nodes only after the first node has finished initializing.</li>
</ul></li>

<li><p>Copy the certificate files from the first control plane node to the rest:</p>

<p>In the following example, replace <code>CONTROL_PLANE_IPS</code> with the IP addresses of the
other control plane nodes.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#b8860b">USER</span><span style="color:#666">=</span>ubuntu <span style="color:#080;font-style:italic"># customizable</span>
<span style="color:#b8860b">CONTROL_PLANE_IPS</span><span style="color:#666">=</span><span style="color:#b44">&#34;10.0.0.7 10.0.0.8&#34;</span>
<span style="color:#a2f;font-weight:bold">for</span> host in <span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">CONTROL_PLANE_IPS</span><span style="color:#b68;font-weight:bold">}</span>; <span style="color:#a2f;font-weight:bold">do</span>
    scp /etc/kubernetes/pki/ca.crt <span style="color:#b44">&#34;</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">&#34;</span>@<span style="color:#b8860b">$host</span>:
    scp /etc/kubernetes/pki/ca.key <span style="color:#b44">&#34;</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">&#34;</span>@<span style="color:#b8860b">$host</span>:
    scp /etc/kubernetes/pki/sa.key <span style="color:#b44">&#34;</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">&#34;</span>@<span style="color:#b8860b">$host</span>:
    scp /etc/kubernetes/pki/sa.pub <span style="color:#b44">&#34;</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">&#34;</span>@<span style="color:#b8860b">$host</span>:
    scp /etc/kubernetes/pki/front-proxy-ca.crt <span style="color:#b44">&#34;</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">&#34;</span>@<span style="color:#b8860b">$host</span>:
    scp /etc/kubernetes/pki/front-proxy-ca.key <span style="color:#b44">&#34;</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">&#34;</span>@<span style="color:#b8860b">$host</span>:
    scp /etc/kubernetes/pki/etcd/ca.crt <span style="color:#b44">&#34;</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">&#34;</span>@<span style="color:#b8860b">$host</span>:etcd-ca.crt
    scp /etc/kubernetes/pki/etcd/ca.key <span style="color:#b44">&#34;</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">&#34;</span>@<span style="color:#b8860b">$host</span>:etcd-ca.key
    scp /etc/kubernetes/admin.conf <span style="color:#b44">&#34;</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">&#34;</span>@<span style="color:#b8860b">$host</span>:
<span style="color:#a2f;font-weight:bold">done</span></code></pre></div></li>
</ol>

<h3 id="残りのコントロールプレーンノードの手順">残りのコントロールプレーンノードの手順</h3>

<ol>
<li><p>Move the files created by the previous step where <code>scp</code> was used:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#b8860b">USER</span><span style="color:#666">=</span>ubuntu <span style="color:#080;font-style:italic"># customizable</span>
mkdir -p /etc/kubernetes/pki/etcd
mv /home/<span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span>/ca.crt /etc/kubernetes/pki/
mv /home/<span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span>/ca.key /etc/kubernetes/pki/
mv /home/<span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span>/sa.pub /etc/kubernetes/pki/
mv /home/<span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span>/sa.key /etc/kubernetes/pki/
mv /home/<span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span>/front-proxy-ca.crt /etc/kubernetes/pki/
mv /home/<span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span>/front-proxy-ca.key /etc/kubernetes/pki/
mv /home/<span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span>/etcd-ca.crt /etc/kubernetes/pki/etcd/ca.crt
mv /home/<span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span>/etcd-ca.key /etc/kubernetes/pki/etcd/ca.key
mv /home/<span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">USER</span><span style="color:#b68;font-weight:bold">}</span>/admin.conf /etc/kubernetes/admin.conf</code></pre></div>
<p>This process writes all the requested files in the <code>/etc/kubernetes</code> folder.</p></li>

<li><p>Start <code>kubeadm join</code> on this node using the join command that was previously given to you by <code>kubeadm init</code> on
the first node. It should look something like this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo kubeadm join <span style="color:#666">192</span>.168.0.200:6443 --token j04n3m.octy8zely83cy2ts --discovery-token-ca-cert-hash sha256:84938d2a22203a8e56a787ec0c6ddad7bc7dbd52ebabc62fd5f4dbea72b14d1f --experimental-control-plane</code></pre></div>
<ul>
<li>Notice the addition of the <code>--experimental-control-plane</code> flag. This flag automates joining this
control plane node to the cluster.</li>
</ul></li>

<li><p>Type the following and watch the pods of the components get started:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl get pod -n kube-system -w</code></pre></div></li>

<li><p>Repeat these steps for the rest of the control plane nodes.</p></li>
</ol>

<h2 id="外部のetcdノード">外部のetcdノード</h2>

<h3 id="etcdクラスターの構築">etcdクラスターの構築</h3>

<ul>
<li>Follow <a href="/docs/setup/independent/setup-ha-etcd-with-kubeadm/">these instructions</a>
to set up the etcd cluster.</li>
</ul>

<h3 id="最初のコントロールプレーンノードの構築">最初のコントロールプレーンノードの構築</h3>

<ol>
<li><p>Copy the following files from any node from the etcd cluster to this node:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#a2f">export</span> <span style="color:#b8860b">CONTROL_PLANE</span><span style="color:#666">=</span><span style="color:#b44">&#34;ubuntu@10.0.0.7&#34;</span>
+scp /etc/kubernetes/pki/etcd/ca.crt <span style="color:#b44">&#34;</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">CONTROL_PLANE</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">&#34;</span>:
+scp /etc/kubernetes/pki/apiserver-etcd-client.crt <span style="color:#b44">&#34;</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">CONTROL_PLANE</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">&#34;</span>:
+scp /etc/kubernetes/pki/apiserver-etcd-client.key <span style="color:#b44">&#34;</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#b8860b">CONTROL_PLANE</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">&#34;</span>:</code></pre></div>
<ul>
<li>Replace the value of <code>CONTROL_PLANE</code> with the <code>user@host</code> of this machine.</li>
</ul></li>

<li><p>Create a file called <code>kubeadm-config.yaml</code> with the following contents:</p>

<pre><code>apiVersion: kubeadm.k8s.io/v1beta1
kind: ClusterConfiguration
kubernetesVersion: stable
apiServer:
  certSANs:
  - &quot;LOAD_BALANCER_DNS&quot;
controlPlaneEndpoint: &quot;LOAD_BALANCER_DNS:LOAD_BALANCER_PORT&quot;
etcd:
    external:
        endpoints:
        - https://ETCD_0_IP:2379
        - https://ETCD_1_IP:2379
        - https://ETCD_2_IP:2379
        caFile: /etc/kubernetes/pki/etcd/ca.crt
        certFile: /etc/kubernetes/pki/apiserver-etcd-client.crt
        keyFile: /etc/kubernetes/pki/apiserver-etcd-client.key
</code></pre>

<ul>
<li><p>The difference between stacked etcd and external etcd here is that we are using the <code>external</code> field for <code>etcd</code> in the kubeadm config. In the case of the stacked etcd topology this is managed automatically.</p></li>

<li><p>Replace the following variables in the template with the appropriate values for your cluster:</p>

<ul>
<li><code>LOAD_BALANCER_DNS</code></li>
<li><code>LOAD_BALANCER_PORT</code></li>
<li><code>ETCD_0_IP</code></li>
<li><code>ETCD_1_IP</code></li>
<li><code>ETCD_2_IP</code></li>
</ul></li>
</ul></li>

<li><p>Run <code>kubeadm init --config kubeadm-config.yaml</code> on this node.</p></li>

<li><p>Write the join command that is returned to a text file for later use.</p></li>

<li><p>Apply the Weave CNI plugin:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl apply -f <span style="color:#b44">&#34;https://cloud.weave.works/k8s/net?k8s-version=</span><span style="color:#a2f;font-weight:bold">$(</span>kubectl version | base64 | tr -d <span style="color:#b44">&#39;\n&#39;</span><span style="color:#a2f;font-weight:bold">)</span><span style="color:#b44">&#34;</span></code></pre></div></li>
</ol>

<h3 id="残りのコントロールプレーンノードの手順-1">残りのコントロールプレーンノードの手順</h3>

<p>To add the rest of the control plane nodes, follow <a href="#steps-for-the-rest-of-the-control-plane-nodes">these instructions</a>.
The steps are the same as for the stacked etcd setup, with the exception that a local
etcd member is not created.</p>

<p>To summarize:</p>

<ul>
<li>Make sure the first control plane node is fully initialized.</li>
<li>Copy certificates between the first control plane node and the other control plane nodes.</li>
<li>Join each control plane node with the join command you saved to a text file, plus add the <code>--experimental-control-plane</code> flag.</li>
</ul>

<h2 id="コントロールプレーン起動後の共通タスク">コントロールプレーン起動後の共通タスク</h2>

<h3 id="podネットワークのインストール">Podネットワークのインストール</h3>

<p><a href="/docs/setup/independent/create-cluster-kubeadm/#pod-network">Follow these instructions</a> to install
the pod network. Make sure this corresponds to whichever pod CIDR you provided
in the master configuration file.</p>

<h3 id="ワーカーのインストール">ワーカーのインストール</h3>

<p>Each worker node can now be joined to the cluster with the command returned from any of the
<code>kubeadm init</code> commands. The flag <code>--experimental-control-plane</code> should not be added to worker nodes.</p>



















<nav class="pagination"><a class="nav nav-prev" href="/ja/docs/setup/independent/ha-topology/" title="Options for Highly Available Topology"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - Options for Highly Available Topology</a>
<a class="nav nav-next" href="/ja/docs/setup/independent/setup-ha-etcd-with-kubeadm/" title="kubeadmを使用した高可用性etcdクラスターの作成">Next - kubeadmを使用した高可用性etcdクラスターの作成 <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav>


  
  <h2>Feedback</h2>
  <p class="feedback--prompt">Was this page helpful? </p>
  <button class="button feedback--yes">Yes</button>
  <button class="button feedback--no">No</button>
  <p class="feedback--response feedback--response__hidden">
    Thanks for the feedback. If you have a specific, answerable question about how to use Kubernetes,
    ask it on <a target="_blank" rel="noopener"
    href="https://stackoverflow.com/questions/tagged/kubernetes">Stack Overflow</a>. Open
    an issue in the GitHub repo if you want to <a class="feedback--link" target="_blank" rel="noopener"
    href="https://github.com/kubernetes/website/issues/new?title=Issue%20with%20k8s.io">report a problem</a> or
    <a class="feedback--link" target="_blank" rel="noopener"
    href="https://github.com/kubernetes/website/issues/new?title=Improvement%20for%20k8s.io">suggest an improvement</a>.
  </p>
  <script>
    const yes = document.querySelector('.feedback--yes');
    const no = document.querySelector('.feedback--no');
    document.querySelectorAll('.feedback--link').forEach(link => {
      link.href = link.href + window.location.pathname;
    });
    const sendFeedback = (value) => {
      if (!gtag) { console.log('!gtag'); }
      gtag('event', 'click', {
        'event_category': 'Helpful',
        'event_label': window.location.pathname,
        value
      });
    };
    const disableButtons = () => {
      yes.disabled = true;
      yes.classList.add('feedback--button__disabled');
      no.disabled = true;
      no.classList.add('feedback--button__disabled');
    };
    yes.addEventListener('click', () => {
      sendFeedback(1);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
    no.addEventListener('click', () => {
      sendFeedback(0);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
  </script>


  <div id="pre-footer"> 
  <hr />

  <div class="issue-button-container">
    <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs%5csetup%5cindependent%5chigh-availability.md?pixel" alt="Analytics" /></a></p>
    
    
    <script type="text/javascript">
    PDRTJS_settings_8345992 = {
    "id" : "8345992",
    "unique_id" : "\/ja\/docs\/setup\/independent\/high-availability\/",
    "title" : "kubeadmを使用した高可用性クラスターの作成",
    "permalink" : "https:\/\/qinlj.github.io\/ja\/docs\/setup\/independent\/high-availability\/"
    };
    (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
    </script>
    <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?title=Issue%20with%20' +
    'k8s.io'+window.location.pathname)" class="button issue">Issue作成</a>
    
    
    
    <a href="https://github.com/kubernetes/website/edit/master/content/ja/docs%5csetup%5cindependent%5chigh-availability.md" class="button issue">ページ編集</a>
    
  </div>
  

  <div id="lastedit" class="lastedit issue-button-container">
    ページの最終更新 March 08, 2019 at 3:17 AM PST by
    <a href="https://github.com/kubernetes/website/commit/edb233cac2f4f910dd55311a3c63bdfbd53a081b/">First Japanese l10n work for release-1.13 (#12998)</a> (<a href="https://github.com/kubernetes/website/commits/master/content/en/docs%5csetup%5cindependent%5chigh-availability.md">ページ履歴</a>)
  </div>
  
</div>

  <div class="post-comment">
    
    


<div id="lv-container" data-id="city" data-uid="MTAyMC80MzQxMi8xOTk1Mw==">
  <script type="text/javascript">
    (function(d, s) {
      var j, e = d.getElementsByTagName(s)[0];

      if (typeof LivereTower === 'function') { return; }

      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;

      e.parentNode.insertBefore(j, e);
    })(document, 'script');
  </script>
  <noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
</div>



  </div>
  
  <div class="container" role="main" itemscope itemtype="http://schema.org/Article">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
        
        
<div>
  <h5 id="tags">Share: 
  </h5>
</div>
        
        <article role="main" class="blog-post" itemprop="articleBody" id="content">
          ...
          





          
          <div class="social-share" data-initialized="true" data-wechat-qrcode-title="不扫别后悔">
  <center>
    <font style="font-size:18px;color:darkcyan;">分享到：</font>
    <a href="#" class="social-share-icon icon-weibo"></a>
    <a href="#" class="social-share-icon icon-wechat"></a>
    <a href="#" class="social-share-icon icon-twitter"></a>
    <a href="#" class="social-share-icon icon-linkedin"></a>
    <a href="#" class="social-share-icon icon-facebook"></a>
    <a href="#" class="social-share-icon icon-qq"></a>
    <a href="#" class="social-share-icon icon-qzone"></a>
  </center>
</div>


<script src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/social-share.min.js"></script>
          
        </article>
      </div>
    </div>
  </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            
            
            
            <a href="/ja/docs/home/">ホーム</a>
            
            
            
            
            
            
            
            <a href="/ja/case-studies/">ケーススタディ</a>
            
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>フォーラム</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>イベントカレンダー</span></a>
            </div>
            <div>
                
                <a href="https://git.k8s.io/community/contributors/guide" class="button">コントリビュート</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2019 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a></a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2019 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
        <div id="miceType" class="center">
            ICP license: 京ICP备17074266号-3
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<script>

(function () {
    window.addEventListener('DOMContentLoaded', init)

        
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>



<script language="application/javascript">
  
  (function addHeadingLinks(){
    var article = document.getElementById('docsContent');
    var headings = article.querySelectorAll('h1, h2, h3, h4, h5, h6');
    headings.forEach(function(heading){
      if(heading.id){
        var a = document.createElement('a');
        a.innerHTML = heading.innerHTML;
        a.href = '#'+heading.id;
        a.classList.add('inpage_heading');
        heading.innerHTML = '';
        heading.appendChild(a);
      }
    });
  })();
</script>
</body>
</html>