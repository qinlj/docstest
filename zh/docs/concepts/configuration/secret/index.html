<!DOCTYPE html>
<html id="docs" lang="en" class="">
<head>
  

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36037335-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-36037335-10');
</script>
<meta charset="utf-8">
<title>Secret - SuperMap iDesktop .NET</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="/Test_hugo/images/favicon.png">
<link rel="stylesheet" href="/css/base_fonts.css">
<link rel="stylesheet" href="/css/styles.css">
<link rel="stylesheet" href="/Test_hugo/css/jquery-ui.min.css">
<link rel="stylesheet" href="/Test_hugo/css/sweetalert.min.css">
<link rel="stylesheet" href="/Test_hugo/css/callouts.css">
<link rel="stylesheet" href="/Test_hugo/css/custom-jekyll/tags.css">



<meta name="description" content="Secret 对象类型用来保存敏感信息，例如密码、OAuth 令牌和 ssh key。将这些信息放在 secret 中比放在 pod 的定义或者 docker 镜像中来说更加安全和灵活。参阅 Secret 设计文档 获取更多详细信息。
   Secret 概览  内置 secret  Service Account 使用 API 凭证自动创建和附加 secret  创建您自己的 Secret  使用 kubectl 创建 Secret 手动创建 Secret 解码 Secret  使用 Secret  在 Pod 中使用 Secret 文件 Secret 作为环境变量 使用 imagePullSecret  安排 imagePullSecrets 自动附加  自动挂载手动创建的 Secret   详细  限制 Secret 与 Pod 生命周期的联系  使用案例  使用案例：包含 ssh 密钥的 pod 使用案例：包含 prod/test 凭据的 pod 使用案例：Secret 卷中以点号开头的文件 使用案例：Secret 仅对 pod 中的一个容器可见  最佳实践  客户端使用 Secret API  安全属性  保护 风险     Secret 概览 Secret 是一种包含少量敏感信息例如密码、token 或 key 的对象。这样的信息可能会被放在 Pod spec 中或者镜像中；将其放在一个 secret 对象中可以更好地控制它的用途，并降低意外暴露的风险。">
<meta property="og:description" content="Secret 对象类型用来保存敏感信息，例如密码、OAuth 令牌和 ssh key。将这些信息放在 secret 中比放在 pod 的定义或者 docker 镜像中来说更加安全和灵活。参阅 Secret 设计文档 获取更多详细信息。
   Secret 概览  内置 secret  Service Account 使用 API 凭证自动创建和附加 secret  创建您自己的 Secret  使用 kubectl 创建 Secret 手动创建 Secret 解码 Secret  使用 Secret  在 Pod 中使用 Secret 文件 Secret 作为环境变量 使用 imagePullSecret  安排 imagePullSecrets 自动附加  自动挂载手动创建的 Secret   详细  限制 Secret 与 Pod 生命周期的联系  使用案例  使用案例：包含 ssh 密钥的 pod 使用案例：包含 prod/test 凭据的 pod 使用案例：Secret 卷中以点号开头的文件 使用案例：Secret 仅对 pod 中的一个容器可见  最佳实践  客户端使用 Secret API  安全属性  保护 风险     Secret 概览 Secret 是一种包含少量敏感信息例如密码、token 或 key 的对象。这样的信息可能会被放在 Pod spec 中或者镜像中；将其放在一个 secret 对象中可以更好地控制它的用途，并降低意外暴露的风险。">
<meta name="twitter:description" content="Secret 对象类型用来保存敏感信息，例如密码、OAuth 令牌和 ssh key。将这些信息放在 secret 中比放在 pod 的定义或者 docker 镜像中来说更加安全和灵活。参阅 Secret 设计文档 获取更多详细信息。
   Secret 概览  内置 secret  Service Account 使用 API 凭证自动创建和附加 secret  创建您自己的 Secret  使用 kubectl 创建 Secret 手动创建 Secret 解码 Secret  使用 Secret  在 Pod 中使用 Secret 文件 Secret 作为环境变量 使用 imagePullSecret  安排 imagePullSecrets 自动附加  自动挂载手动创建的 Secret   详细  限制 Secret 与 Pod 生命周期的联系  使用案例  使用案例：包含 ssh 密钥的 pod 使用案例：包含 prod/test 凭据的 pod 使用案例：Secret 卷中以点号开头的文件 使用案例：Secret 仅对 pod 中的一个容器可见  最佳实践  客户端使用 Secret API  安全属性  保护 风险     Secret 概览 Secret 是一种包含少量敏感信息例如密码、token 或 key 的对象。这样的信息可能会被放在 Pod spec 中或者镜像中；将其放在一个 secret 对象中可以更好地控制它的用途，并降低意外暴露的风险。">
<meta property="og:url" content="https://SuperMap_iDesktop.gitee.io/Test_hugo/zh/docs/concepts/configuration/secret/">
<meta property="og:title" content="Secret">
<meta name="twitter:title" content="Secret">

<meta name="twitter:image:alt"   content="SuperMap iDesktop .NET">

<meta property="og:image" content="/Test_hugo/images/kubernetes-horizontal-color.png">

<meta property="og:type" content="article">
<script src="/Test_hugo/js/anchor-4.1.1.min.js"></script>
<script src="/Test_hugo/js/jquery-3.2.1.min.js"></script>
<script src="/Test_hugo/js/jquery-ui-1.12.1.min.js"></script>
<script src="/Test_hugo/js/bootstrap-3.3.7.min.js"></script>
<script src="/Test_hugo/js/sweetalert-1.1.3.min.js"></script>
<script src="/Test_hugo/js/script.js"></script>
<script src="/Test_hugo/js/custom-jekyll/tags.js"></script>


</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/Test_hugo/zh/" class="logo"></a>
    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            
            
            <li><a href="/Test_hugo/zh/docs/" class="active">GIS 百科</a></li>
            
            <li><a href="/Test_hugo/zh/blog/">技术专题</a></li>
            
            
            
            
            
            <li><a href="/Test_hugo/zh/case-studies/">三维技术专题</a></li>
            
            
            
             <li>
                <a href="#">
                    中文 Chinese <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="/Test_hugo/docs/concepts/configuration/secret/">English</a></li>
                
                </ul>
            </li>

            <li>
                <a href="#">
                    v1.13 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="https://kubernetes.io">v1.13</a></li>
                
                    <li><a href="https://v1-12.docs.kubernetes.io">v1.12</a></li>
                
                    <li><a href="https://v1-11.docs.kubernetes.io">v1.11</a></li>
                
                    <li><a href="https://v1-10.docs.kubernetes.io">v1.10</a></li>
                
                    <li><a href="https://v1-9.docs.kubernetes.io">v1.9</a></li>
                
                </ul>
            </li>
        </ul>

        <form id="searchBox" action="/search/">
          <input type="text" id="search" name="q" placeholder="搜索" aria-label="Search">
        </form>

    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
         
           <div class="nav-box">
            <h3><a href="/Test_hugo/zh/docs/home/">文档</a></h3>
           <p>通过演练，示例和参考文档了解如何使用 Kubernetes。你甚至可以<a href="/editdocs/" data-auto-burger-exclude>帮助贡献文档</a>！</p>

        </div>
         
           <div class="nav-box">
            <h3><a href="/Test_hugo/zh/blog/">技术专题</a></h3>
           <p>阅读关于 kubernetes 和容器规范的最新信息,以及获取最新的技术。</p>

        </div>
         
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">想要修改 Kubernetes 的核心源代码</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>在 GitHub 上查看</a>
        </div>

        <div class="right">
            <h5 class="github-invite">了解社区</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack Slack</span></a>
                <a href="https://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>



<section id="hero" class="light-text no-sub">
  













<h1>概念</h1>
<h5></h5>


<div id="vendorStrip" class="light-text">
	<ul>
		
		
		<li><a href="/Test_hugo/zh/docs/home/">主页</a></li>
		
		
		<li><a href="/Test_hugo/zh/docs/surfaceanalyst/">表面分析</a></li>
		
		
		<li><a href="/Test_hugo/zh/docs/datamanage/">数据管理</a></li>
		
		
		<li><a href="/Test_hugo/zh/docs/dataconversion/">数据转换</a></li>
		
		
		<li><a href="/Test_hugo/zh/docs/concepts/" class="YAH">概念</a></li>
		
	</ul>
	<form id="searchBox" action="/docs/search/">
		<input type="text" id="search" name="q" placeholder="搜索" aria-label="Search">
  </form>
</div>

</section>



<section id="encyclopedia">
  
<div id="docsToc">
     <div class="pi-accordion">
    	
        
        
        
        
        
         
             
                 
             
         
             
                 
             
         
             
                 
             
         
             
                 
             
         
             
                 
                          
                          
                 
             
         
             
         
             
         
             
         
             
         
         
        
        <a class="item" data-title="概念" href="/Test_hugo/zh/docs/concepts/"></a>

	
	
			
			
			
			
			
		
	
	
	
		
			
<div class="item" data-title="Overview">
	<div class="container">
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="What is Kubernetes? <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/what-is-kubernetes/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Kubernetes Components <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/components/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="The Kubernetes API <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/kubernetes-api/"></a>

		
	
		
			
<div class="item" data-title="Working with Kubernetes Objects">
	<div class="container">
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Understanding Kubernetes Objects <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/working-with-objects/kubernetes-objects/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Names <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/working-with-objects/names/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Namespaces <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/working-with-objects/namespaces/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Labels and Selectors <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/working-with-objects/labels/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Annotations <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/working-with-objects/annotations/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Field Selectors <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/working-with-objects/field-selectors/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Recommended Labels <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/working-with-objects/common-labels/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Object Management Using kubectl">
	<div class="container">
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Kubernetes Object Management <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/object-management-kubectl/overview/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Managing Kubernetes Objects Using Imperative Commands <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/object-management-kubectl/imperative-command/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Imperative Management of Kubernetes Objects Using Configuration Files <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/object-management-kubectl/imperative-config/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Declarative Management of Kubernetes Objects Using Configuration Files <small>(EN)</small>" href="/Test_hugo/docs/concepts/overview/object-management-kubectl/declarative-config/"></a>

		
	

	</div>
</div>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Kubernetes Architecture">
	<div class="container">
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Nodes <small>(EN)</small>" href="/Test_hugo/docs/concepts/architecture/nodes/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Master-Node communication <small>(EN)</small>" href="/Test_hugo/docs/concepts/architecture/master-node-communication/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Concepts Underlying the Cloud Controller Manager <small>(EN)</small>" href="/Test_hugo/docs/concepts/architecture/cloud-controller/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Containers">
	<div class="container">
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Images <small>(EN)</small>" href="/Test_hugo/docs/concepts/containers/images/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Container Environment Variables <small>(EN)</small>" href="/Test_hugo/docs/concepts/containers/container-environment-variables/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Runtime Class <small>(EN)</small>" href="/Test_hugo/docs/concepts/containers/runtime-class/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Container Lifecycle Hooks <small>(EN)</small>" href="/Test_hugo/docs/concepts/containers/container-lifecycle-hooks/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="Taint 和 Toleration" href="/Test_hugo/zh/docs/concepts/configuration/taint-and-toleration/"></a>

		
	
		
			
<div class="item" data-title="工作负载">
	<div class="container">
		
		
		
		<a class="item" data-title="工作负载" href="/Test_hugo/zh/docs/concepts/workloads/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			
<div class="item" data-title="Pods">
	<div class="container">
		
		
		
		<a class="item" data-title="Pods" href="/Test_hugo/zh/docs/concepts/workloads/pods/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Pod Overview <small>(EN)</small>" href="/Test_hugo/docs/concepts/workloads/pods/pod-overview/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Pods <small>(EN)</small>" href="/Test_hugo/docs/concepts/workloads/pods/pod/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Disruptions <small>(EN)</small>" href="/Test_hugo/docs/concepts/workloads/pods/disruptions/"></a>

		
	
		
			

<a class="item" data-title="Init 容器" href="/Test_hugo/zh/docs/concepts/workloads/pods/init-containers/"></a>

		
	
		
			

<a class="item" data-title="Pod Preset" href="/Test_hugo/zh/docs/concepts/workloads/pods/podpreset/"></a>

		
	
		
			

<a class="item" data-title="Pod 的生命周期" href="/Test_hugo/zh/docs/concepts/workloads/pods/pod-lifecycle/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Controllers">
	<div class="container">
		
		
		
		<a class="item" data-title="Controllers" href="/Test_hugo/zh/docs/concepts/workloads/controllers/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="ReplicaSet <small>(EN)</small>" href="/Test_hugo/docs/concepts/workloads/controllers/replicaset/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="ReplicationController <small>(EN)</small>" href="/Test_hugo/docs/concepts/workloads/controllers/replicationcontroller/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="StatefulSets <small>(EN)</small>" href="/Test_hugo/docs/concepts/workloads/controllers/statefulset/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="TTL Controller for Finished Resources <small>(EN)</small>" href="/Test_hugo/docs/concepts/workloads/controllers/ttlafterfinished/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Jobs - Run to Completion <small>(EN)</small>" href="/Test_hugo/docs/concepts/workloads/controllers/jobs-run-to-completion/"></a>

		
	
		
			

<a class="item" data-title="Cron Job" href="/Test_hugo/zh/docs/concepts/workloads/controllers/cron-jobs/"></a>

		
	
		
			

<a class="item" data-title="DaemonSet" href="/Test_hugo/zh/docs/concepts/workloads/controllers/daemonset/"></a>

		
	
		
			

<a class="item" data-title="Deployments" href="/Test_hugo/zh/docs/concepts/workloads/controllers/deployment/"></a>

		
	
		
			

<a class="item" data-title="垃圾收集" href="/Test_hugo/zh/docs/concepts/workloads/controllers/garbage-collection/"></a>

		
	

	</div>
</div>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Services, Load Balancing, and Networking">
	<div class="container">
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Services <small>(EN)</small>" href="/Test_hugo/docs/concepts/services-networking/service/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="DNS for Services and Pods <small>(EN)</small>" href="/Test_hugo/docs/concepts/services-networking/dns-pod-service/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Connecting Applications with Services <small>(EN)</small>" href="/Test_hugo/docs/concepts/services-networking/connect-applications-service/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Ingress <small>(EN)</small>" href="/Test_hugo/docs/concepts/services-networking/ingress/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Ingress Controllers <small>(EN)</small>" href="/Test_hugo/docs/concepts/services-networking/ingress-controllers/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Network Policies <small>(EN)</small>" href="/Test_hugo/docs/concepts/services-networking/network-policies/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Adding entries to Pod /etc/hosts with HostAliases <small>(EN)</small>" href="/Test_hugo/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="存储">
	<div class="container">
		
		
		
		<a class="item" data-title="存储" href="/Test_hugo/zh/docs/concepts/storage/"></a>
		
		
	
	
			
			
			
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Volumes <small>(EN)</small>" href="/Test_hugo/docs/concepts/storage/volumes/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Persistent Volumes <small>(EN)</small>" href="/Test_hugo/docs/concepts/storage/persistent-volumes/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Volume Snapshots <small>(EN)</small>" href="/Test_hugo/docs/concepts/storage/volume-snapshots/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Storage Classes <small>(EN)</small>" href="/Test_hugo/docs/concepts/storage/storage-classes/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Volume Snapshot Classes <small>(EN)</small>" href="/Test_hugo/docs/concepts/storage/volume-snapshot-classes/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Dynamic Volume Provisioning <small>(EN)</small>" href="/Test_hugo/docs/concepts/storage/dynamic-provisioning/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Node-specific Volume Limits <small>(EN)</small>" href="/Test_hugo/docs/concepts/storage/storage-limits/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Configuration">
	<div class="container">
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Configuration Best Practices <small>(EN)</small>" href="/Test_hugo/docs/concepts/configuration/overview/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Managing Compute Resources for Containers <small>(EN)</small>" href="/Test_hugo/docs/concepts/configuration/manage-compute-resources-container/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Assigning Pods to Nodes <small>(EN)</small>" href="/Test_hugo/docs/concepts/configuration/assign-pod-node/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Taints and Tolerations <small>(EN)</small>" href="/Test_hugo/docs/concepts/configuration/taint-and-toleration/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Secrets <small>(EN)</small>" href="/Test_hugo/docs/concepts/configuration/secret/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Organizing Cluster Access Using kubeconfig Files <small>(EN)</small>" href="/Test_hugo/docs/concepts/configuration/organize-cluster-access-kubeconfig/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Pod Priority and Preemption <small>(EN)</small>" href="/Test_hugo/docs/concepts/configuration/pod-priority-preemption/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Scheduler Performance Tuning <small>(EN)</small>" href="/Test_hugo/docs/concepts/configuration/scheduler-perf-tuning/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Policies">
	<div class="container">
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Resource Quotas <small>(EN)</small>" href="/Test_hugo/docs/concepts/policy/resource-quotas/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Pod Security Policies <small>(EN)</small>" href="/Test_hugo/docs/concepts/policy/pod-security-policy/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Cluster Administration">
	<div class="container">
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Cluster Administration Overview <small>(EN)</small>" href="/Test_hugo/docs/concepts/cluster-administration/cluster-administration-overview/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Certificates <small>(EN)</small>" href="/Test_hugo/docs/concepts/cluster-administration/certificates/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Cloud Providers <small>(EN)</small>" href="/Test_hugo/docs/concepts/cluster-administration/cloud-providers/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Managing Resources <small>(EN)</small>" href="/Test_hugo/docs/concepts/cluster-administration/manage-deployment/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Cluster Networking <small>(EN)</small>" href="/Test_hugo/docs/concepts/cluster-administration/networking/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Logging Architecture <small>(EN)</small>" href="/Test_hugo/docs/concepts/cluster-administration/logging/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Configuring kubelet Garbage Collection <small>(EN)</small>" href="/Test_hugo/docs/concepts/cluster-administration/kubelet-garbage-collection/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Federation <small>(EN)</small>" href="/Test_hugo/docs/concepts/cluster-administration/federation/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Proxies in Kubernetes <small>(EN)</small>" href="/Test_hugo/docs/concepts/cluster-administration/proxies/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Controller manager metrics <small>(EN)</small>" href="/Test_hugo/docs/concepts/cluster-administration/controller-metrics/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Installing Addons <small>(EN)</small>" href="/Test_hugo/docs/concepts/cluster-administration/addons/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Extending Kubernetes">
	<div class="container">
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Extending your Kubernetes Cluster <small>(EN)</small>" href="/Test_hugo/docs/concepts/extend-kubernetes/extend-cluster/"></a>

		
	
		
			
<div class="item" data-title="Extending the Kubernetes API">
	<div class="container">
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Extending the Kubernetes API with the aggregation layer <small>(EN)</small>" href="/Test_hugo/docs/concepts/extend-kubernetes/api-extension/apiserver-aggregation/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Custom Resources <small>(EN)</small>" href="/Test_hugo/docs/concepts/extend-kubernetes/api-extension/custom-resources/"></a>

		
	

	</div>
</div>

		
	
		
			
<div class="item" data-title="Compute, Storage, and Networking Extensions">
	<div class="container">
		
		
	
	
			
			
		
	
	
	
		
			

<a class="item" target="_blank" data-title="Network Plugins <small>(EN)</small>" href="/Test_hugo/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Device Plugins <small>(EN)</small>" href="/Test_hugo/docs/concepts/extend-kubernetes/compute-storage-net/device-plugins/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" target="_blank" data-title="Service Catalog <small>(EN)</small>" href="/Test_hugo/docs/concepts/extend-kubernetes/service-catalog/"></a>

		
	
		
			

<a class="item" target="_blank" data-title="Poseidon-Firmament - An alternate scheduler <small>(EN)</small>" href="/Test_hugo/docs/concepts/extend-kubernetes/poseidon-firmament-alternate-scheduler/"></a>

		
	

	</div>
</div>

		
	
		
			

<a class="item" data-title="" href="/Test_hugo/zh/docs/concepts/architecture/cloud-controller/"></a>

		
	
		
			

<a class="item" data-title="" href="/Test_hugo/zh/docs/concepts/overview/kubernetes-api/"></a>

		
	
		
			

<a class="item" data-title="DNS Pod 与 Service" href="/Test_hugo/zh/docs/concepts/services-networking/dns-pod-service/"></a>

		
	
		
			

<a class="item" data-title="Kubernetes 中的代理" href="/Test_hugo/zh/docs/concepts/cluster-administration/proxies/"></a>

		
	
		
			

<a class="item" data-title="Kubernetes 组件" href="/Test_hugo/zh/docs/concepts/overview/components/"></a>

		
	
		
			

<a class="item" data-title="Kubernetes集群中使用Sysctls" href="/Test_hugo/zh/docs/concepts/cluster-administration/sysctl-cluster/"></a>

		
	
		
			

<a class="item" data-title="Managing Compute Resources for Containers" href="/Test_hugo/zh/docs/concepts/configuration/manage-compute-resources-container/"></a>

		
	
		
			

<a class="item" data-title="Master 节点通信" href="/Test_hugo/zh/docs/concepts/architecture/master-node-communication/"></a>

		
	
		
			

<a class="item" data-title="Nodes" href="/Test_hugo/zh/docs/concepts/architecture/nodes/"></a>

		
	
		
			

<a class="item" data-title="Pod 安全策略" href="/Test_hugo/zh/docs/concepts/policy/pod-security-policy/"></a>

		
	
		
			

<a class="item" data-title="Secret" href="/Test_hugo/zh/docs/concepts/configuration/secret/"></a>

		
	
		
			

<a class="item" data-title="Service" href="/Test_hugo/zh/docs/concepts/services-networking/service/"></a>

		
	
		
			

<a class="item" data-title="云供应商" href="/Test_hugo/zh/docs/concepts/cluster-administration/cloud-providers/"></a>

		
	
		
			

<a class="item" data-title="使用 HostAliases 向 Pod /etc/hosts 文件添加条目" href="/Test_hugo/zh/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/"></a>

		
	
		
			

<a class="item" data-title="安装扩展（Addons）" href="/Test_hugo/zh/docs/concepts/cluster-administration/addons/"></a>

		
	
		
			

<a class="item" data-title="容器环境变量" href="/Test_hugo/zh/docs/concepts/containers/container-environment-variables/"></a>

		
	
		
			

<a class="item" data-title="应用连接到 Service" href="/Test_hugo/zh/docs/concepts/services-networking/connect-applications-service/"></a>

		
	
		
			

<a class="item" data-title="概念模板示例" href="/Test_hugo/zh/docs/concepts/example-concept-template/"></a>

		
	
		
			

<a class="item" data-title="理解 Kubernetes 对象" href="/Test_hugo/zh/docs/concepts/overview/working-with-objects/kubernetes-objects/"></a>

		
	
		
			

<a class="item" data-title="网络策略" href="/Test_hugo/zh/docs/concepts/services-networking/network-policies/"></a>

		
	
		
			

<a class="item" data-title="联邦" href="/Test_hugo/zh/docs/concepts/cluster-administration/federation/"></a>

		
	
		
			

<a class="item" data-title="认识 Kubernetes?" href="/Test_hugo/zh/docs/concepts/overview/what-is-kubernetes/"></a>

		
	
		
			

<a class="item" data-title="设备插件" href="/Test_hugo/zh/docs/concepts/cluster-administration/device-plugins/"></a>

		
	
		
			

<a class="item" data-title="证书" href="/Test_hugo/zh/docs/concepts/cluster-administration/certificates/"></a>

		
	
		
			

<a class="item" data-title="资源配额" href="/Test_hugo/zh/docs/concepts/policy/resource-quotas/"></a>

		
	
		
			

<a class="item" data-title="镜像" href="/Test_hugo/zh/docs/concepts/containers/images/"></a>

		
	
		
			

<a class="item" data-title="集群管理概述" href="/Test_hugo/zh/docs/concepts/cluster-administration/cluster-administration-overview/"></a>

		
	





     </div> 
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
</div> 


  <div id="docsContent">
  

<p>
  <a href="https://github.com/kubernetes/website/edit/master/content/zh/docs%5cconcepts%5cconfiguration%5csecret.md" id="editPageButton" target="_blank">
    Edit This Page
  </a>
</p>

<h1>Secret</h1>





<p><code>Secret</code> 对象类型用来保存敏感信息，例如密码、OAuth 令牌和 ssh key。将这些信息放在 <code>secret</code> 中比放在 <code>pod</code> 的定义或者 docker 镜像中来说更加安全和灵活。参阅 <a href="https://git.k8s.io/community/contributors/design-proposals/secrets.md" target="_blank">Secret 设计文档</a> 获取更多详细信息。</p>

<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#secret-概览">Secret 概览</a>
<ul>
<li><a href="#内置-secret">内置 secret</a>
<ul>
<li><a href="#service-account-使用-api-凭证自动创建和附加-secret">Service Account 使用 API 凭证自动创建和附加 secret</a></li>
</ul></li>
<li><a href="#创建您自己的-secret">创建您自己的 Secret</a>
<ul>
<li><a href="#使用-kubectl-创建-secret">使用 kubectl 创建 Secret</a></li>
<li><a href="#手动创建-secret">手动创建 Secret</a></li>
<li><a href="#解码-secret">解码 Secret</a></li>
</ul></li>
<li><a href="#使用-secret">使用 Secret</a>
<ul>
<li><a href="#在-pod-中使用-secret-文件">在 Pod 中使用 Secret 文件</a></li>
<li><a href="#secret-作为环境变量">Secret 作为环境变量</a></li>
<li><a href="#使用-imagepullsecret">使用 imagePullSecret</a></li>
</ul></li>
<li><a href="#安排-imagepullsecrets-自动附加">安排 imagePullSecrets 自动附加</a>
<ul>
<li><a href="#自动挂载手动创建的-secret">自动挂载手动创建的 Secret</a></li>
</ul></li>
</ul></li>
<li><a href="#详细">详细</a>
<ul>
<li><a href="#限制">限制</a></li>
<li><a href="#secret-与-pod-生命周期的联系">Secret 与 Pod 生命周期的联系</a></li>
</ul></li>
<li><a href="#使用案例">使用案例</a>
<ul>
<li><a href="#使用案例-包含-ssh-密钥的-pod">使用案例：包含 ssh 密钥的 pod</a></li>
<li><a href="#使用案例-包含-prod-test-凭据的-pod">使用案例：包含 prod/test 凭据的 pod</a></li>
<li><a href="#使用案例-secret-卷中以点号开头的文件">使用案例：Secret 卷中以点号开头的文件</a></li>
<li><a href="#使用案例-secret-仅对-pod-中的一个容器可见">使用案例：Secret 仅对 pod 中的一个容器可见</a></li>
</ul></li>
<li><a href="#最佳实践">最佳实践</a>
<ul>
<li><a href="#客户端使用-secret-api">客户端使用 Secret API</a></li>
</ul></li>
<li><a href="#安全属性">安全属性</a>
<ul>
<li><a href="#保护">保护</a></li>
<li><a href="#风险">风险</a></li>
</ul></li>
</ul></li>
</ul>
</nav>

<h2 id="secret-概览">Secret 概览</h2>

<p>Secret 是一种包含少量敏感信息例如密码、token 或 key 的对象。这样的信息可能会被放在 Pod spec 中或者镜像中；将其放在一个 secret 对象中可以更好地控制它的用途，并降低意外暴露的风险。</p>

<p>用户可以创建 secret，同时系统也创建了一些 secret。</p>

<p>要使用 secret，pod 需要引用 secret。Pod 可以用两种方式使用 secret：作为 <a href="/docs/concepts/storage/volumes/">volume</a> 中的文件被挂载到 pod 中的一个或者多个容器里，或者当 kubelet 为 pod 拉取镜像时使用。</p>

<h3 id="内置-secret">内置 secret</h3>

<h4 id="service-account-使用-api-凭证自动创建和附加-secret">Service Account 使用 API 凭证自动创建和附加 secret</h4>

<p>Kubernetes 自动创建包含访问 API 凭据的 secret，并自动修改您的 pod 以使用此类型的 secret。</p>

<p>如果需要，可以禁用或覆盖自动创建和使用API凭据。但是，如果您需要的只是安全地访问 apiserver，我们推荐这样的工作流程。</p>

<p>参阅  <a href="/docs/user-guide/service-accounts">Service Account</a> 文档获取关于 Service Account 如何工作的更多信息。</p>

<h3 id="创建您自己的-secret">创建您自己的 Secret</h3>

<h4 id="使用-kubectl-创建-secret">使用 kubectl 创建 Secret</h4>

<p>假设有些 pod 需要访问数据库。这些 pod 需要使用的用户名和密码在您本地机器的 <code>./username.txt</code> 和 <code>./password.txt</code> 文件里。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#080;font-style:italic"># Create files needed for rest of example.</span>
$ <span style="color:#a2f">echo</span> -n <span style="color:#b44">&#34;admin&#34;</span> &gt; ./username.txt
$ <span style="color:#a2f">echo</span> -n <span style="color:#b44">&#34;1f2d1e2e67df&#34;</span> &gt; ./password.txt</code></pre></div>
<p><code>kubectl create secret</code> 命令将这些文件打包到一个 Secret 中并在 API server 中创建了一个对象。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl create secret generic db-user-pass --from-file<span style="color:#666">=</span>./username.txt --from-file<span style="color:#666">=</span>./password.txt
secret <span style="color:#b44">&#34;db-user-pass&#34;</span> created</code></pre></div>
<p>您可以这样检查刚创建的 secret：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl get secrets
NAME                  TYPE                                  DATA      AGE
db-user-pass          Opaque                                <span style="color:#666">2</span>         51s

$ kubectl describe secrets/db-user-pass
Name:            db-user-pass
Namespace:       default
Labels:          &lt;none&gt;
Annotations:     &lt;none&gt;

Type:            Opaque

<span style="color:#b8860b">Data</span>
<span style="color:#666">====</span>
password.txt:    <span style="color:#666">12</span> bytes
username.txt:    <span style="color:#666">5</span> bytes</code></pre></div>
<p>请注意，默认情况下，<code>get</code> 和 <code>describe</code> 命令都不会显示文件的内容。这是为了防止将 secret 中的内容被意外暴露给从终端日志记录中刻意寻找它们的人。</p>

<p>请参阅 <a href="#decoding-a-secret">解码 secret</a> 了解如何查看它们的内容。</p>

<h4 id="手动创建-secret">手动创建 Secret</h4>

<p>您也可以先以 json 或 yaml 格式在文件中创建一个 secret 对象，然后创建该对象。</p>

<p>每一项必须是 base64 编码：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ <span style="color:#a2f">echo</span> -n <span style="color:#b44">&#34;admin&#34;</span> | base64
<span style="color:#b8860b">YWRtaW4</span><span style="color:#666">=</span>
$ <span style="color:#a2f">echo</span> -n <span style="color:#b44">&#34;1f2d1e2e67df&#34;</span> | base64
MWYyZDFlMmU2N2Rm</code></pre></div>
<p>现在可以像这样写一个 secret 对象：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Secret<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>mysecret<span style="color:#bbb">
</span><span style="color:#bbb"></span>type:<span style="color:#bbb"> </span>Opaque<span style="color:#bbb">
</span><span style="color:#bbb"></span>data:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>username:<span style="color:#bbb"> </span>YWRtaW4=<span style="color:#bbb">
</span><span style="color:#bbb">  </span>password:<span style="color:#bbb"> </span>MWYyZDFlMmU2N2Rm</code></pre></div>
<p>数据字段是一个映射。它的键必须匹配 <a href="https://git.k8s.io/community/contributors/design-proposals/identifiers.md" target="_blank"><code>DNS_SUBDOMAIN</code></a>，前导点也是可以的。这些值可以是任意数据，使用 base64 进行编码。</p>

<p>使用  <a href="/docs/user-guide/kubectl/v1.7/#create"><code>kubectl create</code></a> 创建 secret：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl create -f ./secret.yaml
secret <span style="color:#b44">&#34;mysecret&#34;</span> created</code></pre></div>
<p><strong>编码注意：</strong> secret 数据的序列化 JSON 和 YAML 值使用 base64 编码成字符串。换行符在这些字符串中无效，必须省略。当在 Darwin/OS X 上使用 <code>base64</code> 实用程序时，用户应避免使用 <code>-b</code> 选项来拆分长行。另外，对于 Linux 用户如果 <code>-w</code> 选项不可用的话，应该添加选项 <code>-w 0</code> 到 <code>base64</code> 命令或管道 <code>base64 | tr -d '\n'</code> 。</p>

<h4 id="解码-secret">解码 Secret</h4>

<p>可以使用 <code>kubectl get secret</code> 命令获取 secret。例如，获取在上一节中创建的 secret：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl get secret mysecret -o yaml
apiVersion: v1
data:
  username: <span style="color:#b8860b">YWRtaW4</span><span style="color:#666">=</span>
  password: MWYyZDFlMmU2N2Rm
kind: Secret
metadata:
  creationTimestamp: <span style="color:#666">2016</span>-01-22T18:41:56Z
  name: mysecret
  namespace: default
  resourceVersion: <span style="color:#b44">&#34;164619&#34;</span>
  selfLink: /api/v1/namespaces/default/secrets/mysecret
  uid: cfee02d6-c137-11e5-8d73-42010af00002
type: Opaque</code></pre></div>
<p>解码密码字段：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ <span style="color:#a2f">echo</span> <span style="color:#b44">&#34;MWYyZDFlMmU2N2Rm&#34;</span> | base64 --decode
1f2d1e2e67df</code></pre></div>
<h3 id="使用-secret">使用 Secret</h3>

<p>Secret 可以作为数据卷被挂载，或作为环境变量暴露出来以供 pod 中的容器使用。它们也可以被系统的其他部分使用，而不直接暴露在 pod 内。例如，它们可以保存凭据，系统的其他部分应该用它来代表您与外部系统进行交互。</p>

<h4 id="在-pod-中使用-secret-文件">在 Pod 中使用 Secret 文件</h4>

<p>在 Pod 中的 volume 里使用 Secret：</p>

<ol>
<li>创建一个 secret 或者使用已有的 secret。多个 pod 可以引用同一个 secret。</li>
<li>修改您的 pod 的定义在 <code>spec.volumes[]</code> 下增加一个 volume。可以给这个 volume 随意命名，它的 <code>spec.volumes[].secret.secretName</code> 必须等于 secret 对象的名字。</li>
<li>将 <code>spec.containers[].volumeMounts[]</code> 加到需要用到该 secret 的容器中。指定 <code>spec.containers[].volumeMounts[].readOnly = true</code> 和 <code>spec.containers[].volumeMounts[].mountPath</code> 为您想要该 secret 出现的尚未使用的目录。</li>
<li>修改您的镜像并且／或者命令行让程序从该目录下寻找文件。Secret 的 <code>data</code> 映射中的每一个键都成为了 <code>mountPath</code> 下的一个文件名。</li>
</ol>

<p>这是一个在 pod 中使用 volume 挂在 secret 的例子：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>mypod<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>mypod<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>redis<span style="color:#bbb">
</span><span style="color:#bbb">    </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">      </span>mountPath:<span style="color:#bbb"> </span><span style="color:#b44">&#34;/etc/foo&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>readOnly:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>volumes:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">    </span>secret:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>secretName:<span style="color:#bbb"> </span>mysecret</code></pre></div>
<p>您想要用的每个 secret 都需要在 <code>spec.volumes</code> 中指明。</p>

<p>如果 pod 中有多个容器，每个容器都需要自己的 <code>volumeMounts</code> 配置块，但是每个 secret 只需要一个 <code>spec.volumes</code>。</p>

<p>您可以打包多个文件到一个 secret 中，或者使用的多个 secret，怎样方便就怎样来。</p>

<p><strong>向特性路径映射 secret 密钥</strong></p>

<p>我们还可以控制 Secret key 映射在 volume 中的路径。您可以使用 <code>spec.volumes[].secret.items</code> 字段修改每个 key 的目标路径：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>mypod<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>mypod<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>redis<span style="color:#bbb">
</span><span style="color:#bbb">    </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">      </span>mountPath:<span style="color:#bbb"> </span><span style="color:#b44">&#34;/etc/foo&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>readOnly:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>volumes:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">    </span>secret:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>secretName:<span style="color:#bbb"> </span>mysecret<span style="color:#bbb">
</span><span style="color:#bbb">      </span>items:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>key:<span style="color:#bbb"> </span>username<span style="color:#bbb">
</span><span style="color:#bbb">        </span>path:<span style="color:#bbb"> </span>my-group/my-username</code></pre></div>
<p>将会发生什么呢：</p>

<ul>
<li><code>username</code> secret 存储在 <code>/etc/foo/my-group/my-username</code> 文件中而不是 <code>/etc/foo/username</code> 中。</li>
<li><code>password</code> secret 没有被映射</li>
</ul>

<p>如果使用了 <code>spec.volumes[].secret.items</code>，只有在 <code>items</code> 中指定的 key 被映射。要使用 secret 中所有的 key，所有这些都必须列在 <code>items</code> 字段中。所有列出的密钥必须存在于相应的 secret 中。否则，不会创建卷。</p>

<p><strong>Secret 文件权限</strong></p>

<p>您还可以指定 secret 将拥有的权限模式位文件。如果不指定，默认使用 <code>0644</code>。您可以为整个保密卷指定默认模式，如果需要，可以覆盖每个密钥。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>mypod<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>mypod<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>redis<span style="color:#bbb">
</span><span style="color:#bbb">    </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">      </span>mountPath:<span style="color:#bbb"> </span><span style="color:#b44">&#34;/etc/foo&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>volumes:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">    </span>secret:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>secretName:<span style="color:#bbb"> </span>mysecret<span style="color:#bbb">
</span><span style="color:#bbb">      </span>defaultMode:<span style="color:#bbb"> </span><span style="color:#666">256</span></code></pre></div>
<p>然后，secret 将被挂载到 <code>/etc/foo</code> 目录，所有通过该 secret volume 挂载创建的文件的权限都是 <code>0400</code>。</p>

<p>请注意，JSON 规范不支持八进制符号，因此使用 256 值作为 0400 权限。如果您使用 yaml 而不是 json 作为 pod，则可以使用八进制符号以更自然的方式指定权限。</p>

<p>您还可以使用映射，如上一个示例，并为不同的文件指定不同的权限，如下所示：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>mypod<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>mypod<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>redis<span style="color:#bbb">
</span><span style="color:#bbb">    </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">      </span>mountPath:<span style="color:#bbb"> </span><span style="color:#b44">&#34;/etc/foo&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>volumes:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>foo<span style="color:#bbb">
</span><span style="color:#bbb">    </span>secret:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>secretName:<span style="color:#bbb"> </span>mysecret<span style="color:#bbb">
</span><span style="color:#bbb">      </span>items:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>key:<span style="color:#bbb"> </span>username<span style="color:#bbb">
</span><span style="color:#bbb">        </span>path:<span style="color:#bbb"> </span>my-group/my-username<span style="color:#bbb">
</span><span style="color:#bbb">        </span>mode:<span style="color:#bbb"> </span><span style="color:#666">511</span></code></pre></div>
<p>在这种情况下，导致 <code>/etc/foo/my-group/my-username</code> 的文件的权限值为 <code>0777</code>。由于 JSON 限制，必须以十进制格式指定模式。</p>

<p>请注意，如果稍后阅读此权限值可能会以十进制格式显示。</p>

<p><strong>从 Volume 中消费 secret 值</strong></p>

<p>在挂载的 secret volume 的容器内，secret key 将作为文件，并且 secret 的值使用 base-64 解码并存储在这些文件中。这是在上面的示例容器内执行的命令的结果：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ ls /etc/foo/
username
password
$ cat /etc/foo/username
admin
$ cat /etc/foo/password
1f2d1e2e67df</code></pre></div>
<p>容器中的程序负责从文件中读取 secret。</p>

<p><strong>挂载的 secret 被自动更新</strong></p>

<p>当已经在 volume 中被消费的 secret 被更新时，被映射的 key 也将被更新。</p>

<p>Kubelet 在周期性同步时检查被挂载的 secret 是不是最新的。但是，它正在使用其基于本地 ttl 的缓存来获取当前的 secret 值。结果是，当 secret 被更新的时刻到将新的 secret 映射到 pod 的时刻的总延迟可以与 kubelet 中的secret 缓存的 kubelet sync period + ttl 一样长。</p>

<h4 id="secret-作为环境变量">Secret 作为环境变量</h4>

<p>将 secret 作为 pod 中的环境变量使用：</p>

<ol>
<li>创建一个 secret 或者使用一个已存在的 secret。多个 pod 可以引用同一个 secret。</li>
<li>修改 Pod 定义，为每个要使用 secret 的容器添加对应 secret key 的环境变量。消费secret key 的环境变量应填充 secret 的名称，并键入 <code>env[x].valueFrom.secretKeyRef</code>。</li>
<li>修改镜像并／或者命令行，以便程序在指定的环境变量中查找值。</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>secret-env-pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>mycontainer<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>redis<span style="color:#bbb">
</span><span style="color:#bbb">    </span>env:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>SECRET_USERNAME<span style="color:#bbb">
</span><span style="color:#bbb">        </span>valueFrom:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>secretKeyRef:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>name:<span style="color:#bbb"> </span>mysecret<span style="color:#bbb">
</span><span style="color:#bbb">            </span>key:<span style="color:#bbb"> </span>username<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>SECRET_PASSWORD<span style="color:#bbb">
</span><span style="color:#bbb">        </span>valueFrom:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>secretKeyRef:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>name:<span style="color:#bbb"> </span>mysecret<span style="color:#bbb">
</span><span style="color:#bbb">            </span>key:<span style="color:#bbb"> </span>password<span style="color:#bbb">
</span><span style="color:#bbb">  </span>restartPolicy:<span style="color:#bbb"> </span>Never</code></pre></div>
<p><strong>消费环境变量里的 Secret 值</strong></p>

<p>在一个消耗环境变量 secret 的容器中，secret key 作为包含 secret 数据的 base-64 解码值的常规环境变量。这是从上面的示例在容器内执行的命令的结果：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ <span style="color:#a2f">echo</span> <span style="color:#b8860b">$SECRET_USERNAME</span>
admin
$ <span style="color:#a2f">echo</span> <span style="color:#b8860b">$SECRET_PASSWORD</span>
1f2d1e2e67df</code></pre></div>
<h4 id="使用-imagepullsecret">使用 imagePullSecret</h4>

<p>imagePullSecret 是将包含 Docker（或其他）镜像注册表密码的 secret 传递给 Kubelet 的一种方式，因此可以代表您的 pod 拉取私有镜像。</p>

<p><strong>手动指定 imagePullSecret</strong></p>

<p>imagePullSecret 的使用在 <a href="/docs/concepts/containers/images/#specifying-imagepullsecrets-on-a-pod">镜像文档</a> 中说明。</p>

<h3 id="安排-imagepullsecrets-自动附加">安排 imagePullSecrets 自动附加</h3>

<p>您可以手动创建 imagePullSecret，并从 serviceAccount 引用它。使用该 serviceAccount 创建的任何 pod 和默认使用该 serviceAccount 的 pod 将会将其的 imagePullSecret 字段设置为服务帐户的 imagePullSecret 字段。有关该过程的详细说明，请参阅 <a href="/docs/tasks/configure-pod-container/configure-service-account/#adding-imagepullsecrets-to-a-service-account">将 ImagePullSecrets 添加到服务帐户</a>。</p>

<h4 id="自动挂载手动创建的-secret">自动挂载手动创建的 Secret</h4>

<p>手动创建的 secret（例如包含用于访问 github 帐户的令牌）可以根据其服务帐户自动附加到 pod。请参阅 <a href="/docs/tasks/run-application/podpreset/">使用 PodPreset 向 Pod 中注入信息</a> 以获取该进程的详细说明。</p>

<h2 id="详细">详细</h2>

<h3 id="限制">限制</h3>

<p>验证 secret volume 来源确保指定的对象引用实际上指向一个类型为 Secret 的对象。因此，需要在依赖于它的任何 pod 之前创建一个 secret。</p>

<p>Secret API 对象驻留在命名空间中。它们只能由同一命名空间中的 pod 引用。</p>

<p>每个 secret 的大小限制为1MB。这是为了防止创建非常大的 secret 会耗尽 apiserver 和 kubelet 的内存。然而，创建许多较小的 secret 也可能耗尽内存。更全面得限制 secret 对内存使用的功能还在计划中。</p>

<p>Kubelet 仅支持从 API server 获取的 Pod 使用 secret。这包括使用 kubectl 创建的任何 pod，或间接通过 replication controller 创建的 pod。它不包括通过 kubelet <code>--manifest-url</code> 标志，其 <code>--config</code> 标志或其 REST API 创建的pod（这些不是创建 pod 的常用方法）。</p>

<p>必须先创建 secret，除非将它们标记为可选项，否则必须在将其作为环境变量在 pod 中使用之前创建 secret。对不存在的 secret 的引用将阻止其启动。</p>

<p>使用 <code>secretKeyRef</code> ，引用指定的 secret 中的不存在的 key ，这会阻止 pod 的启动。</p>

<p>对于通过 <code>envFrom</code> 填充环境变量的 secret，这些环境变量具有被认为是无效环境变量名称的 key 将跳过这些键。该 pod 将被允许启动。将会有一个事件，其原因是 <code>InvalidVariableNames</code>，该消息将包含被跳过的无效键的列表。该示例显示一个 pod，它指的是包含2个无效键，1badkey 和 2alsobad 的默认/mysecret ConfigMap。</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl get events
LASTSEEN   FIRSTSEEN   COUNT     NAME            KIND      SUBOBJECT                         TYPE      REASON
0s         0s          <span style="color:#666">1</span>         dapi-test-pod   Pod                                         Warning   InvalidEnvironmentVariableNames   kubelet, <span style="color:#666">127</span>.0.0.1      Keys <span style="color:#666">[</span>1badkey, 2alsobad<span style="color:#666">]</span> from the EnvFrom secret default/mysecret were skipped since they are considered invalid environment variable names.</code></pre></div>
<h3 id="secret-与-pod-生命周期的联系">Secret 与 Pod 生命周期的联系</h3>

<p>通过 API 创建 Pod 时，不会检查应用的 secret 是否存在。一旦 Pod 被调度，kubelet 就会尝试获取该 secret 的值。如果获取不到该 secret，或者暂时无法与 API server 建立连接，kubelet 将会定期重试。Kubelet 将会报告关于 pod 的事件，并解释它无法启动的原因。一旦获取到 secret，kubelet将创建并装载一个包含它的卷。在所有 pod 的卷被挂载之前，都不会启动 pod 的容器。</p>

<h2 id="使用案例">使用案例</h2>

<h3 id="使用案例-包含-ssh-密钥的-pod">使用案例：包含 ssh 密钥的 pod</h3>

<p>创建一个包含 ssh key 的 secret：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl create secret generic ssh-key-secret --from-file<span style="color:#666">=</span>ssh-privatekey<span style="color:#666">=</span>/path/to/.ssh/id_rsa --from-file<span style="color:#666">=</span>ssh-publickey<span style="color:#666">=</span>/path/to/.ssh/id_rsa.pub</code></pre></div>
<p><strong>安全性注意事项</strong>：发送自己的 ssh 密钥之前要仔细思考：集群的其他用户可能有权访问该密钥。使用您想要共享 Kubernetes 群集的所有用户可以访问的服务帐户，如果它们遭到入侵，可以撤销。</p>

<p>现在我们可以创建一个使用 ssh 密钥引用 secret 的pod，并在一个卷中使用它：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>secret-test-pod<span style="color:#bbb">
</span><span style="color:#bbb">  </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>name:<span style="color:#bbb"> </span>secret-test<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>volumes:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>secret-volume<span style="color:#bbb">
</span><span style="color:#bbb">    </span>secret:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>secretName:<span style="color:#bbb"> </span>ssh-key-secret<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>ssh-test-container<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>mySshImage<span style="color:#bbb">
</span><span style="color:#bbb">    </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>secret-volume<span style="color:#bbb">
</span><span style="color:#bbb">      </span>readOnly:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>mountPath:<span style="color:#bbb"> </span><span style="color:#b44">&#34;/etc/secret-volume&#34;</span></code></pre></div>
<p>当容器中的命令运行时，密钥的片段将可在以下目录：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">/etc/secret-volume/ssh-publickey
/etc/secret-volume/ssh-privatekey</code></pre></div>
<p>然后容器可以自由使用密钥数据建立一个 ssh 连接。</p>

<h3 id="使用案例-包含-prod-test-凭据的-pod">使用案例：包含 prod/test 凭据的 pod</h3>

<p>下面的例子说明一个 pod 消费一个包含 prod 凭据的 secret，另一个 pod 使用测试环境凭据消费 secret。</p>

<p>创建 secret：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl create secret generic prod-db-secret --from-literal<span style="color:#666">=</span><span style="color:#b8860b">username</span><span style="color:#666">=</span>produser --from-literal<span style="color:#666">=</span><span style="color:#b8860b">password</span><span style="color:#666">=</span>Y4nys7f11
secret <span style="color:#b44">&#34;prod-db-secret&#34;</span> created
$ kubectl create secret generic test-db-secret --from-literal<span style="color:#666">=</span><span style="color:#b8860b">username</span><span style="color:#666">=</span>testuser --from-literal<span style="color:#666">=</span><span style="color:#b8860b">password</span><span style="color:#666">=</span>iluvtests
secret <span style="color:#b44">&#34;test-db-secret&#34;</span> created</code></pre></div>
<p>创建 pod ：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>List<span style="color:#bbb">
</span><span style="color:#bbb"></span>items:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb">  </span>apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb">  </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>name:<span style="color:#bbb"> </span>prod-db-client-pod<span style="color:#bbb">
</span><span style="color:#bbb">    </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>name:<span style="color:#bbb"> </span>prod-db-client<span style="color:#bbb">
</span><span style="color:#bbb">  </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>volumes:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>secret-volume<span style="color:#bbb">
</span><span style="color:#bbb">      </span>secret:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>secretName:<span style="color:#bbb"> </span>prod-db-secret<span style="color:#bbb">
</span><span style="color:#bbb">    </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>db-client-container<span style="color:#bbb">
</span><span style="color:#bbb">      </span>image:<span style="color:#bbb"> </span>myClientImage<span style="color:#bbb">
</span><span style="color:#bbb">      </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>secret-volume<span style="color:#bbb">
</span><span style="color:#bbb">        </span>readOnly:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>mountPath:<span style="color:#bbb"> </span><span style="color:#b44">&#34;/etc/secret-volume&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb"> </span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb">  </span>apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb">  </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>name:<span style="color:#bbb"> </span>test-db-client-pod<span style="color:#bbb">
</span><span style="color:#bbb">    </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>name:<span style="color:#bbb"> </span>test-db-client<span style="color:#bbb">
</span><span style="color:#bbb">  </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>volumes:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>secret-volume<span style="color:#bbb">
</span><span style="color:#bbb">      </span>secret:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>secretName:<span style="color:#bbb"> </span>test-db-secret<span style="color:#bbb">
</span><span style="color:#bbb">    </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>db-client-container<span style="color:#bbb">
</span><span style="color:#bbb">      </span>image:<span style="color:#bbb"> </span>myClientImage<span style="color:#bbb">
</span><span style="color:#bbb">      </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>secret-volume<span style="color:#bbb">
</span><span style="color:#bbb">        </span>readOnly:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>mountPath:<span style="color:#bbb"> </span><span style="color:#b44">&#34;/etc/secret-volume&#34;</span></code></pre></div>
<p>这两个容器将在其文件系统上显示以下文件，其中包含每个容器环境的值：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">/etc/secret-volume/username
/etc/secret-volume/password</code></pre></div>
<p>请注意，两个 pod 的 spec 配置中仅有一个字段有所不同；这有助于使用普通的 pod 配置模板创建具有不同功能的 pod。您可以使用两个 service account 进一步简化基本 pod spec：一个名为 <code>prod-user</code> 拥有  <code>prod-db-secret</code> ，另一个称为 <code>test-user</code> 拥有 <code>test-db-secret</code> 。然后，pod spec 可以缩短为，例如：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>prod-db-client-pod<span style="color:#bbb">
</span><span style="color:#bbb">  </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>name:<span style="color:#bbb"> </span>prod-db-client<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>serviceAccount:<span style="color:#bbb"> </span>prod-db-client<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>db-client-container<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>myClientImage</code></pre></div>
<h3 id="使用案例-secret-卷中以点号开头的文件">使用案例：Secret 卷中以点号开头的文件</h3>

<p>为了将数据“隐藏”起来（即文件名以点号开头的文件），简单地说让该键以一个点开始。例如，当如下 secret 被挂载到卷中：</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">kind:<span style="color:#bbb"> </span>Secret<span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>dotfile-secret<span style="color:#bbb">
</span><span style="color:#bbb"></span>data:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>.secret-file:<span style="color:#bbb"> </span>dmFsdWUtMg0KDQo=<span style="color:#bbb">
</span><span style="color:#bbb"></span>---<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>secret-dotfiles-pod<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>volumes:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>secret-volume<span style="color:#bbb">
</span><span style="color:#bbb">    </span>secret:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>secretName:<span style="color:#bbb"> </span>dotfile-secret<span style="color:#bbb">
</span><span style="color:#bbb">  </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>dotfile-test-container<span style="color:#bbb">
</span><span style="color:#bbb">    </span>image:<span style="color:#bbb"> </span>k8s.gcr.io/busybox<span style="color:#bbb">
</span><span style="color:#bbb">    </span>command:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>ls<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span><span style="color:#b44">&#34;-l&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span><span style="color:#b44">&#34;/etc/secret-volume&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>secret-volume<span style="color:#bbb">
</span><span style="color:#bbb">      </span>readOnly:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>mountPath:<span style="color:#bbb"> </span><span style="color:#b44">&#34;/etc/secret-volume&#34;</span></code></pre></div>
<p><code>Secret-volume</code> 将包含一个单独的文件，叫做 <code>.secret-file</code>，<code>dotfile-test-container</code> 的 <code>/etc/secret-volume/.secret-file</code> 路径下将有该文件。</p>

<p><strong>注意</strong></p>

<p>以点号开头的文件在 <code>ls -l</code> 的输出中被隐藏起来了；列出目录内容时，必须使用 <code>ls -la</code> 才能查看它们。</p>

<h3 id="使用案例-secret-仅对-pod-中的一个容器可见">使用案例：Secret 仅对 pod 中的一个容器可见</h3>

<p>考虑以下一个需要处理 HTTP 请求的程序，执行一些复杂的业务逻辑，然后使用 HMAC 签署一些消息。因为它具有复杂的应用程序逻辑，所以在服务器中可能会出现一个未被注意的远程文件读取漏洞，这可能会将私钥暴露给攻击者。</p>

<p>这可以在两个容器中分为两个进程：前端容器，用于处理用户交互和业务逻辑，但无法看到私钥；以及可以看到私钥的签名者容器，并且响应来自前端的简单签名请求（例如通过本地主机网络）。</p>

<p>使用这种分割方法，攻击者现在必须欺骗应用程序服务器才能进行任意的操作，这可能比使其读取文件更难。</p>

<!-- TODO: explain how to do this while still using automation. -->

<h2 id="最佳实践">最佳实践</h2>

<h3 id="客户端使用-secret-api">客户端使用 Secret API</h3>

<p>当部署与 secret API 交互的应用程序时，应使用诸如 <a href="https://kubernetes.io/docs/admin/authorization/rbac/" target="_blank">RBAC</a> 之类的 <a href="https://kubernetes.io/docs/admin/authorization/" target="_blank">授权策略</a> 来限制访问。</p>

<p>Secret 中的值对于不同的环境来说重要性可能不同，例如对于 Kubernetes 集群内部（例如 service account 令牌）和集群外部来说就不一样。即使一个应用程序可以理解其期望的与之交互的 secret 有多大的能力，但是同一命名空间中的其他应用程序却可能不这样认为。</p>

<p>由于这些原因，在命名空间中 <code>watch</code> 和 <code>list</code>  secret 的请求是非常强大的功能，应该避免这样的行为，因为列出 secret 可以让客户端检查所有 secret 是否在该命名空间中。在群集中<code>watch</code> 和 <code>list</code> 所有 secret 的能力应该只保留给最有特权的系统级组件。</p>

<p>需要访问 secrets API 的应用程序应该根据他们需要的 secret 执行 <code>get</code> 请求。这允许管理员限制对所有 secret 的访问，同时设置 <a href="https://kubernetes.io/docs/admin/authorization/rbac/#referring-to-resources" target="_blank">白名单访问</a> 应用程序需要的各个实例。</p>

<p>为了提高循环获取的性能，客户端可以设计引用 secret 的资源，然后 <code>watch</code> 资源，在引用更改时重新请求 secret。此外，还提出了一种 <a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/bulk_watch.md" target="_blank">”批量监控“ API</a> 来让客户端 <code>watch</code> 每个资源，该功能可能会在将来的 Kubernetes 版本中提供。</p>

<h2 id="安全属性">安全属性</h2>

<h3 id="保护">保护</h3>

<p>因为 <code>secret</code> 对象可以独立于使用它们的 <code>pod</code> 而创建，所以在创建、查看和编辑 pod 的流程中 secret 被暴露的风险较小。系统还可以对 <code>secret</code> 对象采取额外的预防措施，例如避免将其写入到磁盘中可能的位置。</p>

<p>只有当节点上的 pod 需要用到该 secret 时，该 secret 才会被发送到该节点上。它不会被写入磁盘，而是存储在 tmpfs 中。一旦依赖于它的 pod 被删除，它就被删除。</p>

<p>在大多数 Kubernetes 项目维护的发行版中，用户与 API server 之间的通信以及从 API server 到 kubelet 的通信都受到 SSL/TLS 的保护。通过这些通道传输时，secret 受到保护。</p>

<p>节点上的 secret 数据存储在 tmpfs 卷中，因此不会传到节点上的其他磁盘。</p>

<p>同一节点上的很多个 pod 可能拥有多个 secret。但是，只有 pod 请求的 secret 在其容器中才是可见的。因此，一个 pod 不能访问另一个 Pod 的 secret。</p>

<p>Pod 中有多个容器。但是，pod 中的每个容器必须请求其挂载卷中的 secret 卷才能在容器内可见。这可以用于 <a href="#使用案例secret-仅对-pod-中的一个容器可见">在 Pod 级别构建安全分区</a>。</p>

<h3 id="风险">风险</h3>

<ul>
<li>API server 的 secret 数据以纯文本的方式存储在 etcd 中，因此：

<ul>
<li>管理员应该限制 admin 用户访问 etcd；</li>
<li>API server 中的 secret 数据位于 etcd 使用的磁盘上；管理员可能希望在不再使用时擦除/粉碎 etcd 使用的磁盘</li>
</ul></li>
<li>如果您将 secret 数据编码为 base64 的清单（JSON 或 YAML）文件，共享该文件或将其检入代码库，这样的话该密码将会被泄露。 Base64 编码不是一种加密方式，一样也是纯文本。</li>
<li>应用程序在从卷中读取 secret 后仍然需要保护 secret 的值，例如不会意外记录或发送给不信任方。</li>
<li>可以创建和使用 secret 的 pod 的用户也可以看到该 secret 的值。即使 API server 策略不允许用户读取 secret 对象，用户也可以运行暴露 secret 的 pod。</li>
<li>如果运行了多个副本，那么这些 secret 将在它们之间共享。默认情况下，etcd 不能保证与 SSL/TLS 的对等通信，尽管可以进行配置。</li>
<li>目前，任何节点的 root 用户都可以通过模拟 kubelet 来读取 API server 中的任何 secret。只有向实际需要它们的节点发送 secret 才能限制单个节点的根漏洞的影响，该功能还在计划中。</li>
</ul>



<nav class="pagination"><a class="nav nav-prev" href="/Test_hugo/zh/docs/concepts/policy/pod-security-policy/" title="Pod 安全策略"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - Pod 安全策略</a>
<a class="nav nav-next" href="/Test_hugo/zh/docs/concepts/services-networking/service/" title="Service">Next - Service <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav>


  
  <h2>反馈</h2>
  <p class="feedback--prompt">此页是否对您有帮助？ </p>
  <button class="button feedback--yes">是</button>
  <button class="button feedback--no">否</button>
  <p class="feedback--response feedback--response__hidden">
    Thanks for the feedback. If you have a specific, answerable question about how to use Kubernetes,
    ask it on <a target="_blank" rel="noopener"
    href="https://stackoverflow.com/questions/tagged/kubernetes">Stack Overflow</a>. Open
    an issue in the GitHub repo if you want to <a class="feedback--link" target="_blank" rel="noopener"
    href="https://github.com/kubernetes/website/issues/new?title=Issue%20with%20k8s.io">report a problem</a> or
    <a class="feedback--link" target="_blank" rel="noopener"
    href="https://github.com/kubernetes/website/issues/new?title=Improvement%20for%20k8s.io">suggest an improvement</a>.
  </p>
  <script>
    const yes = document.querySelector('.feedback--yes');
    const no = document.querySelector('.feedback--no');
    document.querySelectorAll('.feedback--link').forEach(link => {
      link.href = link.href + window.location.pathname;
    });
    const sendFeedback = (value) => {
      if (!gtag) { console.log('!gtag'); }
      gtag('event', 'click', {
        'event_category': 'Helpful',
        'event_label': window.location.pathname,
        value
      });
    };
    const disableButtons = () => {
      yes.disabled = true;
      yes.classList.add('feedback--button__disabled');
      no.disabled = true;
      no.classList.add('feedback--button__disabled');
    };
    yes.addEventListener('click', () => {
      sendFeedback(1);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
    no.addEventListener('click', () => {
      sendFeedback(0);
      disableButtons();
      document.querySelector('.feedback--response').classList.remove('feedback--response__hidden');
    });
  </script>


  <div id="pre-footer"> 
  <hr />

  <div class="issue-button-container">
    <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs%5cconcepts%5cconfiguration%5csecret.md?pixel" alt="Analytics" /></a></p>
    
    
    <script type="text/javascript">
    PDRTJS_settings_8345992 = {
    "id" : "8345992",
    "unique_id" : "\/Test_hugo\/zh\/docs\/concepts\/configuration\/secret\/",
    "title" : "Secret",
    "permalink" : "https:\/\/SuperMap_iDesktop.gitee.io\/Test_hugo\/zh\/docs\/concepts\/configuration\/secret\/"
    };
    (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
    </script>
    <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?title=Issue%20with%20' +
    'k8s.io'+window.location.pathname)" class="button issue">创建 GitHub issue</a>
    
    
    
    <a href="https://github.com/kubernetes/website/edit/master/content/zh/docs%5cconcepts%5cconfiguration%5csecret.md" class="button issue">修改本页面</a>
    
  </div>
  

  <div id="lastedit" class="lastedit issue-button-container">
    页面最后一次修改于 October 12, 2018 at 2:25 PM PST by
    <a href="https://github.com/kubernetes/website/commit/abcee2dccd17c94376595b34cc05e56345a7f06c/">Update localization guidelines (#10485)</a> (<a href="https://github.com/kubernetes/website/commits/master/content/en/docs%5cconcepts%5cconfiguration%5csecret.md">页面历史</a>)
  </div>
  
</div>

  <div class="post-comment">
    
    

<div id="vcomments"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>

<script type="text/javascript">
    new Valine({
        el: '#vcomments' ,
        appId: 'BKVEHk6tElIcscdmyQlg0U3l-gzGzoHsz',
        appKey: 'RPl3UVDsJQlSv1olxy01A3pO',
        notify: 'false',
        verify: 'false',
        avatar:'SuperMap',
        placeholder: '说点什么吧...',
        visitor: 'true'
    });
</script>

  </div>
  </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            
            
            
            <a href="/Test_hugo/zh/docs/home/">主页</a>
            
            <a href="/Test_hugo/zh/blog/">技术专题</a>
            
            
            
            
            
            <a href="/Test_hugo/zh/case-studies/">三维技术专题</a>
            
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>GitHub</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                
                <a href="https://git.k8s.io/community/contributors/guide" class="button">贡献</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2019 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a></a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2019 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
        <div id="miceType" class="center">
            ICP license: 京ICP备17074266号-3
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<script>

(function () {
    window.addEventListener('DOMContentLoaded', init)

        
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>



<script language="application/javascript">
  
  (function addHeadingLinks(){
    var article = document.getElementById('docsContent');
    var headings = article.querySelectorAll('h1, h2, h3, h4, h5, h6');
    headings.forEach(function(heading){
      if(heading.id){
        var a = document.createElement('a');
        a.innerHTML = heading.innerHTML;
        a.href = '#'+heading.id;
        a.classList.add('inpage_heading');
        heading.innerHTML = '';
        heading.appendChild(a);
      }
    });
  })();
</script>
</body>
</html>